

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>2. INTRODUÇÃO AO SQL (STRUCTURED QUERY LANGUAGE) &#8212; Bancos de Dados Espaciais</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=5b4479735964841361fd" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=5b4479735964841361fd" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=5b4479735964841361fd" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd" />
  <script src="_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=5b4479735964841361fd"></script>

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'capitulo2';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Referências Bibliográficas" href="referencias.html" />
    <link rel="prev" title="1. FUNDAMENTOS DE BANCOS DE DADOS" href="capitulo1.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/postgis_python.png" class="logo__image only-light" alt="Bancos de Dados Espaciais - Home"/>
    <script>document.write(`<img src="_static/postgis_python.png" class="logo__image only-dark" alt="Bancos de Dados Espaciais - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Bancos de Dados Espaciais
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="capitulo1.html">1. FUNDAMENTOS DE BANCOS DE DADOS</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">2. INTRODUÇÃO AO SQL (STRUCTURED QUERY LANGUAGE)</a></li>
<li class="toctree-l1"><a class="reference internal" href="referencias.html">Referências Bibliográficas</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/Alexandrogschafer/Spatial-Database" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/Alexandrogschafer/Spatial-Database/issues/new?title=Issue%20on%20page%20%2Fcapitulo2.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/capitulo2.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>2. INTRODUÇÃO AO SQL (STRUCTURED QUERY LANGUAGE)</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#breve-historico-do-sql">2.1 Breve histórico do SQL</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visao-geral-do-banco-de-dados-de-exemplo">2.2 Visão geral do Banco de Dados de exemplo</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#requisitos-de-consulta-e-analise">2.2.1 Requisitos de consulta e análise</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-conceitual">2.2.1.1 Modelo conceitual</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#projeto-logico">2.2.1.2 Projeto lógico</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#projeto-fisico">2.2.1.3 Projeto físico</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#configuracao-do-ambiente-de-desenvolvimento-e-fundamentos-de-conexao-com-postgresql-utilizando-python">2.3 Configuração do ambiente de desenvolvimento e fundamentos de conexão com PostgreSQL utilizando Python</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#categorias-fundamentais-da-linguagem-sql-ddl-dml-e-dcl">2.4 Categorias fundamentais da linguagem SQL: DDL, DML e DCL</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#linguagem-de-definicao-de-dados-data-definition-language-ddl">2.4.1 Linguagem de definição de dados (Data Definition Language - DDL)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#linguagem-de-manipulacao-de-dados-data-manipulation-language-dml">2.4.2 Linguagem de Manipulação de Dados (Data Manipulation Language - DML)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#indexacao-e-performance-no-sql">2.4.3 Indexação e Performance no SQL</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#linguagem-de-controle-de-dados-data-control-language-dcl">2.4.4 Linguagem de Controle de Dados (Data Control Language - DCL)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#consulta-e-recuperacao-de-dados-em-sql">2.5 Consulta e recuperação de dados em SQL</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#agrupamento-de-dados-em-sql">2.6 Agrupamento de Dados em SQL</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#uniao-de-tabelas-no-sql">2.7 União de Tabelas no SQL</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#inner-join">2.7.1 INNER JOIN</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#left-join">2.7.2 LEFT JOIN</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#right-join">2.7.3 RIGHT JOIN</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#full-join">2.7.4 FULL JOIN</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#subconsultas">2.7.5 Subconsultas</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#operacoes-de-conjunto-em-sql">2.7.6 Operações de Conjunto em SQL</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#o-conceito-de-visao-em-bancos-de-dados-relacionais">2.8 O conceito de “Visão” em bancos de dados relacionais</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visoes-views-e-inner-join">2.8.1 Visões (Views) e INNER JOIN</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visoes-materializadas-no-postgresql">2.8.2 Visões Materializadas no PostgreSQL</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#praticas-recomendadas-e-convencoes-em-sql">2.9 Práticas Recomendadas e Convenções em SQL</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <div class="tex2jax_ignore mathjax_ignore section" id="introducao-ao-sql-structured-query-language">
<h1>2. INTRODUÇÃO AO SQL (STRUCTURED QUERY LANGUAGE)<a class="headerlink" href="#introducao-ao-sql-structured-query-language" title="Permalink to this heading">#</a></h1>
<p><a class="reference external" href="https://colab.research.google.com/https://github.com/Alexandrogschafer/Spatial-Database/blob/gh-pages/notebooks/capitulo2.ipynb">Abrir no Google Colab</a></p>
<p>SQL, que significa “Structured Query Language”, é a linguagem de programação padrão usada para comunicar e manipular bancos de dados relacionais. Desde sua criação, tem sido uma ferramenta indispensável para os profissionais de banco de dados, permitindo-lhes criar, modificar, gerenciar e consultar dados de forma eficaz. O poder do SQL reside em sua capacidade de lidar com conjuntos de dados grandes e complexos com comandos concisos e expressões bem definidas. Através de suas instruções de consulta, é possível não só realizar operações básicas de CRUD (Criar, Ler, Atualizar e Deletar dados), mas também executar tarefas avançadas como transações de dados, manipulação de esquemas de banco de dados e controle de acesso.</p>
<p>Diferentemente de outras linguagens de programação, como Java ou Python, que são linguagens de propósito geral, o SQL é especializado para a gestão de dados dentro de um SGBD relacional. Enquanto linguagens de propósito geral podem ser utilizadas para desenvolver aplicações diversas — de jogos a algoritmos de aprendizado de máquina —, o SQL é projetado especificamente para trabalhar com dados relacionais. Ele utiliza uma abordagem declarativa: o usuário especifica o que deseja fazer sem descrever todos os passos necessários para realizar a tarefa. Por exemplo, ao invés de iterar sobre linhas de dados como faria em uma linguagem de programação convencional, um usuário SQL simplesmente declara que deseja selecionar dados de uma tabela sob certas condições, e o sistema de gerenciamento do banco de dados trata de encontrar a forma mais eficiente de executar essa requisição.</p>
<p>O SQL distingue-se ainda por ser fortemente baseado em álgebra relacional e cálculo de tuplas, fundamentos teóricos que garantem não só a sua robustez, mas também a sua adaptabilidade e durabilidade ao longo do tempo. Esta especialização faz do SQL a escolha ideal para situações em que a manipulação de dados é primordial, garantindo que os usuários possam realizar consultas complexas e manter a integridade dos dados com um mínimo de instruções. A despeito das inúmeras extensões e variações que surgiram para atender a necessidades específicas, o SQL mantém uma sintaxe e funcionalidade consistentes que facilitam a portabilidade entre diferentes sistemas de banco de dados e a aprendizagem por novos usuários, assegurando o seu lugar como a linguagem dominante no campo do gerenciamento de dados relacionais.</p>
<div class="section" id="breve-historico-do-sql">
<h2>2.1 Breve histórico do SQL<a class="headerlink" href="#breve-historico-do-sql" title="Permalink to this heading">#</a></h2>
<p>A linguagem SQL (Structured Query Language) tem uma história de desenvolvimento relativamente longa, desde suas origens até seu papel central nos sistemas de gerenciamento de banco de dados modernos.</p>
<p><strong>Década de 1960 - Surgimento dos Bancos de Dados:</strong></p>
<ul class="simple">
<li><p>Nas décadas de 1950 e 1960, os sistemas de gerenciamento de banco de dados começaram a ser desenvolvidos em resposta à necessidade crescente de armazenar e manipular grandes volumes de dados.</p></li>
<li><p>O modelo relacional de banco de dados, proposto por Edgar F. Codd em seu artigo “A Relational Model of Data for Large Shared Data Banks” em 1970, estabeleceu os fundamentos teóricos para a organização e manipulação de dados.</p></li>
</ul>
<p><strong>Década de 1970 - Desenvolvimento do SQL:</strong></p>
<ul class="simple">
<li><p>O IBM Research Laboratory desenvolveu uma linguagem chamada SEQUEL (Structured English QUEry Language) nos anos 1970, que mais tarde foi renomeada para SQL (Structured Query Language).</p></li>
<li><p>O SQL foi desenvolvido como uma linguagem padrão para consultas e manipulação de bancos de dados relacionais, baseada nos princípios do modelo relacional de dados de Codd.</p></li>
<li><p>A IBM lançou o primeiro produto comercial de banco de dados a usar SQL, chamado System R, em 1978.</p></li>
</ul>
<p><strong>Década de 1980 - Padrão ANSI SQL:</strong></p>
<ul class="simple">
<li><p>Durante os anos 1980, várias implementações comerciais de bancos de dados relacionais surgiram, cada uma com sua própria versão do SQL.</p></li>
<li><p>Em 1986, o ANSI (American National Standards Institute) estabeleceu um comitê para desenvolver um padrão para a linguagem SQL, a fim de promover a interoperabilidade entre os sistemas de banco de dados.</p></li>
<li><p>O padrão ANSI SQL-86 foi o primeiro a ser oficializado, seguido pelo ANSI SQL-89.</p></li>
</ul>
<p><strong>Década de 1990 - Expansão e complexidade:</strong></p>
<ul class="simple">
<li><p>Durante os anos 1990, o SQL se tornou a linguagem padrão para interação com bancos de dados relacionais em uma ampla variedade de aplicativos e sistemas.</p></li>
<li><p>Novas versões do padrão ANSI SQL foram lançadas, incluindo SQL-92, SQL:1999 e SQL:2003, introduzindo novos recursos, como suporte a tipos de dados avançados, gatilhos (triggers), procedimentos armazenados e muito mais.</p></li>
</ul>
<p><strong>Década de 2000 até o presente - Evolução contínua:</strong></p>
<ul class="simple">
<li><p>Desde o início do século XXI, o SQL continuou a evoluir para atender às demandas crescentes de aplicativos e sistemas modernos.</p></li>
<li><p>Novas funcionalidades foram adicionadas às versões mais recentes do padrão SQL, como suporte a XML, SQL:2008, SQL:2011, SQL:2016 e SQL:2019.</p></li>
<li><p>Além do padrão ANSI SQL, várias implementações proprietárias de SQL foram desenvolvidas por empresas de tecnologia, como Microsoft SQL Server, Oracle Database, MySQL, PostgreSQL, entre outros, cada uma com suas próprias extensões e melhorias.</p></li>
</ul>
</div>
<div class="section" id="visao-geral-do-banco-de-dados-de-exemplo">
<h2>2.2 Visão geral do Banco de Dados de exemplo<a class="headerlink" href="#visao-geral-do-banco-de-dados-de-exemplo" title="Permalink to this heading">#</a></h2>
<p>Antes de avançarmos no estudo da linguagem SQL, torna-se imperativo estabelecer uma base comum na qual aplicaremos os conceitos que serão discutidos ao longo deste capítulo. Para isso, apresentaremos um banco de dados de exemplo, concebido não apenas para ilustrar os conceitos teóricos de SQL, mas também para fornecer uma experiência prática através de exemplos aplicáveis. Este banco de dados será nosso laboratório, onde exploraremos desde consultas simples até operações complexas de manipulação e controle de dados.</p>
<p>O processo de desenvolvimento de um banco de dados é tipicamente conduzido através de várias etapas distintas. Neste contexto, delinearemos a evolução do nosso projeto de banco de dados em quatro fases fundamentais: Análise de Requisitos e Consultas; Modelagem Conceitual; Design Lógico; e Implementação Física.</p>
<ul class="simple">
<li><p><strong>Requisitos de consulta e análise:</strong> Esta seção inicial define as capacidades analíticas e as consultas específicas que o banco de dados deve suportar. Esses requisitos orientarão as fases subsequentes de modelagem, assegurando que o banco de dados possa responder a perguntas críticas sobre população, crescimento e distribuição em diferentes níveis geográficos, desde municípios até regiões.</p></li>
<li><p><strong>Modelo conceitual:</strong> Esta fase se concentra na identificação das entidades-chave, como municípios, regiões imediatas, regiões intermediárias, estados e regiões, e nas relações entre elas, sem se ater aos detalhes técnicos de implementação. O objetivo é estabelecer uma visão clara e abstrata da estrutura de dados, facilitando a compreensão dos relacionamentos e fluxos de informação.</p></li>
<li><p><strong>Projeto lógico:</strong> Após a definição do modelo conceitual, o projeto lógico detalha a estrutura do banco de dados em termos de tabelas, colunas, chaves primárias e estrangeiras, e relações. Esta etapa traduz o modelo conceitual em um esquema lógico que serve como um plano para a implementação física, considerando as características específicas do SGBD escolhido. O escopo deste projeto lógico abrange a organização necessária para armazenar e gerenciar os dados demográficos, garantindo a integridade, a normalização e a eficiência na manipulação dos dados.</p></li>
<li><p><strong>Projeto físico:</strong> A fase final do desenvolvimento concentra-se na implementação do projeto lógico no SGBD selecionado (o PostgreSQL), definindo aspectos técnicos como tipos de dados e restrições.</p></li>
</ul>
<p>Esta estrutura garante que o design e a implementação do banco de dados sejam direcionados pelas necessidades analíticas do projeto, proporcionando uma base sólida para o desenvolvimento de consultas complexas e relatórios analíticos detalhados.</p>
<p>É importante enfatizar que a finalidade do projeto do banco de dados aqui apresentado não é explorar exaustivamente a metodologia de desenvolvimento de bancos de dados. Portanto, a documentação fornecida aqui é intencionalmente concisa e simplificada. Em projetos de bancos de dados reais, o processo de desenvolvimento é tipicamente mais intricado, abrangendo etapas adicionais e um nível de detalhamento mais profundo em cada fase.</p>
<div class="section" id="requisitos-de-consulta-e-analise">
<h3>2.2.1 Requisitos de consulta e análise<a class="headerlink" href="#requisitos-de-consulta-e-analise" title="Permalink to this heading">#</a></h3>
<p>O objetivo principal deste banco de dados é facilitar a análise dos dados demográficos coletados pelo Instituto Brasileiro de Geografia e Estatística (IBGE), permitindo a exploração de padrões populacionais e tendências de crescimento ou declínio ao longo do tempo em diferentes níveis geográficos. Destinado especificamente para acadêmicos e pesquisadores atuantes nas áreas de demografia, geografia e disciplinas correlatas, o banco de dados é projetado para apoiar suas investigações e publicações científicas. Esses usuários, oriundos do meio acadêmico, necessitam de acesso a dados detalhados e confiáveis para fundamentar análises complexas, realizar estudos comparativos e embasar suas contribuições teóricas e práticas para o conhecimento nas suas respectivas áreas de especialização.</p>
<p>As funcionalidades e capacidades do banco de dados estão orientadas para suportar uma variedade de consultas analíticas. As seguintes questões ilustram exemplos de análises que nosso banco de dados deve suportar, refletindo as necessidades de seus usuários:</p>
<p><strong>Análise demográfica:</strong></p>
<ul class="simple">
<li><p>Determinação da população total do Brasil, bem como de cada região, estado, região intermediária, região imediata, e município nos anos de 2010 e 2022.</p></li>
<li><p>Identificação das regiões e municípios com o maior crescimento populacional entre 2010 e 2022.</p></li>
<li><p>Análise das áreas que experimentaram redução populacional no mesmo período.</p></li>
</ul>
<p><strong>Análise temporal e comparativa:</strong></p>
<ul class="simple">
<li><p>Como a distribuição populacional evoluiu ao longo do tempo em diferentes granularidades espaciais no Brasil?</p></li>
<li><p>Comparação das taxas de crescimento ou declínio populacional entre 2010 e 2022 em diferentes granularidades espaciais.</p></li>
</ul>
<p><strong>Análises específicas de localidade:</strong></p>
<ul class="simple">
<li><p>Cálculo da população total das capitais dos estados brasileiros em 2022.</p></li>
<li><p>Exploração de como as regiões imediatas contribuem para a população total de um estado específico.</p></li>
<li><p>Determinação das regiões imediatas com a maior e a menor população dentro de uma região intermediária específica.</p></li>
</ul>
<div class="section" id="modelo-conceitual">
<h4>2.2.1.1 Modelo conceitual<a class="headerlink" href="#modelo-conceitual" title="Permalink to this heading">#</a></h4>
<p>Um modelo conceitual de banco de dados é uma representação abstrata e de alto nível de como os dados estão organizados e interagem entre si dentro de um sistema de banco de dados. Ao contrário dos modelos físicos, que detalham como os dados são armazenados no hardware, ou dos modelos lógicos, que definem estruturas de dados específicas como tabelas e colunas em um sistema de gerenciamento de banco de dados, o modelo conceitual foca na estrutura geral dos dados e nas relações entre eles, ignorando detalhes técnicos.</p>
<p>O modelo conceitual de nosso banco de dados está representado no diagrama a seguir:</p>
<p><img alt="Modelo Conceitual do Banco de Dados" src="_images/fig2.png" /></p>
<p>O modelo conceitual de nosso banco de dados apresenta uma hierarquia clara e estruturada que vai do nível municipal até o regional, permitindo uma análise detalhada e abrangente da população e da organização territorial do Brasil. Aqui está um resumo do modelo conceitual:</p>
<ul class="simple">
<li><p><strong>Município:</strong> Representa a unidade base para a organização dos dados demográficos. Cada município é único e é identificado por um código geográfico específico, servindo como ponto de partida para compreender a estrutura administrativa e populacional no contexto geográfico do Brasil. Informações demográficas e geográficas são associadas a cada município.</p></li>
<li><p><strong>Região Imediata:</strong> Cada município está diretamente vinculado a uma região imediata. Estas regiões representam agrupamentos de municípios que compartilham proximidade geográfica e características socioeconômicas similares. A região imediata reflete uma área de influência próxima, onde há maior interação entre os municípios para serviços básicos e atividades econômicas, auxiliando na compreensão das dinâmicas locais.</p></li>
<li><p><strong>Região Intermediária:</strong> Abrange um conjunto mais amplo de municípios, incluindo várias regiões imediatas, e indica uma esfera de influência significativa que pode abranger grandes áreas geográficas e econômicas dentro de um estado. Este nível torna possível a realização de análises regionais e o planejamento de infraestrutura e serviços para uma população maior.</p></li>
<li><p><strong>Estado:</strong> Cada município está ligado a um estado, que é parte integral da federação brasileira. Os estados são componentes fundamentais para a análise demográfica e a administração territorial.</p></li>
<li><p><strong>Região:</strong> Os estados são agrupados em regiões, as maiores divisões administrativas do Brasil, facilitando análises demográficas em larga escala e o entendimento da distribuição populacional e organização territorial em um nível nacional.</p></li>
</ul>
<p>Este modelo conceitual fornece a base para compreender as relações e hierarquias dentro do banco de dados, enfatizando a importância de cada nível administrativo e geográfico na análise demográfica do Brasil.</p>
</div>
<div class="section" id="projeto-logico">
<h4>2.2.1.2 Projeto lógico<a class="headerlink" href="#projeto-logico" title="Permalink to this heading">#</a></h4>
<p>O projeto lógico de um banco de dados envolve a modelagem dos dados de forma abstrata, sem considerar os detalhes específicos do sistema de gerenciamento de banco de dados (SGBD) que será utilizado. Esta fase foca na estruturação dos dados, definindo entidades, atributos, chaves primárias, chaves estrangeiras, e as relações entre as entidades. O objetivo é criar um modelo que represente os requisitos de informação do sistema de forma precisa.</p>
<p>O diagrama Entidade-Relacionamento (E-R) é uma ferramenta fundamental nesta fase, oferecendo uma representação visual das entidades envolvidas no banco de dados, seus atributos e as relações entre elas. Este modelo serve como uma ponte entre os requisitos de informação definidos na fase de análise e o projeto físico do banco de dados, facilitando a compreensão das estruturas de dados que serão implementadas.</p>
<p>Abaixo, apresentamos o diagrama E-R completo, com as entidades e seus respectivos atributos:</p>
<p><img alt="Diagrama E-R do Projeto Lógico" src="_images/fig3.png" /></p>
<p>Este diagrama inclui as seguintes entidades principais (a serem detalhadas com atributos e relações no diagrama real):</p>
<ul class="simple">
<li><p><strong>Município:</strong> Representa a unidade básica de análise demográfica, com atributos como código geográfico, nome, população e dados geográficos.</p></li>
<li><p><strong>Região Imediata e Intermediária:</strong> Agrupa municípios com base em características geográficas e socioeconômicas, contendo atributos como código, nome e a relação com municípios pertencentes.</p></li>
<li><p><strong>Estado:</strong> Incorpora informações sobre os estados brasileiros, incluindo atributos como código, nome e a relação com suas regiões imediatas e intermediárias.</p></li>
<li><p><strong>Região:</strong> Descreve as maiores divisões administrativas do Brasil, com atributos incluindo código, nome e os estados membros.</p></li>
</ul>
<p>Os relacionamentos estabelecidos são:</p>
<ul class="simple">
<li><p><strong>censo_mun ↔ regiao_imed:</strong> Um município pertence a uma região imediata.</p></li>
<li><p><strong>censo_mun ↔ regiao_inter:</strong> Um município pertence a uma região intermediária.</p></li>
<li><p><strong>censo_mun ↔ estado:</strong> Um município pertence a um estado.</p></li>
<li><p><strong>regiao_imed ↔ regiao_inter:</strong> Uma região imediata pertence a uma região intermediária.</p></li>
<li><p><strong>regiao_inter ↔ estado:</strong> Uma região intermediária pertence a um estado.</p></li>
<li><p><strong>estado ↔ regiao:</strong> Um estado pertence a uma região.</p></li>
</ul>
<p>Na figura abaixo, apresentamos o diagrama lógico do banco de dados construído na ferramenta <a class="reference external" href="http://dbdiagram.io">dbdiagram.io</a> (<a class="reference external" href="https://dbdiagram.io/home">https://dbdiagram.io/home</a>).</p>
<p><img alt="Modelo Lógico" src="_images/fig4.png" /></p>
<p>Este diagrama representa a estrutura hierárquica e as relações entre municípios, regiões imediatas e intermediárias, estados e regiões para o nosso banco de dados. Segue abaixo a descrição detalhada da estrutura do banco de dados:</p>
<p><strong>Tabela <code class="docutils literal notranslate"><span class="pre">censo_mun</span></code></strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cd_geocodi</span></code> INT [PK]: Código geográfico do município, sendo a chave primária.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nome_mun</span></code> VARCHAR: Nome do município.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">area_km2</span></code> FLOAT: Área do município em quilômetros quadrados.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">popul_2010</span></code> INT: População do município em 2010.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">popul_2022</span></code> INT: População do município em 2022.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cod_rgi</span></code> INT [FK]: Código da região imediata à qual o município pertence, chave estrangeira.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cod_rgint</span></code> INT [FK]: Código da região intermediária à qual o município pertence, chave estrangeira.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cod_uf</span></code> INT [FK]: Código do estado ao qual o município pertence, chave estrangeira.</p></li>
</ul>
<p><strong>Tabela <code class="docutils literal notranslate"><span class="pre">regiao_imed</span></code></strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cod_rgi</span></code> INT [PK]: Código identificador da região imediata, sendo a chave primária.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nome_rgi</span></code> VARCHAR: Nome da região imediata.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cod_rgint</span></code> INT [FK]: Código da região intermediária à qual a região imediata pertence, chave estrangeira.</p></li>
</ul>
<p><strong>Tabela <code class="docutils literal notranslate"><span class="pre">regiao_inter</span></code></strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cod_rgint</span></code> INT [PK]: Código identificador da região intermediária, sendo a chave primária.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nome_rgint</span></code> VARCHAR: Nome da região intermediária.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cod_uf</span></code> INT [FK]: Código do estado ao qual a região intermediária pertence, chave estrangeira.</p></li>
</ul>
<p><strong>Tabela <code class="docutils literal notranslate"><span class="pre">estado</span></code></strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cod_uf</span></code> INT [PK]: Código identificador do estado, sendo a chave primária.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nome_uf</span></code> VARCHAR: Nome do estado.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sigla_uf</span></code> VARCHAR: Sigla do estado.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cod_rg</span></code> INT [FK]: Código da região à qual o estado pertence, chave estrangeira.</p></li>
</ul>
<p><strong>Tabela <code class="docutils literal notranslate"><span class="pre">regiao</span></code></strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cod_rg</span></code> INT [PK]: Código identificador da região, sendo a chave primária.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nome_rg</span></code> VARCHAR: Nome da região.</p></li>
</ul>
<p><strong>Detalhes técnicos do projeto lógico</strong></p>
<p><em>Relacionamentos</em></p>
<ul class="simple">
<li><p>Cada registro em <code class="docutils literal notranslate"><span class="pre">censo_mun</span></code> está vinculado a uma única <code class="docutils literal notranslate"><span class="pre">regiao_imed</span></code>, <code class="docutils literal notranslate"><span class="pre">regiao_inter</span></code>, e <code class="docutils literal notranslate"><span class="pre">estado</span></code> através de chaves estrangeiras (<code class="docutils literal notranslate"><span class="pre">FK</span></code>), refletindo a estrutura geográfica e administrativa do Brasil. Esta configuração assegura a representação precisa das hierarquias territoriais e administrativas.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">regiao_imed</span></code> está ligada a <code class="docutils literal notranslate"><span class="pre">regiao_inter</span></code>, e estas estão associadas a <code class="docutils literal notranslate"><span class="pre">estado</span></code>, que por sua vez é vinculado a <code class="docutils literal notranslate"><span class="pre">regiao</span></code>, demonstrando a hierarquia administrativa e territorial do país. Esses relacionamentos permitem análises detalhadas e multifacetadas baseadas em diversos níveis geográficos.</p></li>
</ul>
</li>
</ul>
<p><em>Chaves e índices</em></p>
<ul class="simple">
<li><p>As chaves primárias (<code class="docutils literal notranslate"><span class="pre">PK</span></code>) são definidas para garantir a identificação única de registros dentro de cada tabela. As chaves estrangeiras (<code class="docutils literal notranslate"><span class="pre">FK</span></code>) estabelecem relações entre as tabelas, assegurando a integridade referencial e permitindo consultas relacionais eficientes.</p></li>
<li><p>Índices podem ser utilizados nas chaves primárias e em colunas frequentemente acessadas para melhorar o desempenho das consultas.</p></li>
</ul>
<p><em>Tipos de dados</em></p>
<ul class="simple">
<li><p>Utilizam-se os tipos de dados <code class="docutils literal notranslate"><span class="pre">INT</span></code> para números inteiros, <code class="docutils literal notranslate"><span class="pre">VARCHAR</span></code> para textos, e <code class="docutils literal notranslate"><span class="pre">FLOAT</span></code> para números com ponto flutuante. Essa escolha de tipos de dados visa otimizar o armazenamento e o acesso aos dados, garantindo a precisão e eficácia nas consultas e análises.</p></li>
</ul>
<p><em>Normalização</em></p>
<ul class="simple">
<li><p>O design do banco de dados segue os princípios de normalização até a Terceira Forma Normal (3NF). Este processo minimiza redundâncias, evita anomalias de dados e assegura a integridade dos dados, contribuindo para um armazenamento eficiente e para a facilidade de manutenção do banco de dados.</p></li>
</ul>
<p>Essas diretrizes de projeto e estruturação do banco de dados garantem não apenas a eficiência e a robustez no armazenamento e na recuperação de dados, mas também a flexibilidade para futuras expansões e ajustes conforme as necessidades de análise evoluem.</p>
</div>
<div class="section" id="projeto-fisico">
<h4>2.2.1.3 Projeto físico<a class="headerlink" href="#projeto-fisico" title="Permalink to this heading">#</a></h4>
<p>O projeto físico de um banco de dados é uma etapa na modelagem de banco de dados onde se define como o modelo lógico será implementado dentro de um sistema de gerenciamento de banco de dados específico (SGBD). Para o curso, escolhemos o SGBD PostgreSQL, um dos sistemas de gerenciamento de banco de dados relacional mais avançados e de código aberto disponíveis (<a class="reference external" href="https://www.postgresql.org/">https://www.postgresql.org/</a>).</p>
<p>A implementação física do nosso banco de dados no PostgreSQL é realizada através dos seguintes comandos em linguagem SQL:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="ss">&quot;censo_mun&quot;</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="ss">&quot;cd_geocodi&quot;</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">  </span><span class="ss">&quot;nome_mun&quot;</span><span class="w"> </span><span class="nb">varchar</span><span class="p">,</span>
<span class="w">  </span><span class="ss">&quot;area_km2&quot;</span><span class="w"> </span><span class="nb">float</span><span class="p">,</span>
<span class="w">  </span><span class="ss">&quot;popul_2010&quot;</span><span class="w"> </span><span class="nb">int</span><span class="p">,</span>
<span class="w">  </span><span class="ss">&quot;popul_2022&quot;</span><span class="w"> </span><span class="nb">int</span><span class="p">,</span>
<span class="w">  </span><span class="ss">&quot;cod_rgi&quot;</span><span class="w"> </span><span class="nb">int</span><span class="p">,</span>
<span class="w">  </span><span class="ss">&quot;cod_rgint&quot;</span><span class="w"> </span><span class="nb">int</span><span class="p">,</span>
<span class="w">  </span><span class="ss">&quot;cod_uf&quot;</span><span class="w"> </span><span class="nb">int</span>
<span class="p">);</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="ss">&quot;regiao_imed&quot;</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="ss">&quot;cod_rgi&quot;</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">  </span><span class="ss">&quot;nome_rgi&quot;</span><span class="w"> </span><span class="nb">varchar</span><span class="p">,</span>
<span class="w">  </span><span class="ss">&quot;cod_rgint&quot;</span><span class="w"> </span><span class="nb">int</span>
<span class="p">);</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="ss">&quot;regiao_inter&quot;</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="ss">&quot;cod_rgint&quot;</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">  </span><span class="ss">&quot;nome_rgint&quot;</span><span class="w"> </span><span class="nb">varchar</span><span class="p">,</span>
<span class="w">  </span><span class="ss">&quot;cod_uf&quot;</span><span class="w"> </span><span class="nb">int</span>
<span class="p">);</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="ss">&quot;estado&quot;</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="ss">&quot;cod_uf&quot;</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">  </span><span class="ss">&quot;nome_uf&quot;</span><span class="w"> </span><span class="nb">varchar</span><span class="p">,</span>
<span class="w">  </span><span class="ss">&quot;sigla_uf&quot;</span><span class="w"> </span><span class="nb">varchar</span><span class="p">,</span>
<span class="w">  </span><span class="ss">&quot;cod_rg&quot;</span><span class="w"> </span><span class="nb">int</span>
<span class="p">);</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="ss">&quot;regiao&quot;</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="ss">&quot;cod_rg&quot;</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">  </span><span class="ss">&quot;nome_rg&quot;</span><span class="w"> </span><span class="nb">varchar</span>
<span class="p">);</span>

<span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="ss">&quot;censo_mun&quot;</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="ss">&quot;cod_rgi&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="ss">&quot;regiao_imed&quot;</span><span class="w"> </span><span class="p">(</span><span class="ss">&quot;cod_rgi&quot;</span><span class="p">);</span>
<span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="ss">&quot;censo_mun&quot;</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="ss">&quot;cod_rgint&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="ss">&quot;regiao_inter&quot;</span><span class="w"> </span><span class="p">(</span><span class="ss">&quot;cod_rgint&quot;</span><span class="p">);</span>
<span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="ss">&quot;censo_mun&quot;</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="ss">&quot;cod_uf&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="ss">&quot;estado&quot;</span><span class="w"> </span><span class="p">(</span><span class="ss">&quot;cod_uf&quot;</span><span class="p">);</span>
<span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="ss">&quot;regiao_imed&quot;</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="ss">&quot;cod_rgint&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="ss">&quot;regiao_inter&quot;</span><span class="w"> </span><span class="p">(</span><span class="ss">&quot;cod_rgint&quot;</span><span class="p">);</span>
<span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="ss">&quot;regiao_inter&quot;</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="ss">&quot;cod_uf&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="ss">&quot;estado&quot;</span><span class="w"> </span><span class="p">(</span><span class="ss">&quot;cod_uf&quot;</span><span class="p">);</span>
<span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="ss">&quot;estado&quot;</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="ss">&quot;cod_rg&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="ss">&quot;regiao&quot;</span><span class="w"> </span><span class="p">(</span><span class="ss">&quot;cod_rg&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>Estes comandos SQL definem a estrutura das tabelas do banco de dados, incluindo colunas, tipos de dados e chaves primárias (PRIMARY KEY). Além disso, os comandos ALTER TABLE são usados para estabelecer as relações entre as tabelas por meio de chaves estrangeiras (FOREIGN KEY), assegurando a integridade referencial do banco de dados. A escolha do PostgreSQL permite aproveitar suas funcionalidades e sua conformidade com os padrões SQL, facilitando a implementação e a manutenção do banco de dados.</p>
</div>
</div>
</div>
<div class="section" id="configuracao-do-ambiente-de-desenvolvimento-e-fundamentos-de-conexao-com-postgresql-utilizando-python">
<h2>2.3 Configuração do ambiente de desenvolvimento e fundamentos de conexão com PostgreSQL utilizando Python<a class="headerlink" href="#configuracao-do-ambiente-de-desenvolvimento-e-fundamentos-de-conexao-com-postgresql-utilizando-python" title="Permalink to this heading">#</a></h2>
<p>Essa seção aborda a preparação do ambiente necessário para realizar as atividades práticas de nosso curso, detalhando o processo passo a passo para configurar um ambiente de desenvolvimento para trabalhar com bancos de dados SQL, especificamente utilizando o PostgreSQL, diretamente no ambiente do Google Colaboratory.</p>
<p>A interação com um Sistema de Gerenciamento de Banco de Dados Relacional (SGBD Relacional) pode variar em complexidade, dependendo da tarefa em questão e do nível de experiência do usuário. Existem diversas interfaces e ferramentas projetadas para facilitar essa interação, cada uma adequada a diferentes necessidades e níveis de habilidade.</p>
<p><strong>Interfaces de Linha de Comando (CLI)</strong></p>
<p>As interfaces de linha de comando (CLI) são ferramentas que permitem aos usuários interagir com o banco de dados digitando comandos SQL diretamente em um prompt de comando. Essas interfaces são poderosas, mas exigem um conhecimento sólido da sintaxe SQL e dos comandos específicos do SGBD. Elas são ideais para usuários experientes que buscam uma abordagem rápida e direta.</p>
<p><strong>Interfaces Gráficas de Usuário (GUIs)</strong></p>
<p>Para uma experiência de usuário mais intuitiva, as interfaces gráficas de usuário (GUIs) permitem a interação com o banco de dados através de elementos visuais como menus, botões e formulários. Ferramentas GUI facilitam a gestão de bancos de dados, tornando-a mais acessível a usuários com menos familiaridade com SQL. Ferramentas como PGAdmin, PostgreSQL Studio, DBeaver e DataGrip permitem realizar diversas tarefas de banco de dados de forma visual.</p>
<p><strong>Bibliotecas de programação específicas</strong></p>
<p>Desenvolvedores podem utilizar bibliotecas de programação específicas para integrar funcionalidades de bancos de dados em suas aplicações. Essas bibliotecas, disponíveis para várias linguagens de programação, facilitam a execução de consultas SQL, manipulação de dados e gerenciamento de conexões de banco de dados através de chamadas de função na linguagem escolhida, abstraindo a necessidade de interação direta com a sintaxe SQL.</p>
<p><strong>Integração de Python e PostgreSQL no Google Colab: Uma abordagem prática para o aprendizado de SQL</strong></p>
<p>No contexto do nosso curso, utilizaremos o Python como a principal ferramenta para interagir com o SGBD PostgreSQL, em conjunto com o ambiente hospedado do Google Colab.</p>
<p>O Google Colab destaca-se por ser um ambiente de desenvolvimento integrado (IDE) baseado em navegador, que simplifica o processo de aprendizado ao eliminar a necessidade de configurações complexas ou instalações de software. Isso permite aos estudantes focar exclusivamente no aprendizado da linguagem SQL e na interação com o PostgreSQL, oferecendo uma experiência de aprendizado direta e sem interrupções.</p>
<p>A execução de código Python em nuvem, uma das funcionalidades centrais do Google Colab, garante que todos os alunos tenham acesso a recursos computacionais consistentes e confiáveis, independentemente das especificações de seus dispositivos locais. Isso democratiza o acesso às ferramentas necessárias para o estudo de SQL, permitindo que estudantes de diversos contextos tenham igualdade de oportunidades de aprendizado.</p>
<p>A integração do PostgreSQL nos servidores do Google padroniza o acesso ao banco de dados, garantindo uma experiência uniforme de ensino e aprendizagem. Com todos os alunos trabalhando com a mesma configuração de banco de dados, é promovida uma experiência equitativa, onde cada um tem acesso às mesmas ferramentas e recursos.</p>
<p><strong>Ferramentas para a interação com PostgreSQL</strong></p>
<p>A biblioteca <code class="docutils literal notranslate"><span class="pre">psycopg2</span></code> é uma ferramenta essencial para conectar Python ao PostgreSQL, permitindo a execução de comandos SQL diretamente a partir de scripts Python. Sua ampla utilização em aplicações que requerem interação com bancos de dados PostgreSQL a torna uma escolha confiável para o desenvolvimento e a educação, facilitando uma interface completa para consultas, atualizações e manipulação de dados.</p>
<p>Paralelamente, a extensão <code class="docutils literal notranslate"><span class="pre">ipython-sql</span></code> enriquece o IPython ao adicionar capacidades de execução de comandos SQL diretamente de células em notebooks IPython. Esta funcionalidade torna a escrita e execução de comandos SQL uma tarefa interativa, simplificando o processo de aprendizado e experimentação com a linguagem SQL.</p>
<p>Juntas, as bibliotecas <code class="docutils literal notranslate"><span class="pre">psycopg2</span></code> e <code class="docutils literal notranslate"><span class="pre">ipython-sql</span></code> aprimoram significativamente a interação com o PostgreSQL, tornando a exploração das capacidades do SQL dentro de um ambiente Python mais acessível e intuitiva. Essas ferramentas oferecem uma base sólida tanto para desenvolvedores quanto para educadores, facilitando o ensino e o aprendizado de SQL de forma prática e eficaz.</p>
<p><strong>Etapa 1: Configurando PostgreSQL no Google Colab</strong></p>
<p>Neste segmento, detalhamos o processo de instalação e configuração do PostgreSQL no ambiente Google Colab, garantindo que você tenha um sistema de banco de dados operacional para as atividades práticas do curso.</p>
<p>Instalação do PostgreSQL</p>
<p>Para começar, é necessário instalar o PostgreSQL juntamente com seus componentes adicionais diretamente no Google Colab. Execute o seguinte comando no notebook para instalar o PostgreSQL:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># !apt-get install -y postgresql postgresql-contrib</span>
</pre></div>
</div>
</div>
</div>
<p>Este comando instala a versão mais recente do PostgreSQL disponível nos repositórios do Ubuntu, que o Google Colab utiliza, além de vários módulos adicionais que podem ser úteis.</p>
<p>Inicializando o serviço PostgreSQL</p>
<p>Com o PostgreSQL instalado, o próximo passo é iniciar o serviço do banco de dados para que ele fique operacional e pronto para receber conexões. Use o comando a seguir para iniciar o PostgreSQL:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="ch">#!service postgresql start</span>
</pre></div>
</div>
</div>
</div>
<p>Este comando ativa o serviço do PostgreSQL, preparando o ambiente para a criação de bancos de dados e a execução de comandos SQL.</p>
<p>Configuração do usuário</p>
<p>Por questões de segurança, é aconselhável alterar a senha do usuário padrão <code class="docutils literal notranslate"><span class="pre">postgres</span></code>. Escolha uma senha forte e utilize o comando abaixo para atualizá-la:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># !sudo -u postgres psql -c &quot;ALTER USER postgres PASSWORD &#39;curso_geo&#39;;&quot;</span>
</pre></div>
</div>
</div>
</div>
<p>Substitua <code class="docutils literal notranslate"><span class="pre">'curso_geo'</span></code> pela senha que desejar. Este passo é fundamental para proteger o seu banco de dados contra acessos não autorizados.</p>
<p>Após completar essas etapas, o PostgreSQL estará configurado e pronto para uso no Google Colab, permitindo que você prossiga com as atividades práticas de manipulação de bancos de dados SQL.</p>
<p><strong>Etapa 2. Criação do Banco de Dados e conexão</strong></p>
<p>Remova o banco de dados <code class="docutils literal notranslate"><span class="pre">bd_censo_ibge</span></code> se ele já existir e crie um novo para evitar conflitos.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="ch">#!sudo -u postgres psql -c &#39;DROP DATABASE IF EXISTS bd_censo_ibge;&#39;</span>
<span class="c1">#!sudo -u postgres psql -c &#39;CREATE DATABASE bd_censo_ibge;&#39;</span>
</pre></div>
</div>
</div>
</div>
<p>Defina as credenciais como variáveis no seu script para facilitar a modificação e o gerenciamento posteriormente.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dbname</span> <span class="o">=</span> <span class="s1">&#39;bd_censo_ibge&#39;</span>  <span class="c1"># Nome do banco de dados</span>
<span class="n">user</span> <span class="o">=</span> <span class="s1">&#39;postgres&#39;</span>         <span class="c1"># Nome do usuário</span>
<span class="n">password</span> <span class="o">=</span> <span class="s1">&#39;curso_geo&#39;</span>    <span class="c1"># Senha definida anteriormente</span>
<span class="n">host</span> <span class="o">=</span> <span class="s1">&#39;localhost&#39;</span>        <span class="c1"># Endereço do host</span>
</pre></div>
</div>
</div>
</div>
<p><em>Conexão ao Banco de Dados:</em></p>
<p>Instale a biblioteca <code class="docutils literal notranslate"><span class="pre">psycopg2</span></code>, que permite a conexão e manipulação do PostgreSQL com Python. Em seguida, estabeleça a conexão com o banco de dados.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="ch">#!pip install psycopg2</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">psycopg2</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">dbname</span><span class="o">=</span><span class="n">dbname</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">)</span>
    <span class="n">cur</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Conectado ao banco de dados com sucesso!&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Erro ao conectar ao banco de dados: &quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Conectado ao banco de dados com sucesso!
</pre></div>
</div>
</div>
</div>
<p><strong>Apagando e recriando um Banco de Dados com psycopg2</strong></p>
<p>Em nosso exemplo prático não é necessário apagar o Banco de Dados. Inserimos estas instruções para o caso de você ter problemas que não consiga resolver. Neste caso, pode ser necessário apagar o Banco de Dados atual e criar um novo. Se não é este o seu caso, pode ir direto para a Etapa 3.</p>
<ul class="simple">
<li><p>Configurando o nível de isolamento para ‘autocommit’:</p></li>
</ul>
<p>Antes de apagar o banco de dados, é necessário configurar o nível de isolamento da conexão para ‘autocommit’. Isso permite executar comandos que alteram o estado do banco de dados, como <code class="docutils literal notranslate"><span class="pre">DROP</span> <span class="pre">DATABASE</span></code>, fora de uma transação.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">psycopg2</span>
<span class="kn">from</span> <span class="nn">psycopg2.extensions</span> <span class="kn">import</span> <span class="n">ISOLATION_LEVEL_AUTOCOMMIT</span>

<span class="c1"># Configuração inicial do nível de isolamento</span>
<span class="n">conn</span><span class="o">.</span><span class="n">set_isolation_level</span><span class="p">(</span><span class="n">psycopg2</span><span class="o">.</span><span class="n">extensions</span><span class="o">.</span><span class="n">ISOLATION_LEVEL_AUTOCOMMIT</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Conectar ao Banco de Dados padrão:</p></li>
</ul>
<p>Para apagar um banco de dados, você deve se conectar ao banco de dados padrão (<code class="docutils literal notranslate"><span class="pre">postgres</span></code>, por exemplo), pois não é possível apagar o banco de dados atualmente em uso.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conn</span> <span class="o">=</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">dbname</span><span class="o">=</span><span class="s1">&#39;postgres&#39;</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">)</span>
<span class="n">conn</span><span class="o">.</span><span class="n">set_isolation_level</span><span class="p">(</span><span class="n">ISOLATION_LEVEL_AUTOCOMMIT</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Desconectar conexões ativas</p></li>
</ul>
<p>Antes de apagar o banco de dados, é necessário desconectar todas as conexões ativas para evitar conflitos.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cur</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT pg_terminate_backend(pg_stat_activity.pid)</span>
<span class="s2">               FROM pg_stat_activity</span>
<span class="s2">               WHERE pg_stat_activity.datname = &#39;bd_censo_ibge&#39;;&quot;&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Apagar o Banco de Dados</p></li>
</ul>
<p>Com as conexões ativas desconectadas, você pode apagar o banco de dados.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;DROP DATABASE bd_censo_ibge;&#39;</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Verificar e recriar o Banco de Dados</p></li>
</ul>
<p>Após apagar o banco de dados, você pode tentar reconectá-lo para verificar se foi apagado corretamente. Isso deve resultar em um erro, indicando que o banco de dados não existe.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">dbname</span><span class="o">=</span><span class="s1">&#39;bd_censo_ibge&#39;</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Erro ao conectar ao banco de dados: &quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

<span class="n">cur</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>Finalmente, recrie o banco de dados e verifique a conexão.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>!sudo -u postgres psql -c &#39;DROP DATABASE IF EXISTS bd_censo_ibge;&#39;
!sudo -u postgres psql -c &#39;CREATE DATABASE bd_censo_ibge;&#39;

try:
    conn = psycopg2.connect(dbname=dbname, user=user, host=host, password=password)
    print(&quot;Conectado ao banco de dados com sucesso!&quot;)
except Exception as e:
    print(&quot;Erro ao conectar ao banco de dados: &quot;, e)
</pre></div>
</div>
<p>Essa sequência de comandos e instruções detalha o processo para remover um banco de dados existente (se necessário), definir credenciais, conectar ao PostgreSQL via Python no Google Colab, e as etapas para apagar e recriar um banco de dados, configurando corretamente o nível de isolamento para permitir a execução de comandos que alteram o estado do banco de dados fora de uma transação.</p>
<p><strong>Etapa 3: Conectando-se a PostgreSQL com ipython-sql no Jupyter Notebook</strong></p>
<p>Para realizar consultas SQL diretamente de um Jupyter Notebook, você pode usar a extensão <code class="docutils literal notranslate"><span class="pre">ipython-sql</span></code>. Primeiro, é necessário instalar a extensão, configurar a string de conexão e, em seguida, carregar a extensão para usar com o seu banco de dados PostgreSQL.</p>
<ul class="simple">
<li><p>Instalar da extensão ipython-sql</p></li>
</ul>
<p>A instalação é feita através do pip, o gerenciador de pacotes Python. Execute o seguinte comando no Jupyter Notebook para instalar a <code class="docutils literal notranslate"><span class="pre">ipython-sql</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># !pip install ipython-sql</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Configurar a string de conexão</p></li>
</ul>
<p>A string de conexão é uma forma de informar ao <code class="docutils literal notranslate"><span class="pre">ipython-sql</span></code> como se conectar ao seu banco de dados PostgreSQL. Ela contém informações como usuário, senha, host e o nome do banco de dados.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">connection_string</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;postgresql://</span><span class="si">{</span><span class="n">user</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">password</span><span class="si">}</span><span class="s2">@</span><span class="si">{</span><span class="n">host</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">dbname</span><span class="si">}</span><span class="s2">&quot;</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Carregar a extensão ipython-sql</p></li>
</ul>
<p>Com a string de conexão configurada, carregue a extensão <code class="docutils literal notranslate"><span class="pre">ipython-sql</span></code> para permitir a execução de comandos SQL diretamente nas células do Jupyter Notebook.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> sql
<span class="o">%</span><span class="k">sql</span> $connection_string
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Executar uma consulta SQL</p></li>
</ul>
<p>Para testar a conexão e a configuração, você pode executar uma consulta SQL simples, como selecionar a versão do PostgreSQL em uso.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">sql</span> SELECT version();
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
1 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>version</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>PostgreSQL 15.6 (Ubuntu 15.6-1.pgdg22.04+1) on x86_64-pc-linux-gnu, compiled by gcc (Ubuntu 11.4.0-1ubuntu1~22.04) 11.4.0, 64-bit</td>
        </tr>
    </tbody>
</table></div></div>
</div>
<p><strong>Etapa 4: Preparação e diagnóstico inicial do Banco de Dados</strong></p>
<p>Para obter uma compreensão abrangente e detalhada do estado atual do seu banco de dados antes de iniciar a criação de tabelas e inserção de dados, é recomendável realizar uma série de consultas prévias. Cada consulta tem seu propósito específico, ajudando você a entender a estrutura, as permissões, as configurações e o desempenho do seu banco de dados. Aqui está um guia unificado que inclui todas as consultas essenciais e suas explicações:</p>
<ul class="simple">
<li><p>Consultar esquemas existentes</p></li>
</ul>
<p><strong>Objetivo:</strong> Visualizar os esquemas disponíveis no banco de dados para entender sua estrutura organizacional.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span> 
SELECT schema_name 
FROM information_schema.schemata;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
4 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>schema_name</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>public</td>
        </tr>
        <tr>
            <td>information_schema</td>
        </tr>
        <tr>
            <td>pg_catalog</td>
        </tr>
        <tr>
            <td>pg_toast</td>
        </tr>
    </tbody>
</table></div></div>
</div>
<ul class="simple">
<li><p>Listar tabelas no esquema ‘public’</p></li>
</ul>
<p><strong>Objetivo:</strong> Verificar as tabelas existentes no esquema <code class="docutils literal notranslate"><span class="pre">public</span></code>, o esquema padrão para muitas operações.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span> 
SELECT table_name 
FROM information_schema.tables 
WHERE table_schema = &#39;public&#39;;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
0 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>table_name</th>
        </tr>
    </thead>
    <tbody>
    </tbody>
</table></div></div>
</div>
<ul class="simple">
<li><p>Verificar versão do Banco de Dados</p></li>
</ul>
<p><strong>Objetivo:</strong> Identificar a versão do banco de dados para garantir compatibilidade e suporte adequado.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span> 
SELECT version();
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
1 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>version</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>PostgreSQL 15.6 (Ubuntu 15.6-1.pgdg22.04+1) on x86_64-pc-linux-gnu, compiled by gcc (Ubuntu 11.4.0-1ubuntu1~22.04) 11.4.0, 64-bit</td>
        </tr>
    </tbody>
</table></div></div>
</div>
<ul class="simple">
<li><p>Verificar o espaço em disco</p></li>
</ul>
<p><strong>Objetivo:</strong> Avaliar o espaço em disco disponível, importante no contexto do planejamento de armazenamento e prevenção de problemas.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span> 
SELECT pg_size_pretty(pg_database_size(current_database()));
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
1 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>pg_size_pretty</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>7549 kB</td>
        </tr>
    </tbody>
</table></div></div>
</div>
<ul class="simple">
<li><p>Verificar conexões ativas</p></li>
</ul>
<p><strong>Objetivo:</strong> Monitorar as conexões ativas para identificar atividades, desempenho e potenciais bloqueios.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span> 
SELECT * 
FROM pg_stat_activity;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
7 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>datid</th>
            <th>datname</th>
            <th>pid</th>
            <th>leader_pid</th>
            <th>usesysid</th>
            <th>usename</th>
            <th>application_name</th>
            <th>client_addr</th>
            <th>client_hostname</th>
            <th>client_port</th>
            <th>backend_start</th>
            <th>xact_start</th>
            <th>query_start</th>
            <th>state_change</th>
            <th>wait_event_type</th>
            <th>wait_event</th>
            <th>state</th>
            <th>backend_xid</th>
            <th>backend_xmin</th>
            <th>query_id</th>
            <th>query</th>
            <th>backend_type</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>None</td>
            <td>None</td>
            <td>1489</td>
            <td>None</td>
            <td>None</td>
            <td>None</td>
            <td></td>
            <td>None</td>
            <td>None</td>
            <td>None</td>
            <td>2024-03-19 07:11:39.245159-03:00</td>
            <td>None</td>
            <td>None</td>
            <td>None</td>
            <td>Activity</td>
            <td>AutoVacuumMain</td>
            <td>None</td>
            <td>None</td>
            <td>None</td>
            <td>None</td>
            <td></td>
            <td>autovacuum launcher</td>
        </tr>
        <tr>
            <td>None</td>
            <td>None</td>
            <td>1490</td>
            <td>None</td>
            <td>10</td>
            <td>postgres</td>
            <td></td>
            <td>None</td>
            <td>None</td>
            <td>None</td>
            <td>2024-03-19 07:11:39.245691-03:00</td>
            <td>None</td>
            <td>None</td>
            <td>None</td>
            <td>Activity</td>
            <td>LogicalLauncherMain</td>
            <td>None</td>
            <td>None</td>
            <td>None</td>
            <td>None</td>
            <td></td>
            <td>logical replication launcher</td>
        </tr>
        <tr>
            <td>17998</td>
            <td>bd_censo_ibge</td>
            <td>42002</td>
            <td>None</td>
            <td>10</td>
            <td>postgres</td>
            <td></td>
            <td>127.0.0.1</td>
            <td>None</td>
            <td>54848</td>
            <td>2024-03-19 18:38:38.290414-03:00</td>
            <td>None</td>
            <td>None</td>
            <td>2024-03-19 18:38:38.306434-03:00</td>
            <td>Client</td>
            <td>ClientRead</td>
            <td>idle</td>
            <td>None</td>
            <td>None</td>
            <td>None</td>
            <td></td>
            <td>client backend</td>
        </tr>
        <tr>
            <td>17998</td>
            <td>bd_censo_ibge</td>
            <td>42007</td>
            <td>None</td>
            <td>10</td>
            <td>postgres</td>
            <td></td>
            <td>127.0.0.1</td>
            <td>None</td>
            <td>54856</td>
            <td>2024-03-19 18:38:38.730895-03:00</td>
            <td>2024-03-19 18:38:38.824317-03:00</td>
            <td>2024-03-19 18:38:38.824427-03:00</td>
            <td>2024-03-19 18:38:38.824428-03:00</td>
            <td>None</td>
            <td>None</td>
            <td>active</td>
            <td>None</td>
            <td>1352</td>
            <td>None</td>
            <td>SELECT * <br>FROM pg_stat_activity;</td>
            <td>client backend</td>
        </tr>
        <tr>
            <td>None</td>
            <td>None</td>
            <td>1482</td>
            <td>None</td>
            <td>None</td>
            <td>None</td>
            <td></td>
            <td>None</td>
            <td>None</td>
            <td>None</td>
            <td>2024-03-19 07:11:39.207509-03:00</td>
            <td>None</td>
            <td>None</td>
            <td>None</td>
            <td>Activity</td>
            <td>BgWriterHibernate</td>
            <td>None</td>
            <td>None</td>
            <td>None</td>
            <td>None</td>
            <td></td>
            <td>background writer</td>
        </tr>
        <tr>
            <td>None</td>
            <td>None</td>
            <td>1481</td>
            <td>None</td>
            <td>None</td>
            <td>None</td>
            <td></td>
            <td>None</td>
            <td>None</td>
            <td>None</td>
            <td>2024-03-19 07:11:39.206815-03:00</td>
            <td>None</td>
            <td>None</td>
            <td>None</td>
            <td>Activity</td>
            <td>CheckpointerMain</td>
            <td>None</td>
            <td>None</td>
            <td>None</td>
            <td>None</td>
            <td></td>
            <td>checkpointer</td>
        </tr>
        <tr>
            <td>None</td>
            <td>None</td>
            <td>1488</td>
            <td>None</td>
            <td>None</td>
            <td>None</td>
            <td></td>
            <td>None</td>
            <td>None</td>
            <td>None</td>
            <td>2024-03-19 07:11:39.244501-03:00</td>
            <td>None</td>
            <td>None</td>
            <td>None</td>
            <td>Activity</td>
            <td>WalWriterMain</td>
            <td>None</td>
            <td>None</td>
            <td>None</td>
            <td>None</td>
            <td></td>
            <td>walwriter</td>
        </tr>
    </tbody>
</table></div></div>
</div>
<ul class="simple">
<li><p>Consultar Índices Existentes</p></li>
</ul>
<p><strong>Objetivo:</strong> Revisar índices já existentes no esquema <code class="docutils literal notranslate"><span class="pre">public</span></code> para otimizar a criação de novos índices e melhorar a eficiência das consultas.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span> 
SELECT * 
FROM pg_indexes 
WHERE schemaname = &#39;public&#39;;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
0 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>schemaname</th>
            <th>tablename</th>
            <th>indexname</th>
            <th>tablespace</th>
            <th>indexdef</th>
        </tr>
    </thead>
    <tbody>
    </tbody>
</table></div></div>
</div>
<p>Ainda não temos nenhum índice definido em nosso banco de dados. Criaremos índices ao longo deste capítulo.</p>
</div>
<div class="section" id="categorias-fundamentais-da-linguagem-sql-ddl-dml-e-dcl">
<h2>2.4 Categorias fundamentais da linguagem SQL: DDL, DML e DCL<a class="headerlink" href="#categorias-fundamentais-da-linguagem-sql-ddl-dml-e-dcl" title="Permalink to this heading">#</a></h2>
<p>A interação com um Sistema de Gerenciamento de Banco de Dados Relacional (SGBD Relacional) envolve vários passos e componentes, seguindo princípios gerais que permitem a armazenagem, a manipulação e a recuperação de dados. Essa interação geralmente ocorre em um ciclo contínuo de definição, manipulação e controle de dados.</p>
<p>O primeiro passo na interação com um SGBD relacional é definir o esquema do banco de dados. Isso envolve especificar as estruturas que armazenarão os dados, conhecidas como tabelas, que são organizadas em colunas e linhas. Cada coluna em uma tabela representa um campo de dados (como nome, idade, endereço), enquanto cada linha representa um registro específico. Este processo de definição é realizado utilizando uma linguagem de definição de dados (DDL, Data Definition Language), que permite criar, modificar e remover tabelas e outros objetos do banco de dados.</p>
<p>Após a definição das estruturas de dados, o próximo passo é inserir e manipular os dados dentro dessas estruturas. Isso é feito através de uma linguagem de manipulação de dados (DML, Data Manipulation Language), que permite inserir, atualizar, deletar e consultar registros no banco de dados.</p>
<p>A consulta de dados é uma parte fundamental da interação com um SGBD relacional. Usuários e aplicações realizam consultas para recuperar dados específicos com base em critérios de pesquisa. Isso é feito utilizando a cláusula SELECT da DML, que permite especificar exatamente quais dados deseja-se extrair do banco de dados, podendo filtrar, ordenar e agrupar os dados conforme necessário. As consultas podem ser simples, buscando dados de uma única tabela, ou complexas, envolvendo a junção de múltiplas tabelas e a aplicação de funções agregadas.</p>
<p>O controle de acesso e a gestão de transações são aspectos de grande relevância na interação com SGBDs relacionais. O controle de acesso é gerido por meio de uma linguagem de controle de dados (DCL, Data Control Language), que define quem pode acessar e manipular os dados. As transações, por outro lado, permitem que múltiplas operações de banco de dados sejam executadas como uma única unidade de trabalho, garantindo que todas as operações sejam concluídas com sucesso ou que nenhuma seja aplicada em caso de falha em uma das operações.</p>
<div class="section" id="linguagem-de-definicao-de-dados-data-definition-language-ddl">
<h3>2.4.1 Linguagem de definição de dados (Data Definition Language - DDL)<a class="headerlink" href="#linguagem-de-definicao-de-dados-data-definition-language-ddl" title="Permalink to this heading">#</a></h3>
<p>A linguagem de definição de dados é um subconjunto da linguagem SQL que lida com a definição e a modificação da estrutura de uma base de dados e dos objetos nela contidos, como tabelas, índices e restrições. Os comandos DDL mais comuns são CREATE, ALTER e DROP.</p>
<p><strong>Comando <code class="docutils literal notranslate"><span class="pre">CREATE</span></code></strong></p>
<p>O comando <code class="docutils literal notranslate"><span class="pre">CREATE</span></code> é utilizado para criar um novo objeto no banco de dados. Por exemplo, para criar uma tabela, você usaria a seguinte sintaxe:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- Criação de Tabela</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">nome_tabela</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">coluna1</span><span class="w"> </span><span class="n">tipo_dado</span><span class="w"> </span><span class="n">restrição</span><span class="p">,</span>
<span class="w">    </span><span class="n">coluna2</span><span class="w"> </span><span class="n">tipo_dado</span><span class="w"> </span><span class="n">restrição</span><span class="p">,</span>
<span class="w">    </span><span class="p">...</span>
<span class="p">);</span>
</pre></div>
</div>
<p>Cada coluna é definida com um nome, um tipo de dado, e opcionalmente, uma ou mais restrições (constraints).</p>
<ul class="simple">
<li><p>Criação da Tabela <code class="docutils literal notranslate"><span class="pre">censo_ibge</span></code>:</p></li>
</ul>
<p>A seguir, temos a consulta para criar a tabela <code class="docutils literal notranslate"><span class="pre">censo_ibge</span></code>, que armazenará dados do censo do IBGE, incluindo informações municipais, população e codificações geográficas.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
CREATE TABLE &quot;censo_mun&quot; (
  &quot;cd_geocodi&quot; int PRIMARY KEY,
  &quot;nome_mun&quot; varchar,
  &quot;area_km2&quot; float,
  &quot;popul_2010&quot; int,
  &quot;popul_2022&quot; int,
  &quot;cod_rgi&quot; int,
  &quot;cod_rgint&quot; int,
  &quot;cod_uf&quot; int
);
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
Done.
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[]
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Verificação do Banco de Dados
Após a criação da tabela, é importante verificar a existência e a contagem das tabelas no banco de dados, garantindo que a operação foi bem-sucedida.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
SELECT COUNT(*) 
FROM information_schema.tables 
WHERE table_schema = &#39;public&#39;;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
1 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>count</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>1</td>
        </tr>
    </tbody>
</table></div></div>
</div>
<p>Para verificar se a tabela <code class="docutils literal notranslate"><span class="pre">censo_mun</span></code> foi criada no banco de dados:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
SELECT *
FROM information_schema.tables 
WHERE table_schema = &#39;public&#39;;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
1 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>table_catalog</th>
            <th>table_schema</th>
            <th>table_name</th>
            <th>table_type</th>
            <th>self_referencing_column_name</th>
            <th>reference_generation</th>
            <th>user_defined_type_catalog</th>
            <th>user_defined_type_schema</th>
            <th>user_defined_type_name</th>
            <th>is_insertable_into</th>
            <th>is_typed</th>
            <th>commit_action</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>bd_censo_ibge</td>
            <td>public</td>
            <td>censo_mun</td>
            <td>BASE TABLE</td>
            <td>None</td>
            <td>None</td>
            <td>None</td>
            <td>None</td>
            <td>None</td>
            <td>YES</td>
            <td>NO</td>
            <td>None</td>
        </tr>
    </tbody>
</table></div></div>
</div>
<p>Para examinar a estrutura da tabela <code class="docutils literal notranslate"><span class="pre">censo_mun</span></code></p>
<p>Vamos examinar a estrutura da tabela, incluindo nomes de colunas, tipos de dados e outras propriedades.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
SELECT column_name, data_type, is_nullable, column_default
FROM information_schema.columns
WHERE table_name = &#39;censo_mun&#39;;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
8 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>column_name</th>
            <th>data_type</th>
            <th>is_nullable</th>
            <th>column_default</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>cod_uf</td>
            <td>integer</td>
            <td>YES</td>
            <td>None</td>
        </tr>
        <tr>
            <td>cd_geocodi</td>
            <td>integer</td>
            <td>NO</td>
            <td>None</td>
        </tr>
        <tr>
            <td>area_km2</td>
            <td>double precision</td>
            <td>YES</td>
            <td>None</td>
        </tr>
        <tr>
            <td>popul_2010</td>
            <td>integer</td>
            <td>YES</td>
            <td>None</td>
        </tr>
        <tr>
            <td>popul_2022</td>
            <td>integer</td>
            <td>YES</td>
            <td>None</td>
        </tr>
        <tr>
            <td>cod_rgi</td>
            <td>integer</td>
            <td>YES</td>
            <td>None</td>
        </tr>
        <tr>
            <td>cod_rgint</td>
            <td>integer</td>
            <td>YES</td>
            <td>None</td>
        </tr>
        <tr>
            <td>nome_mun</td>
            <td>character varying</td>
            <td>YES</td>
            <td>None</td>
        </tr>
    </tbody>
</table></div></div>
</div>
<ul class="simple">
<li><p>Criação das demais tabelas de nosso banco de dados</p></li>
</ul>
<p>Finalmente, procedemos com a criação de tabelas adicionais que formarão a estrutura de suporte para os dados do censo, incluindo regiões imediatas, regiões intermediárias, estados e regiões. Essas tabelas são essenciais para representar a estrutura geográfica e administrativa dentro do banco de dados.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
CREATE TABLE &quot;regiao_imed&quot; (
  &quot;cod_rgi&quot; int PRIMARY KEY,
  &quot;nome_rgi&quot; varchar,
  &quot;cod_rgint&quot; int
);

CREATE TABLE &quot;regiao_inter&quot; (
  &quot;cod_rgint&quot; int PRIMARY KEY,
  &quot;nome_rgint&quot; varchar,
  &quot;cod_uf&quot; int
);

CREATE TABLE &quot;estado&quot; (
  &quot;cod_uf&quot; int PRIMARY KEY,
  &quot;nome_uf&quot; varchar,
  &quot;sigla_uf&quot; varchar,
  &quot;cod_rg&quot; int
);

CREATE TABLE &quot;regiao&quot; (
  &quot;cod_rg&quot; int PRIMARY KEY,
  &quot;nome_rg&quot; varchar
);
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
Done.
Done.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Done.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Done.
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[]
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Verificação das Tabelas no Banco de Dados</p></li>
</ul>
<p>Após a criação dessas tabelas, é importante verificar se elas foram devidamente criadas e estão presentes no banco de dados. Para isso, utilize a seguinte consulta SQL:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
SELECT table_name 
FROM information_schema.tables 
WHERE table_schema = &#39;public&#39;;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>5 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>table_name</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>censo_mun</td>
        </tr>
        <tr>
            <td>regiao_imed</td>
        </tr>
        <tr>
            <td>regiao_inter</td>
        </tr>
        <tr>
            <td>estado</td>
        </tr>
        <tr>
            <td>regiao</td>
        </tr>
    </tbody>
</table></div></div>
</div>
<p>Esta consulta listará todas as tabelas existentes no esquema <code class="docutils literal notranslate"><span class="pre">public</span></code> do banco de dados, permitindo que você confirme a presença das tabelas recém-criadas.</p>
<p><strong>Comando <code class="docutils literal notranslate"><span class="pre">ALTER</span></code></strong></p>
<p>O comando <code class="docutils literal notranslate"><span class="pre">ALTER</span></code> é utilizado para modificar a estrutura de um objeto de banco de dados existente. Por exemplo, para adicionar uma coluna a uma tabela existente, você usaria a seguinte sintaxe:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">nome_tabela</span>
<span class="k">ADD</span><span class="w"> </span><span class="n">nome_coluna</span><span class="w"> </span><span class="n">tipo_dado</span><span class="w"> </span><span class="n">restrição</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Adicionando uma coluna à tabela</p></li>
</ul>
<p>Para adicionar uma nova coluna à tabela <code class="docutils literal notranslate"><span class="pre">censo_mun</span></code>, especificamente a coluna <code class="docutils literal notranslate"><span class="pre">dens_pop</span></code> que armazenará dados sobre a densidade populacional de cada município com o tipo de dado <code class="docutils literal notranslate"><span class="pre">float</span></code>, utilize a seguinte instrução SQL:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
ALTER TABLE censo_mun
ADD COLUMN dens_pop float;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Done.
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[]
</pre></div>
</div>
</div>
</div>
<p>Para modificar uma coluna existente, alterando seu tipo de dado:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">nome_tabela</span>
<span class="k">ALTER</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="n">nome_coluna</span><span class="w"> </span><span class="k">TYPE</span><span class="w"> </span><span class="n">novo_tipo_dado</span><span class="p">;</span>
</pre></div>
</div>
<p>Por exemplo, para mudar o tipo de dado da coluna <code class="docutils literal notranslate"><span class="pre">dens_pop</span></code> na tabela <code class="docutils literal notranslate"><span class="pre">censo_mun</span></code> para <code class="docutils literal notranslate"><span class="pre">numeric</span></code> com precisão específica:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
ALTER TABLE censo_mun
ALTER COLUMN dens_pop TYPE numeric(10, 2);
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Done.
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[]
</pre></div>
</div>
</div>
</div>
<p>Para remover uma coluna:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">nome_tabela</span>
<span class="k">DROP</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="n">nome_coluna</span><span class="p">;</span>
</pre></div>
</div>
<p>Para deletar a coluna <code class="docutils literal notranslate"><span class="pre">dens_pop</span></code> da tabela <code class="docutils literal notranslate"><span class="pre">censo_mun</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
ALTER TABLE censo_mun
DROP COLUMN dens_pop;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
Done.
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[]
</pre></div>
</div>
</div>
</div>
<p>Após qualquer operação <code class="docutils literal notranslate"><span class="pre">ALTER</span></code>, é importante verificar a estrutura atualizada da tabela para confirmar as alterações. Utilize a consulta SQL a seguir para examinar a estrutura da tabela <code class="docutils literal notranslate"><span class="pre">censo_mun</span></code>, incluindo nomes de colunas, tipos de dados e outras propriedades relevantes:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
SELECT column_name, data_type, is_nullable, column_default
FROM information_schema.columns
WHERE table_name = &#39;censo_mun&#39;;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>8 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>column_name</th>
            <th>data_type</th>
            <th>is_nullable</th>
            <th>column_default</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>cod_uf</td>
            <td>integer</td>
            <td>YES</td>
            <td>None</td>
        </tr>
        <tr>
            <td>cd_geocodi</td>
            <td>integer</td>
            <td>NO</td>
            <td>None</td>
        </tr>
        <tr>
            <td>area_km2</td>
            <td>double precision</td>
            <td>YES</td>
            <td>None</td>
        </tr>
        <tr>
            <td>popul_2010</td>
            <td>integer</td>
            <td>YES</td>
            <td>None</td>
        </tr>
        <tr>
            <td>popul_2022</td>
            <td>integer</td>
            <td>YES</td>
            <td>None</td>
        </tr>
        <tr>
            <td>cod_rgi</td>
            <td>integer</td>
            <td>YES</td>
            <td>None</td>
        </tr>
        <tr>
            <td>cod_rgint</td>
            <td>integer</td>
            <td>YES</td>
            <td>None</td>
        </tr>
        <tr>
            <td>nome_mun</td>
            <td>character varying</td>
            <td>YES</td>
            <td>None</td>
        </tr>
    </tbody>
</table></div></div>
</div>
<p>Estas instruções permitem modificar a estrutura de tabelas de maneira dinâmica, adaptando-se às necessidades de armazenamento de dados e às mudanças nos requisitos de análise. Lembre-se sempre de verificar a estrutura da tabela após realizar alterações para assegurar que as modificações foram aplicadas corretamente.</p>
<ul class="simple">
<li><p>Usando Alter Table para estabelecer relações com chaves estrangeiras</p></li>
</ul>
<p>Chaves estrangeiras são um conceito fundamental em sistemas de gerenciamento de banco de dados relacionais (SGBDR), atuando como um pilar essencial para manter a integridade dos dados e estabelecer relações entre diferentes tabelas. Uma chave estrangeira em uma tabela é um campo (ou conjunto de campos) que aponta para a chave primária de outra tabela. O principal objetivo de uma chave estrangeira é garantir a integridade referencial entre duas tabelas, assegurando que o relacionamento entre elas permaneça consistente e confiável.</p>
<p>Na linguagem SQL, o comando <code class="docutils literal notranslate"><span class="pre">ALTER</span> <span class="pre">TABLE</span></code> pode ser utilizado para adicionar uma restrição de chave estrangeira à tabela secundária, conforme o exemplo a seguir:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">tabela_secundaria</span>
<span class="k">ADD</span><span class="w"> </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">coluna_chave_estrangeira</span><span class="p">)</span>
<span class="k">REFERENCES</span><span class="w"> </span><span class="n">tabela_primaria</span><span class="p">(</span><span class="n">coluna_chave_primaria</span><span class="p">);</span>
</pre></div>
</div>
<p>Este comando estabelece a relação entre as tabelas, indicando que a <code class="docutils literal notranslate"><span class="pre">coluna_chave_estrangeira</span></code> na <code class="docutils literal notranslate"><span class="pre">tabela_secundaria</span></code> é uma chave estrangeira que aponta para a <code class="docutils literal notranslate"><span class="pre">coluna_chave_primaria</span></code> na <code class="docutils literal notranslate"><span class="pre">tabela_primaria</span></code>.</p>
<p>Para adicionar as chaves estrangeiras às tabelas, de acordo com o modelo lógico:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
ALTER TABLE &quot;censo_mun&quot; ADD FOREIGN KEY (&quot;cod_rgi&quot;) REFERENCES &quot;regiao_imed&quot; (&quot;cod_rgi&quot;);
ALTER TABLE &quot;censo_mun&quot; ADD FOREIGN KEY (&quot;cod_rgint&quot;) REFERENCES &quot;regiao_inter&quot; (&quot;cod_rgint&quot;);
ALTER TABLE &quot;ALTER TABLE &quot;censo_mun&quot; ADD FOREIGN KEY (&quot;cod_rgint&quot;) REFERENCES &quot;regiao_inter&quot; (&quot;cod_rgint&quot;);&quot; ADD FOREIGN KEY (&quot;cod_uf&quot;) REFERENCES &quot;estado&quot; (&quot;cod_uf&quot;);
ALTER TABLE &quot;regiao_imed&quot; ADD FOREIGN KEY (&quot;cod_rgint&quot;) REFERENCES &quot;regiao_inter&quot; (&quot;cod_rgint&quot;);
ALTER TABLE &quot;regiao_inter&quot; ADD FOREIGN KEY (&quot;cod_uf&quot;) REFERENCES &quot;estado&quot; (&quot;cod_uf&quot;);
ALTER TABLE &quot;estado&quot; ADD FOREIGN KEY (&quot;cod_rg&quot;) REFERENCES &quot;regiao&quot; (&quot;cod_rg&quot;);
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Done.
Done.
(psycopg2.errors.SyntaxError) syntax error at or near &quot;censo_mun&quot;
LINE 1: ALTER TABLE &quot;ALTER TABLE &quot;censo_mun&quot; ADD FOREIGN KEY (&quot;cod_r...
                                  ^

[SQL: ALTER TABLE &quot;ALTER TABLE &quot;censo_mun&quot; ADD FOREIGN KEY (&quot;cod_rgint&quot;) REFERENCES &quot;regiao_inter&quot; (&quot;cod_rgint&quot;);&quot; ADD FOREIGN KEY (&quot;cod_uf&quot;) REFERENCES &quot;estado&quot; (&quot;cod_uf&quot;);]
(Background on this error at: https://sqlalche.me/e/20/f405)
</pre></div>
</div>
</div>
</div>
<p>Estes comandos adicionam chaves estrangeiras às tabelas <code class="docutils literal notranslate"><span class="pre">censo_mun</span></code>, <code class="docutils literal notranslate"><span class="pre">regiao_imed</span></code>, <code class="docutils literal notranslate"><span class="pre">regiao_inter</span></code>, <code class="docutils literal notranslate"><span class="pre">estado</span></code> e <code class="docutils literal notranslate"><span class="pre">regiao</span></code>, estabelecendo relações “muitos para um” entre essas tabelas. Isso garante a integridade dos dados, assegurando que os valores nas colunas de chaves estrangeiras correspondam aos valores existentes nas colunas de chaves primárias das tabelas referenciadas.</p>
<p>Ao adicionar essas chaves estrangeiras, criamos um banco de dados mais estruturado e normalizado, facilitando a manutenção da consistência dos dados e permitindo consultas mais eficientes através das relações estabelecidas.</p>
<p><strong>Comando <code class="docutils literal notranslate"><span class="pre">DROP</span></code></strong></p>
<p>O comando <code class="docutils literal notranslate"><span class="pre">DROP</span></code> é usado para remover objetos do banco de dados. Este comando deve ser usado com cuidado, pois remove o objeto e todos os dados associados de forma irreversível.</p>
<p>Para excluir uma tabela inteira, podemos fazer:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">DROP</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">nome_tabela</span><span class="p">;</span>
</pre></div>
</div>
<p>Por exemplo, para deletar a tabela <code class="docutils literal notranslate"><span class="pre">censo_mun</span></code> completamente do banco de dados, utilizamos a seguinte instrução SQL:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
DROP TABLE censo_mun;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
Done.
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[]
</pre></div>
</div>
</div>
</div>
<p>Esta instrução <code class="docutils literal notranslate"><span class="pre">DROP</span> <span class="pre">TABLE</span></code> remove a tabela <code class="docutils literal notranslate"><span class="pre">censo_mun</span></code> e todos os dados associados a ela de forma irreversível. Antes de executar este comando, é importante garantir que a tabela e os dados contidos nela não são mais necessários, ou que você possui um backup apropriado, pois a operação é permanente.</p>
<p>Após remover a tabela, é uma boa prática verificar se a operação foi bem-sucedida:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
SELECT EXISTS (
  SELECT FROM information_schema.tables 
  WHERE table_name = &#39;censo_mun&#39;
);
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
1 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>exists</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>False</td>
        </tr>
    </tbody>
</table></div></div>
</div>
<p>Esta consulta retorna um valor booleano (<code class="docutils literal notranslate"><span class="pre">TRUE</span></code> ou <code class="docutils literal notranslate"><span class="pre">FALSE</span></code>), indicando se a tabela <code class="docutils literal notranslate"><span class="pre">censo_mun</span></code> ainda existe no banco de dados. Se o resultado for <code class="docutils literal notranslate"><span class="pre">FALSE</span></code>, a tabela foi apagada com sucesso.</p>
<p>Após a remoção, você pode recriar a tabela <code class="docutils literal notranslate"><span class="pre">censo_mun</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
CREATE TABLE &quot;censo_mun&quot; (
  &quot;cd_geocodi&quot; int PRIMARY KEY,
  &quot;nome_mun&quot; varchar,
  &quot;area_km2&quot; float,
  &quot;popul_2010&quot; int,
  &quot;popul_2022&quot; int,
  &quot;cod_rgi&quot; int,
  &quot;cod_rgint&quot; int,
  &quot;cod_uf&quot; int
);
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
Done.
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[]
</pre></div>
</div>
</div>
</div>
<p>Após a recriação da tabela, é essencial redefinir as chaves estrangeiras:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
ALTER TABLE &quot;censo_mun&quot; ADD FOREIGN KEY (&quot;cod_rgi&quot;) REFERENCES &quot;regiao_imed&quot; (&quot;cod_rgi&quot;);
ALTER TABLE &quot;censo_mun&quot; ADD FOREIGN KEY (&quot;cod_rgint&quot;) REFERENCES &quot;regiao_inter&quot; (&quot;cod_rgint&quot;);
ALTER TABLE &quot;censo_mun&quot; ADD FOREIGN KEY (&quot;cod_uf&quot;) REFERENCES &quot;estado&quot; (&quot;cod_uf&quot;);
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Done.
Done.
Done.
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[]
</pre></div>
</div>
</div>
</div>
<p>Estas instruções reestabelecem as relações de chave estrangeira para a tabela <code class="docutils literal notranslate"><span class="pre">censo_mun</span></code>, assegurando a integridade referencial e as relações corretas com as outras tabelas no banco de dados.</p>
</div>
<div class="section" id="linguagem-de-manipulacao-de-dados-data-manipulation-language-dml">
<h3>2.4.2 Linguagem de Manipulação de Dados (Data Manipulation Language - DML)<a class="headerlink" href="#linguagem-de-manipulacao-de-dados-data-manipulation-language-dml" title="Permalink to this heading">#</a></h3>
<p>A Linguagem de manipulação de dados (DML) é um conjunto de linguagens de banco de dados usadas para recuperar, inserir, modificar e excluir dados em um banco de dados. Os principais comandos da DML são <code class="docutils literal notranslate"><span class="pre">SELECT</span></code>, <code class="docutils literal notranslate"><span class="pre">INSERT</span></code>, <code class="docutils literal notranslate"><span class="pre">UPDATE</span></code>, e <code class="docutils literal notranslate"><span class="pre">DELETE</span></code>, fundamentais para a manipulação de dados em bancos de dados relacionais e formando a base das operações de CRUD (Create, Read, Update, Delete).</p>
<p><strong>Comando SELECT</strong></p>
<p>O comando <code class="docutils literal notranslate"><span class="pre">SELECT</span></code> é usado para consultar e recuperar dados de uma ou mais tabelas. A sintaxe básica é:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">coluna1</span><span class="p">,</span><span class="w"> </span><span class="n">coluna2</span><span class="p">,</span><span class="w"> </span><span class="p">...</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">nome_tabela</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">condição</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">SELECT</span></code>: especifica as colunas que serão retornadas na consulta.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">FROM</span></code>: indica a tabela de onde os dados serão recuperados.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">WHERE</span></code>: filtra os dados de acordo com uma condição especificada (opcional).</p></li>
</ul>
<p><strong>Comando INSERT</strong></p>
<p>O comando <code class="docutils literal notranslate"><span class="pre">INSERT</span></code> é usado para inserir novos dados em uma tabela. A sintaxe básica é:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">nome_tabela</span><span class="w"> </span><span class="p">(</span><span class="n">coluna1</span><span class="p">,</span><span class="w"> </span><span class="n">coluna2</span><span class="p">,</span><span class="w"> </span><span class="n">coluna3</span><span class="p">,</span><span class="w"> </span><span class="p">...)</span>
<span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="n">valor1</span><span class="p">,</span><span class="w"> </span><span class="n">valor2</span><span class="p">,</span><span class="w"> </span><span class="n">valor3</span><span class="p">,</span><span class="w"> </span><span class="p">...);</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">INSERT</span> <span class="pre">INTO</span></code>: indica a tabela na qual os dados serão inseridos.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">(column1,</span> <span class="pre">column2,</span> <span class="pre">...)</span></code>: especifica as colunas que receberão os dados.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">VALUES</span></code>: indica os dados que serão inseridos em cada coluna.</p></li>
</ul>
<p>Inicialmente, vamos popular a tabela <code class="docutils literal notranslate"><span class="pre">regiao</span></code> com os dados referentes às regiões do Brasil:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
INSERT INTO regiao (cod_rg, nome_rg) VALUES
(1, &#39;Norte&#39;),
(2, &#39;Nordeste&#39;),
(3, &#39;Sudeste&#39;),
(4, &#39;Sul&#39;),
(5, &#39;Centro-Oeste&#39;);
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>5 rows affected.
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[]
</pre></div>
</div>
</div>
</div>
<p>Para verificar o conteúdo da tabela <code class="docutils literal notranslate"><span class="pre">regiao</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
SELECT * FROM regiao;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>5 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>cod_rg</th>
            <th>nome_rg</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>1</td>
            <td>Norte</td>
        </tr>
        <tr>
            <td>2</td>
            <td>Nordeste</td>
        </tr>
        <tr>
            <td>3</td>
            <td>Sudeste</td>
        </tr>
        <tr>
            <td>4</td>
            <td>Sul</td>
        </tr>
        <tr>
            <td>5</td>
            <td>Centro-Oeste</td>
        </tr>
    </tbody>
</table></div></div>
</div>
<p>Populando a tabela “estado” com os estados do Brasil:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
INSERT INTO estado (cod_uf, nome_uf, sigla_uf, cod_rg) VALUES
(11, &#39;Rondônia&#39;, &#39;RO&#39;, 1),
(12, &#39;Acre&#39;, &#39;AC&#39;, 1),
(13, &#39;Amazonas&#39;, &#39;AM&#39;, 1),
(14, &#39;Roraima&#39;, &#39;RR&#39;, 1),
(15, &#39;Pará&#39;, &#39;PA&#39;, 1),
(16, &#39;Amapá&#39;, &#39;AP&#39;, 1),
(17, &#39;Tocantins&#39;, &#39;TO&#39;, 1),
(21, &#39;Maranhão&#39;, &#39;MA&#39;, 2),
(22, &#39;Piauí&#39;, &#39;PI&#39;, 2),
(23, &#39;Ceará&#39;, &#39;CE&#39;, 2),
(24, &#39;Rio Grande do Norte&#39;, &#39;RN&#39;, 2),
(25, &#39;Paraíba&#39;, &#39;PB&#39;, 2),
(26, &#39;Pernambuco&#39;, &#39;PE&#39;, 2),
(27, &#39;Alagoas&#39;, &#39;AL&#39;, 2),
(28, &#39;Sergipe&#39;, &#39;SE&#39;, 2),
(29, &#39;Bahia&#39;, &#39;BA&#39;, 2),
(31, &#39;Minas Gerais&#39;, &#39;MG&#39;, 3),
(32, &#39;Espírito Santo&#39;, &#39;ES&#39;, 3),
(33, &#39;Rio de Janeiro&#39;, &#39;RJ&#39;, 3),
(35, &#39;São Paulo&#39;, &#39;SP&#39;, 3),
(41, &#39;Paraná&#39;, &#39;PR&#39;, 4),
(42, &#39;Santa Catarina&#39;, &#39;SC&#39;, 4),
(43, &#39;Rio Grande do Sul&#39;, &#39;RS&#39;, 4),
(50, &#39;Mato Grosso do Sul&#39;, &#39;MS&#39;, 5),
(51, &#39;Mato Grosso&#39;, &#39;MT&#39;, 5),
(52, &#39;Goiás&#39;, &#39;GO&#39;, 5),
(53, &#39;Distrito Federal&#39;, &#39;DF&#39;, 5);
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>27 rows affected.
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[]
</pre></div>
</div>
</div>
</div>
<p>Para verificar o conteúdo da tabela <code class="docutils literal notranslate"><span class="pre">estado</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
SELECT * FROM estado;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
27 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>cod_uf</th>
            <th>nome_uf</th>
            <th>sigla_uf</th>
            <th>cod_rg</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>11</td>
            <td>Rondônia</td>
            <td>RO</td>
            <td>1</td>
        </tr>
        <tr>
            <td>12</td>
            <td>Acre</td>
            <td>AC</td>
            <td>1</td>
        </tr>
        <tr>
            <td>13</td>
            <td>Amazonas</td>
            <td>AM</td>
            <td>1</td>
        </tr>
        <tr>
            <td>14</td>
            <td>Roraima</td>
            <td>RR</td>
            <td>1</td>
        </tr>
        <tr>
            <td>15</td>
            <td>Pará</td>
            <td>PA</td>
            <td>1</td>
        </tr>
        <tr>
            <td>16</td>
            <td>Amapá</td>
            <td>AP</td>
            <td>1</td>
        </tr>
        <tr>
            <td>17</td>
            <td>Tocantins</td>
            <td>TO</td>
            <td>1</td>
        </tr>
        <tr>
            <td>21</td>
            <td>Maranhão</td>
            <td>MA</td>
            <td>2</td>
        </tr>
        <tr>
            <td>22</td>
            <td>Piauí</td>
            <td>PI</td>
            <td>2</td>
        </tr>
        <tr>
            <td>23</td>
            <td>Ceará</td>
            <td>CE</td>
            <td>2</td>
        </tr>
        <tr>
            <td>24</td>
            <td>Rio Grande do Norte</td>
            <td>RN</td>
            <td>2</td>
        </tr>
        <tr>
            <td>25</td>
            <td>Paraíba</td>
            <td>PB</td>
            <td>2</td>
        </tr>
        <tr>
            <td>26</td>
            <td>Pernambuco</td>
            <td>PE</td>
            <td>2</td>
        </tr>
        <tr>
            <td>27</td>
            <td>Alagoas</td>
            <td>AL</td>
            <td>2</td>
        </tr>
        <tr>
            <td>28</td>
            <td>Sergipe</td>
            <td>SE</td>
            <td>2</td>
        </tr>
        <tr>
            <td>29</td>
            <td>Bahia</td>
            <td>BA</td>
            <td>2</td>
        </tr>
        <tr>
            <td>31</td>
            <td>Minas Gerais</td>
            <td>MG</td>
            <td>3</td>
        </tr>
        <tr>
            <td>32</td>
            <td>Espírito Santo</td>
            <td>ES</td>
            <td>3</td>
        </tr>
        <tr>
            <td>33</td>
            <td>Rio de Janeiro</td>
            <td>RJ</td>
            <td>3</td>
        </tr>
        <tr>
            <td>35</td>
            <td>São Paulo</td>
            <td>SP</td>
            <td>3</td>
        </tr>
        <tr>
            <td>41</td>
            <td>Paraná</td>
            <td>PR</td>
            <td>4</td>
        </tr>
        <tr>
            <td>42</td>
            <td>Santa Catarina</td>
            <td>SC</td>
            <td>4</td>
        </tr>
        <tr>
            <td>43</td>
            <td>Rio Grande do Sul</td>
            <td>RS</td>
            <td>4</td>
        </tr>
        <tr>
            <td>50</td>
            <td>Mato Grosso do Sul</td>
            <td>MS</td>
            <td>5</td>
        </tr>
        <tr>
            <td>51</td>
            <td>Mato Grosso</td>
            <td>MT</td>
            <td>5</td>
        </tr>
        <tr>
            <td>52</td>
            <td>Goiás</td>
            <td>GO</td>
            <td>5</td>
        </tr>
        <tr>
            <td>53</td>
            <td>Distrito Federal</td>
            <td>DF</td>
            <td>5</td>
        </tr>
    </tbody>
</table></div></div>
</div>
<p>Essas instruções de <code class="docutils literal notranslate"><span class="pre">INSERT</span></code> populam as tabelas <code class="docutils literal notranslate"><span class="pre">regiao</span></code> e <code class="docutils literal notranslate"><span class="pre">estado</span></code> com dados representativos das regiões e estados do Brasil, estabelecendo a base de dados para consultas e manipulações subsequentes.</p>
<ul class="simple">
<li><p>Inserindo dados nas tabelas regiao_inter, regiao_imed, e censo_mun</p></li>
</ul>
<p>Quando se trabalha com grandes volumes de dados, como aqueles fornecidos pelo Instituto Brasileiro de Geografia e Estatística (IBGE), é essencial empregar métodos eficientes de manipulação e inserção de dados. As tabelas <code class="docutils literal notranslate"><span class="pre">regiao_inter</span></code>, <code class="docutils literal notranslate"><span class="pre">regiao_imed</span></code>, e <code class="docutils literal notranslate"><span class="pre">censo_mun</span></code> demandam a inserção de um volume significativo de informações detalhadas, tornando o uso direto de comandos <code class="docutils literal notranslate"><span class="pre">INSERT</span></code> via SQL impraticável para essa finalidade.</p>
<p><strong>Preparação dos Dados:</strong></p>
<p>Os dados organizados em tabelas Excel pelo IBGE podem ser acessados e manipulados eficientemente por meio da integração entre o Google Drive e a biblioteca Pandas do Python. Este processo envolve várias etapas, começando com o acesso aos arquivos no Google Drive e culminando com a inserção dos dados no banco de dados.</p>
<p>Para acessar os arquivos Excel armazenados no Google Drive a partir do Google Colab, use o seguinte código para montar o Drive:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">google.colab</span> <span class="kn">import</span> <span class="n">drive</span>
<span class="n">drive</span><span class="o">.</span><span class="n">mount</span><span class="p">(</span><span class="s1">&#39;/content/drive&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Este comando estabelece uma conexão segura entre o Google Colab e o Google Drive, facilitando o acesso aos arquivos necessários.</p>
<p><strong>Carregamento dos dados do Excel em DataFrames do Pandas:</strong></p>
<p>Com os arquivos de dados acessíveis, podemos proceder à leitura e manipulação dos dados com Pandas. Aqui estão os comandos para carregar os dados das regiões intermediárias, regiões imediatas e dados populacionais dos municípios em DataFrames:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># Carregamento dos dados das regiões intermediárias</span>
<span class="n">df_regiao_inter</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s1">&#39;~/bde_book_w/files_bde/regiao_intermediaria.xlsx&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df_regiao_inter</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>

<span class="c1"># Carregamento dos dados das regiões imediatas</span>
<span class="n">df_regiao_imed</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s1">&#39;~/bde_book_w/files_bde/regiao_imediata.xlsx&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df_regiao_imed</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>

<span class="c1"># Carregamento dos dados populacionais dos municípios</span>
<span class="n">df_censo</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s1">&#39;~/bde_book_w/files_bde/censo_municipios.xlsx&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df_censo</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   cod_rgint       nome_rgint  cod_uf
0       1101      Porto Velho      11
1       1102        Ji-Paraná      11
2       1201       Rio Branco      12
3       1202  Cruzeiro do Sul      12
4       1301           Manaus      13
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   cod_rgi     nome_rgi  cod_rgint
0   110001  Porto Velho       1101
1   110002    Ariquemes       1101
2   110003         Jaru       1101
3   110004    Ji-Paraná       1102
4   110005       Cacoal       1102
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   cd_geocodi               nome_mun  area_km2  popul_2022  popul_2010  \
0     1100015  Alta Floresta D&#39;Oeste  7067.127       21558       24392   
1     1100023              Ariquemes  4426.571      100896       90353   
2     1100031                 Cabixi  1314.352        5107        6313   
3     1100049                 Cacoal  3793.000       92202       78574   
4     1100056             Cerejeiras  2783.300       15237       17029   

   cod_rgi  cod_rgint  cod_uf  
0   110005       1102      11  
1   110002       1101      11  
2   110006       1102      11  
3   110005       1102      11  
4   110006       1102      11  
</pre></div>
</div>
</div>
</div>
<p><strong>Verificação das Tabelas do Banco de Dados:</strong></p>
<p>Antes de inserir os dados processados nas tabelas do banco de dados, é prudente verificar seu conteúdo atual:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
-- Verificar regiao_inter
SELECT * FROM regiao_inter;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
0 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>cod_rgint</th>
            <th>nome_rgint</th>
            <th>cod_uf</th>
        </tr>
    </thead>
    <tbody>
    </tbody>
</table></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
-- Verificar regiao_imed
SELECT * FROM regiao_imed;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
0 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>cod_rgi</th>
            <th>nome_rgi</th>
            <th>cod_rgint</th>
        </tr>
    </thead>
    <tbody>
    </tbody>
</table></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
-- Verificar censo_mun
SELECT * FROM censo_mun;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
0 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>cd_geocodi</th>
            <th>nome_mun</th>
            <th>area_km2</th>
            <th>popul_2010</th>
            <th>popul_2022</th>
            <th>cod_rgi</th>
            <th>cod_rgint</th>
            <th>cod_uf</th>
        </tr>
    </thead>
    <tbody>
    </tbody>
</table></div></div>
</div>
<p>Estas consultas SQL permitem verificar se as tabelas do banco de dados estão prontas para receber os dados. Ao confirmar que as tabelas estão vazias ou preparadas para a inserção, podemos proceder com a importação dos dados processados.</p>
<p><strong>Inserindo dados nas tabelas regiao_inter, regiao_imed, e censo_mun:</strong></p>
<p>Nesta etapa, utilizaremos o método <code class="docutils literal notranslate"><span class="pre">to_sql</span></code> da Pandas para inserir os dados dos DataFrames diretamente nas tabelas correspondentes. Este método não só agiliza o processo de inserção de dados como também assegura que eles sejam devidamente organizados e integrados ao sistema de banco de dados, facilitando análises e consultas futuras.</p>
<p><em>Exemplo de Inserção de Dados com Pandas e SQLAlchemy:</em></p>
<p>Para inserir os dados do DataFrame <code class="docutils literal notranslate"><span class="pre">df_regiao_inter</span></code> na tabela <code class="docutils literal notranslate"><span class="pre">regiao_inter</span></code> do banco de dados, utilizamos o seguinte procedimento:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>

<span class="n">dbname</span> <span class="o">=</span> <span class="s1">&#39;bd_censo_ibge&#39;</span>  <span class="c1"># Nome do banco de dados</span>
<span class="n">user</span> <span class="o">=</span> <span class="s1">&#39;postgres&#39;</span>         <span class="c1"># Nome do usuário</span>
<span class="n">password</span> <span class="o">=</span> <span class="s1">&#39;curso_geo&#39;</span>    <span class="c1"># Senha definida anteriormente</span>
<span class="n">host</span> <span class="o">=</span> <span class="s1">&#39;localhost&#39;</span>        <span class="c1"># Endereço do host</span>


<span class="c1"># Criando o motor de conexão com o banco de dados</span>
<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;postgresql://</span><span class="si">{</span><span class="n">user</span><span class="si">}</span><span class="s1">:</span><span class="si">{</span><span class="n">password</span><span class="si">}</span><span class="s1">@</span><span class="si">{</span><span class="n">host</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">dbname</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="c1"># Inserindo os dados na tabela regiao_inter</span>
<span class="n">df_regiao_inter</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="s1">&#39;regiao_inter&#39;</span><span class="p">,</span> <span class="n">con</span><span class="o">=</span><span class="n">engine</span><span class="p">,</span> <span class="n">if_exists</span><span class="o">=</span><span class="s1">&#39;append&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>133
</pre></div>
</div>
</div>
</div>
<p>No código acima:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">df_regiao_inter</span></code>: O DataFrame que contém os dados a serem inseridos.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">to_sql</span></code>: Método do Pandas para inserir o DataFrame em uma tabela SQL.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'regiao_inter'</span></code>: Nome da tabela no banco de dados onde os dados serão inseridos.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">con=engine</span></code>: Conexão ao banco de dados especificada pelo objeto <code class="docutils literal notranslate"><span class="pre">engine</span></code> do SQLAlchemy.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">if_exists='append'</span></code>: Comportamento caso a tabela já exista. Neste caso, os dados serão adicionados ao final da tabela.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">index=False</span></code>: Não inclui o índice do DataFrame como uma coluna na tabela.</p></li>
</ul>
<p>Após a inserção, é importante verificar se os dados foram corretamente adicionados na tabela:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
-- Verificando os dados inseridos em regiao_inter
SELECT * 
FROM regiao_inter
LIMIT 10;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
10 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>cod_rgint</th>
            <th>nome_rgint</th>
            <th>cod_uf</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>1101</td>
            <td>Porto Velho</td>
            <td>11</td>
        </tr>
        <tr>
            <td>1102</td>
            <td>Ji-Paraná</td>
            <td>11</td>
        </tr>
        <tr>
            <td>1201</td>
            <td>Rio Branco</td>
            <td>12</td>
        </tr>
        <tr>
            <td>1202</td>
            <td>Cruzeiro do Sul</td>
            <td>12</td>
        </tr>
        <tr>
            <td>1301</td>
            <td>Manaus</td>
            <td>13</td>
        </tr>
        <tr>
            <td>1302</td>
            <td>Tefé</td>
            <td>13</td>
        </tr>
        <tr>
            <td>1303</td>
            <td>Lábrea</td>
            <td>13</td>
        </tr>
        <tr>
            <td>1304</td>
            <td>Parintins</td>
            <td>13</td>
        </tr>
        <tr>
            <td>1401</td>
            <td>Boa Vista</td>
            <td>14</td>
        </tr>
        <tr>
            <td>1402</td>
            <td>Rorainópolis - Caracaraí</td>
            <td>14</td>
        </tr>
    </tbody>
</table></div></div>
</div>
<p>Vamos realizar o mesmo procedimento para inserir os dados nas tabelas regiao_imed e censo_mun:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Inserindo os dados na tabela</span>
<span class="n">df_regiao_imed</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="s1">&#39;regiao_imed&#39;</span><span class="p">,</span> <span class="n">con</span><span class="o">=</span><span class="n">engine</span><span class="p">,</span> <span class="n">if_exists</span><span class="o">=</span><span class="s1">&#39;append&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>510
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
-- Verificando os dados inseridos em regiao_imed
SELECT * 
FROM regiao_imed
LIMIT 10;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
10 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>cod_rgi</th>
            <th>nome_rgi</th>
            <th>cod_rgint</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>110001</td>
            <td>Porto Velho</td>
            <td>1101</td>
        </tr>
        <tr>
            <td>110002</td>
            <td>Ariquemes</td>
            <td>1101</td>
        </tr>
        <tr>
            <td>110003</td>
            <td>Jaru</td>
            <td>1101</td>
        </tr>
        <tr>
            <td>110004</td>
            <td>Ji-Paraná</td>
            <td>1102</td>
        </tr>
        <tr>
            <td>110005</td>
            <td>Cacoal</td>
            <td>1102</td>
        </tr>
        <tr>
            <td>110006</td>
            <td>Vilhena</td>
            <td>1102</td>
        </tr>
        <tr>
            <td>120001</td>
            <td>Rio Branco</td>
            <td>1201</td>
        </tr>
        <tr>
            <td>120002</td>
            <td>Brasiléia</td>
            <td>1201</td>
        </tr>
        <tr>
            <td>120003</td>
            <td>Sena Madureira</td>
            <td>1201</td>
        </tr>
        <tr>
            <td>120004</td>
            <td>Cruzeiro do Sul</td>
            <td>1202</td>
        </tr>
    </tbody>
</table></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Inserindo os dados na tabela</span>
<span class="n">df_censo</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="s1">&#39;censo_mun&#39;</span><span class="p">,</span> <span class="n">con</span><span class="o">=</span><span class="n">engine</span><span class="p">,</span> <span class="n">if_exists</span><span class="o">=</span><span class="s1">&#39;append&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>570
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
-- Verificando os dados inseridos em censo_mun
SELECT * 
FROM censo_mun
LIMIT 10;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
10 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>cd_geocodi</th>
            <th>nome_mun</th>
            <th>area_km2</th>
            <th>popul_2010</th>
            <th>popul_2022</th>
            <th>cod_rgi</th>
            <th>cod_rgint</th>
            <th>cod_uf</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>1100015</td>
            <td>Alta Floresta D&#x27;Oeste</td>
            <td>7067.127</td>
            <td>24392</td>
            <td>21558</td>
            <td>110005</td>
            <td>1102</td>
            <td>11</td>
        </tr>
        <tr>
            <td>1100023</td>
            <td>Ariquemes</td>
            <td>4426.571</td>
            <td>90353</td>
            <td>100896</td>
            <td>110002</td>
            <td>1101</td>
            <td>11</td>
        </tr>
        <tr>
            <td>1100031</td>
            <td>Cabixi</td>
            <td>1314.352</td>
            <td>6313</td>
            <td>5107</td>
            <td>110006</td>
            <td>1102</td>
            <td>11</td>
        </tr>
        <tr>
            <td>1100049</td>
            <td>Cacoal</td>
            <td>3793.0</td>
            <td>78574</td>
            <td>92202</td>
            <td>110005</td>
            <td>1102</td>
            <td>11</td>
        </tr>
        <tr>
            <td>1100056</td>
            <td>Cerejeiras</td>
            <td>2783.3</td>
            <td>17029</td>
            <td>15237</td>
            <td>110006</td>
            <td>1102</td>
            <td>11</td>
        </tr>
        <tr>
            <td>1100064</td>
            <td>Colorado do Oeste</td>
            <td>1451.06</td>
            <td>18591</td>
            <td>15747</td>
            <td>110006</td>
            <td>1102</td>
            <td>11</td>
        </tr>
        <tr>
            <td>1100072</td>
            <td>Corumbiara</td>
            <td>3060.321</td>
            <td>8783</td>
            <td>7503</td>
            <td>110006</td>
            <td>1102</td>
            <td>11</td>
        </tr>
        <tr>
            <td>1100080</td>
            <td>Costa Marques</td>
            <td>4987.177</td>
            <td>13678</td>
            <td>12633</td>
            <td>110004</td>
            <td>1102</td>
            <td>11</td>
        </tr>
        <tr>
            <td>1100098</td>
            <td>Espigão D&#x27;Oeste</td>
            <td>4518.038</td>
            <td>28729</td>
            <td>29722</td>
            <td>110005</td>
            <td>1102</td>
            <td>11</td>
        </tr>
        <tr>
            <td>1100106</td>
            <td>Guajará-Mirim</td>
            <td>24856.877</td>
            <td>41656</td>
            <td>39396</td>
            <td>110001</td>
            <td>1101</td>
            <td>11</td>
        </tr>
    </tbody>
</table></div></div>
</div>
<p>Este procedimento assegura que os dados foram devidamente organizados e integrados ao sistema de banco de dados, facilitando futuras análises e consultas.</p>
<p><strong>Comando UPDATE</strong></p>
<p>O comando <code class="docutils literal notranslate"><span class="pre">UPDATE</span></code> é utilizado para modificar dados existentes em uma tabela de um banco de dados. A sintaxe básica para usar o comando UPDATE é a seguinte:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">UPDATE</span><span class="w"> </span><span class="n">nome_tabela</span>
<span class="k">SET</span><span class="w"> </span><span class="n">coluna1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">valor1</span><span class="p">,</span><span class="w"> </span><span class="n">coluna2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">valor2</span><span class="p">,</span><span class="w"> </span><span class="p">...</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">condição</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">UPDATE</span></code>: Especifica a tabela onde a modificação será feita.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SET</span></code>: Indica as colunas e os novos valores que serão atualizados.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">WHERE</span></code>: Determina quais linhas serão atualizadas. É opcional, mas altamente recomendado para evitar atualizações indesejadas em toda a tabela.</p></li>
</ul>
<p><em>Exemplo Prático do Comando UPDATE:</em></p>
<p>Para exemplificar o uso do comando <code class="docutils literal notranslate"><span class="pre">UPDATE</span></code>, vamos criar uma nova tabela chamada <code class="docutils literal notranslate"><span class="pre">regiao_copia</span></code> e inserir dados nela:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
CREATE TABLE &quot;regiao_copia&quot; (
  &quot;cod_rg&quot; int PRIMARY KEY,
  &quot;nome_rg&quot; varchar
);
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
Done.
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
INSERT INTO regiao_copia (cod_rg, nome_rg) VALUES
(1, &#39;Norte&#39;),
(2, &#39;Nordeste&#39;),
(3, &#39;Sudeste&#39;),
(4, &#39;Sul&#39;),
(5, &#39;Centro-Oeste&#39;);
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
5 rows affected.
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[]
</pre></div>
</div>
</div>
</div>
<p>Agora, iremos modificar o registro <code class="docutils literal notranslate"><span class="pre">Centro-Oeste</span></code> para <code class="docutils literal notranslate"><span class="pre">centro_oeste</span></code> na tabela <code class="docutils literal notranslate"><span class="pre">regiao_copia</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
UPDATE regiao_copia
SET nome_rg = &#39;centro_oeste&#39;
WHERE nome_rg = &#39;Centro-Oeste&#39;;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
1 rows affected.
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[]
</pre></div>
</div>
</div>
</div>
<p>Este comando atualiza o nome da região <code class="docutils literal notranslate"><span class="pre">Centro-Oeste</span></code> para <code class="docutils literal notranslate"><span class="pre">centro_oeste</span></code>, afetando apenas a linha que corresponde à condição especificada no <code class="docutils literal notranslate"><span class="pre">WHERE</span></code>.</p>
<p>Para verificar se a alteração foi realizada com sucesso, podemos consultar a tabela <code class="docutils literal notranslate"><span class="pre">regiao_copia</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
SELECT * 
FROM regiao_copia;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
5 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>cod_rg</th>
            <th>nome_rg</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>1</td>
            <td>Norte</td>
        </tr>
        <tr>
            <td>2</td>
            <td>Nordeste</td>
        </tr>
        <tr>
            <td>3</td>
            <td>Sudeste</td>
        </tr>
        <tr>
            <td>4</td>
            <td>Sul</td>
        </tr>
        <tr>
            <td>5</td>
            <td>centro_oeste</td>
        </tr>
    </tbody>
</table></div></div>
</div>
<p>Este comando <code class="docutils literal notranslate"><span class="pre">SELECT</span></code> retorna todas as linhas da tabela <code class="docutils literal notranslate"><span class="pre">regiao_copia</span></code>, permitindo verificar se a atualização do nome da região foi efetuada corretamente.</p>
<p>O comando <code class="docutils literal notranslate"><span class="pre">UPDATE</span></code> é essencial para manter os dados atualizados e corretos em um banco de dados, permitindo modificar valores específicos com precisão e segurança.</p>
<p><strong>Comando DELETE</strong></p>
<p>O comando <code class="docutils literal notranslate"><span class="pre">DELETE</span></code> é utilizado para remover registros de uma tabela em um banco de dados. A sintaxe básica para o comando DELETE é:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">DELETE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">nome_tabela</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">condição</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">DELETE</span> <span class="pre">FROM</span></code>: Especifica a tabela da qual os dados serão excluídos.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">WHERE</span></code>: Determina quais linhas serão removidas. É importante usar a cláusula WHERE para evitar a exclusão de todos os dados da tabela inadvertidamente.</p></li>
</ul>
<p><em>Exemplo Prático do Comando DELETE:</em></p>
<p>Utilizando a tabela <code class="docutils literal notranslate"><span class="pre">regiao_copia</span></code> como exemplo, vamos deletar o registro referente à região Sul:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
DELETE FROM regiao_copia
WHERE nome_rg = &#39;Sul&#39;;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
1 rows affected.
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[]
</pre></div>
</div>
</div>
</div>
<p>Este comando remove da tabela <code class="docutils literal notranslate"><span class="pre">regiao_copia</span></code> apenas as linhas que satisfazem a condição especificada, neste caso, onde o nome da região é ‘Sul’.</p>
<p>Para verificar se o registro foi de fato removido, podemos executar uma consulta que retorna todos os registros restantes na tabela:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
SELECT * 
FROM regiao_copia;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
4 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>cod_rg</th>
            <th>nome_rg</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>1</td>
            <td>Norte</td>
        </tr>
        <tr>
            <td>2</td>
            <td>Nordeste</td>
        </tr>
        <tr>
            <td>3</td>
            <td>Sudeste</td>
        </tr>
        <tr>
            <td>5</td>
            <td>centro_oeste</td>
        </tr>
    </tbody>
</table></div></div>
</div>
<p>Este comando <code class="docutils literal notranslate"><span class="pre">SELECT</span></code> exibe os registros remanescentes na tabela <code class="docutils literal notranslate"><span class="pre">regiao_copia</span></code>, permitindo confirmar que a linha correspondente à região Sul foi excluída.</p>
<p>Após realizar as operações necessárias, podemos deletar a tabela <code class="docutils literal notranslate"><span class="pre">regiao_copia</span></code> completamente:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
DROP TABLE regiao_copia;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
Done.
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[]
</pre></div>
</div>
</div>
</div>
<p>Este comando <code class="docutils literal notranslate"><span class="pre">DROP</span> <span class="pre">TABLE</span></code> remove a tabela <code class="docutils literal notranslate"><span class="pre">regiao_copia</span></code> e todos os dados associados a ela de forma irreversível. É importante garantir que a tabela e os dados contidos nela não são mais necessários antes de executar este comando.</p>
<p>Para confirmar que a tabela <code class="docutils literal notranslate"><span class="pre">regiao_copia</span></code> foi efetivamente deletada, podemos consultar as tabelas existentes no banco de dados:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
SELECT table_name 
FROM information_schema.tables 
WHERE table_schema = &#39;public&#39;;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
5 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>table_name</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>regiao</td>
        </tr>
        <tr>
            <td>regiao_imed</td>
        </tr>
        <tr>
            <td>regiao_inter</td>
        </tr>
        <tr>
            <td>censo_mun</td>
        </tr>
        <tr>
            <td>estado</td>
        </tr>
    </tbody>
</table></div></div>
</div>
<p>Esta consulta retorna os nomes de todas as tabelas presentes no esquema <code class="docutils literal notranslate"><span class="pre">public</span></code> do banco de dados, permitindo verificar que a tabela <code class="docutils literal notranslate"><span class="pre">regiao_copia</span></code> não está mais listada entre elas.</p>
</div>
<div class="section" id="indexacao-e-performance-no-sql">
<h3>2.4.3 Indexação e Performance no SQL<a class="headerlink" href="#indexacao-e-performance-no-sql" title="Permalink to this heading">#</a></h3>
<p>A indexação em bancos de dados é fundamental para a otimização da performance de consultas, especialmente em tabelas de grande volume de dados. Semelhante a um índice de livro que facilita a localização de informações, um índice de banco de dados permite que o sistema de gerenciamento de banco de dados (SGBD) encontre rapidamente linhas dentro de uma tabela. Os índices são criados com base em uma ou mais colunas, formando uma estrutura que o banco de dados pode consultar eficientemente, melhorando significativamente a performance das operações de busca, junção, e filtragem.</p>
<p><em>Benefícios da Indexação</em></p>
<ul class="simple">
<li><p><strong>Melhoria na Performance de Consultas:</strong> Permite ao SGBD limitar sua busca a uma fração das linhas, resultando em uma recuperação de dados mais rápida.</p></li>
<li><p><strong>Otimização de Junções:</strong> Índices em chaves estrangeiras aceleram significativamente as operações de junção, permitindo a localização rápida das linhas correspondentes.</p></li>
<li><p><strong>Eficiência em Operações de Filtragem e Ordenação:</strong> Consultas que utilizam colunas indexadas em cláusulas <code class="docutils literal notranslate"><span class="pre">WHERE</span></code> ou <code class="docutils literal notranslate"><span class="pre">ORDER</span> <span class="pre">BY</span></code> se beneficiam de uma busca mais ágil.</p></li>
</ul>
<p><em>Aplicação de Índices</em></p>
<ul class="simple">
<li><p><strong>Índices em Chaves Estrangeiras:</strong> Como <code class="docutils literal notranslate"><span class="pre">censo_mun.cod_rgi</span></code>, <code class="docutils literal notranslate"><span class="pre">censo_mun.cod_rgint</span></code>, <code class="docutils literal notranslate"><span class="pre">censo_mun.cod_uf</span></code>, <code class="docutils literal notranslate"><span class="pre">regiao_imed.cod_rgint</span></code>, <code class="docutils literal notranslate"><span class="pre">regiao_inter.cod_uf</span></code>, e <code class="docutils literal notranslate"><span class="pre">estado.cod_rg</span></code>.</p></li>
<li><p><strong>Índices em Colunas Frequentemente Consultadas:</strong> Se colunas são frequentemente usadas em consultas para filtrar dados, adicionar índices a essas colunas pode melhorar a velocidade dessas consultas.</p></li>
<li><p><strong>Índices Compostos:</strong> Úteis para consultas que frequentemente filtram ou ordenam usando várias colunas juntas.</p></li>
</ul>
<p><em>Criando Índices</em></p>
<p>Para adicionar índices ao esquema do banco de dados, utilizam-se comandos <code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">INDEX</span></code>. Abaixo estão os comandos para criar índices para cada chave estrangeira relevante, assumindo o padrão de nomenclatura que reflete a tabela e a coluna aplicada:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
-- Índices para a tabela censo_mun
CREATE INDEX idx_censo_mun_cod_rgi ON censo_mun USING btree (cod_rgi);
CREATE INDEX idx_censo_mun_cod_rgint ON censo_mun USING btree (cod_rgint);
CREATE INDEX idx_censo_mun_cod_uf ON censo_mun USING btree (cod_uf);

-- Índice para a tabela regiao_imed
CREATE INDEX idx_regiao_imed_cod_rgint ON regiao_imed USING btree (cod_rgint);

-- Índice para a tabela regiao_inter
CREATE INDEX idx_regiao_inter_cod_uf ON regiao_inter USING btree (cod_uf);

-- Índice para a tabela estado
CREATE INDEX idx_estado_cod_rg ON estado USING btree (cod_rg);
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
Done.
Done.
Done.
Done.
Done.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Done.
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[]
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p><strong>USING btree:</strong> Especifica o tipo de índice, com btree sendo o mais comum e geralmente mais eficiente para comparações de igualdade e intervalo.</p></li>
</ul>
<p><em>Considerações</em></p>
<ul class="simple">
<li><p><strong>Nomeação de Índices:</strong> A convenção <code class="docutils literal notranslate"><span class="pre">idx_&lt;nome_da_tabela&gt;_&lt;nome_da_coluna&gt;</span></code> é sugerida para manter os índices organizados e facilmente identificáveis.</p></li>
<li><p><strong>Balanceamento:</strong> Enquanto a indexação pode melhorar a performance de leitura, ela também pode impactar a performance de escrita (inserção, atualização, exclusão), pois o índice precisa ser atualizado. Um planejamento cuidadoso é necessário para encontrar o equilíbrio ideal.</p></li>
</ul>
</div>
<div class="section" id="linguagem-de-controle-de-dados-data-control-language-dcl">
<h3>2.4.4 Linguagem de Controle de Dados (Data Control Language - DCL)<a class="headerlink" href="#linguagem-de-controle-de-dados-data-control-language-dcl" title="Permalink to this heading">#</a></h3>
<p>A Linguagem de Controle de Dados (DCL) é usada para controlar o acesso aos dados armazenados em um banco de dados. Os comandos principais da DCL, <code class="docutils literal notranslate"><span class="pre">GRANT</span></code> e <code class="docutils literal notranslate"><span class="pre">REVOKE</span></code>, permitem ao administrador do banco de dados gerenciar as permissões de usuários e grupos, garantindo a segurança e o controle adequado do ambiente do banco de dados. No entanto, é importante ressaltar que, em nosso curso básico de banco de dados, decidimos não abordar a DCL. Esta decisão foi tomada porque o foco do curso está nos fundamentos básicos e introdutórios de bancos de dados, não se estendendo a aspectos avançados como o controle de acesso e gestão de permissões.</p>
<p><strong>GRANT</strong></p>
<p>O comando <code class="docutils literal notranslate"><span class="pre">GRANT</span></code> é utilizado para conceder privilégios de acesso a objetos do banco de dados, como tabelas e visões, a usuários ou grupos. Estes privilégios podem incluir direitos para executar ações como <code class="docutils literal notranslate"><span class="pre">SELECT</span></code>, <code class="docutils literal notranslate"><span class="pre">INSERT</span></code>, <code class="docutils literal notranslate"><span class="pre">UPDATE</span></code>, <code class="docutils literal notranslate"><span class="pre">DELETE</span></code>, entre outros. A sintaxe básica do comando <code class="docutils literal notranslate"><span class="pre">GRANT</span></code> é:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">GRANT</span><span class="w"> </span><span class="n">nome_privilegio</span>
<span class="k">ON</span><span class="w"> </span><span class="n">nome_objeto</span>
<span class="k">TO</span><span class="w"> </span><span class="n">nome_usuario_ou_grupo</span>
<span class="p">[</span><span class="k">WITH</span><span class="w"> </span><span class="k">GRANT</span><span class="w"> </span><span class="k">OPTION</span><span class="p">];</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">nome_privilegio</span></code>: Tipo de permissão concedida, como <code class="docutils literal notranslate"><span class="pre">SELECT</span></code>, <code class="docutils literal notranslate"><span class="pre">INSERT</span></code>, etc.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nome_objeto</span></code>: Nome do objeto de banco de dados ao qual a permissão está sendo concedida.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nome_usuario_ou_grupo</span></code>: Nome do usuário ou grupo que receberá a permissão.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">WITH</span> <span class="pre">GRANT</span> <span class="pre">OPTION</span></code>: Opcionalmente, permite que o usuário conceda permissões a outros usuários.</p></li>
</ul>
<p><strong>REVOKE</strong></p>
<p>O comando <code class="docutils literal notranslate"><span class="pre">REVOKE</span></code> é usado para retirar privilégios anteriormente concedidos. Se um usuário não deve mais ter acesso a determinados dados ou se suas permissões precisam ser ajustadas, este comando é utilizado. A sintaxe básica para o comando <code class="docutils literal notranslate"><span class="pre">REVOKE</span></code> é:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">REVOKE</span><span class="w"> </span><span class="n">nome_privilegio</span>
<span class="k">ON</span><span class="w"> </span><span class="n">nome_objeto</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">nome_usuario_ou_grupo</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">nome_privilegio</span></code>: Tipo de permissão que está sendo retirada.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nome_objeto</span></code>: Nome do objeto de banco de dados do qual a permissão será retirada.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nome_usuario_ou_grupo</span></code>: Nome do usuário ou grupo que terá a permissão retirada.</p></li>
</ul>
<p><strong>Exemplo Prático</strong></p>
<p>Para exemplificar o uso do comando <code class="docutils literal notranslate"><span class="pre">GRANT</span></code>, suponha que desejamos conceder a um usuário chamado <code class="docutils literal notranslate"><span class="pre">usuario_exemplo</span></code> o direito de executar consultas <code class="docutils literal notranslate"><span class="pre">SELECT</span></code> na tabela <code class="docutils literal notranslate"><span class="pre">tabela_exemplo</span></code>:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">GRANT</span><span class="w"> </span><span class="k">SELECT</span>
<span class="k">ON</span><span class="w"> </span><span class="n">tabela_exemplo</span>
<span class="k">TO</span><span class="w"> </span><span class="n">usuario_exemplo</span><span class="p">;</span>
</pre></div>
</div>
<p>Se posteriormente decidirmos retirar este privilégio do <code class="docutils literal notranslate"><span class="pre">usuario_exemplo</span></code>, usaremos o comando <code class="docutils literal notranslate"><span class="pre">REVOKE</span></code> da seguinte forma:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">REVOKE</span><span class="w"> </span><span class="k">SELECT</span>
<span class="k">ON</span><span class="w"> </span><span class="n">tabela_exemplo</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">usuario_exemplo</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="consulta-e-recuperacao-de-dados-em-sql">
<h2>2.5 Consulta e recuperação de dados em SQL<a class="headerlink" href="#consulta-e-recuperacao-de-dados-em-sql" title="Permalink to this heading">#</a></h2>
<p>Nesta seção, aprofundamos nossa compreensão sobre as funcionalidades disponíveis no comando <code class="docutils literal notranslate"><span class="pre">SELECT</span></code>, explorando a sintaxe avançada que inclui ordenação (<code class="docutils literal notranslate"><span class="pre">ORDER</span> <span class="pre">BY</span></code>), agrupamento (<code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span></code>), filtragem após o agrupamento (<code class="docutils literal notranslate"><span class="pre">HAVING</span></code>), e a implementação de junções (<code class="docutils literal notranslate"><span class="pre">JOINs</span></code>) para combinar dados de múltiplas tabelas.</p>
<p><strong>A cláusula SELECT</strong></p>
<p>A sintaxe completa do comando <code class="docutils literal notranslate"><span class="pre">SELECT</span></code>, incluindo cláusulas opcionais, é:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">coluna1</span><span class="p">,</span><span class="w"> </span><span class="n">coluna2</span><span class="p">,</span><span class="w"> </span><span class="p">...</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">nome_tabela</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">condição</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">coluna</span>
<span class="k">HAVING</span><span class="w"> </span><span class="n">condição_grupo</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">coluna</span><span class="w"> </span><span class="k">ASC</span><span class="o">|</span><span class="k">DESC</span>
<span class="k">LIMIT</span><span class="w"> </span><span class="n">número</span><span class="p">;</span>
</pre></div>
</div>
<p><em>Detalhamento das Cláusulas:</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">SELECT</span></code>: Especifica as colunas a serem recuperadas.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">FROM</span></code>: Indica a tabela de onde os dados serão recuperados.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">WHERE</span></code>: Aplica um filtro aos dados, baseado em uma condição.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span></code>: Agrupa linhas com os mesmos valores nas colunas especificadas.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">HAVING</span></code>: Filtra grupos criados pelo <code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ORDER</span> <span class="pre">BY</span></code>: Ordena os resultados. <code class="docutils literal notranslate"><span class="pre">ASC</span></code> para ascendente e <code class="docutils literal notranslate"><span class="pre">DESC</span></code> para descendente.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LIMIT</span></code>: Limita o número de registros retornados.</p></li>
</ul>
<p><em>Exemplos Práticos:</em></p>
<p><strong>Verificar todos os registros na tabela <code class="docutils literal notranslate"><span class="pre">estado</span></code>:</strong></p>
<p>Quando você usa a cláusula <code class="docutils literal notranslate"><span class="pre">SELECT</span></code> com <code class="docutils literal notranslate"><span class="pre">FROM</span></code> em SQL, está especificando que deseja recuperar dados de uma determinada tabela.
Para selecionar todos os registros e todas as colunas de uma tabela, você usa o asterisco (*) com a instrução <code class="docutils literal notranslate"><span class="pre">SELECT</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
SELECT * 
FROM estado;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>27 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>cod_uf</th>
            <th>nome_uf</th>
            <th>sigla_uf</th>
            <th>cod_rg</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>11</td>
            <td>Rondônia</td>
            <td>RO</td>
            <td>1</td>
        </tr>
        <tr>
            <td>12</td>
            <td>Acre</td>
            <td>AC</td>
            <td>1</td>
        </tr>
        <tr>
            <td>13</td>
            <td>Amazonas</td>
            <td>AM</td>
            <td>1</td>
        </tr>
        <tr>
            <td>14</td>
            <td>Roraima</td>
            <td>RR</td>
            <td>1</td>
        </tr>
        <tr>
            <td>15</td>
            <td>Pará</td>
            <td>PA</td>
            <td>1</td>
        </tr>
        <tr>
            <td>16</td>
            <td>Amapá</td>
            <td>AP</td>
            <td>1</td>
        </tr>
        <tr>
            <td>17</td>
            <td>Tocantins</td>
            <td>TO</td>
            <td>1</td>
        </tr>
        <tr>
            <td>21</td>
            <td>Maranhão</td>
            <td>MA</td>
            <td>2</td>
        </tr>
        <tr>
            <td>22</td>
            <td>Piauí</td>
            <td>PI</td>
            <td>2</td>
        </tr>
        <tr>
            <td>23</td>
            <td>Ceará</td>
            <td>CE</td>
            <td>2</td>
        </tr>
        <tr>
            <td>24</td>
            <td>Rio Grande do Norte</td>
            <td>RN</td>
            <td>2</td>
        </tr>
        <tr>
            <td>25</td>
            <td>Paraíba</td>
            <td>PB</td>
            <td>2</td>
        </tr>
        <tr>
            <td>26</td>
            <td>Pernambuco</td>
            <td>PE</td>
            <td>2</td>
        </tr>
        <tr>
            <td>27</td>
            <td>Alagoas</td>
            <td>AL</td>
            <td>2</td>
        </tr>
        <tr>
            <td>28</td>
            <td>Sergipe</td>
            <td>SE</td>
            <td>2</td>
        </tr>
        <tr>
            <td>29</td>
            <td>Bahia</td>
            <td>BA</td>
            <td>2</td>
        </tr>
        <tr>
            <td>31</td>
            <td>Minas Gerais</td>
            <td>MG</td>
            <td>3</td>
        </tr>
        <tr>
            <td>32</td>
            <td>Espírito Santo</td>
            <td>ES</td>
            <td>3</td>
        </tr>
        <tr>
            <td>33</td>
            <td>Rio de Janeiro</td>
            <td>RJ</td>
            <td>3</td>
        </tr>
        <tr>
            <td>35</td>
            <td>São Paulo</td>
            <td>SP</td>
            <td>3</td>
        </tr>
        <tr>
            <td>41</td>
            <td>Paraná</td>
            <td>PR</td>
            <td>4</td>
        </tr>
        <tr>
            <td>42</td>
            <td>Santa Catarina</td>
            <td>SC</td>
            <td>4</td>
        </tr>
        <tr>
            <td>43</td>
            <td>Rio Grande do Sul</td>
            <td>RS</td>
            <td>4</td>
        </tr>
        <tr>
            <td>50</td>
            <td>Mato Grosso do Sul</td>
            <td>MS</td>
            <td>5</td>
        </tr>
        <tr>
            <td>51</td>
            <td>Mato Grosso</td>
            <td>MT</td>
            <td>5</td>
        </tr>
        <tr>
            <td>52</td>
            <td>Goiás</td>
            <td>GO</td>
            <td>5</td>
        </tr>
        <tr>
            <td>53</td>
            <td>Distrito Federal</td>
            <td>DF</td>
            <td>5</td>
        </tr>
    </tbody>
</table></div></div>
</div>
<p><strong>Limitar os resultados retornados:</strong></p>
<p>A cláusula <code class="docutils literal notranslate"><span class="pre">LIMIT</span></code> é usada para definir o número máximo de registros a serem retornados pela consulta:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
SELECT * 
FROM estado
LIMIT 4;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
4 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>cod_uf</th>
            <th>nome_uf</th>
            <th>sigla_uf</th>
            <th>cod_rg</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>11</td>
            <td>Rondônia</td>
            <td>RO</td>
            <td>1</td>
        </tr>
        <tr>
            <td>12</td>
            <td>Acre</td>
            <td>AC</td>
            <td>1</td>
        </tr>
        <tr>
            <td>13</td>
            <td>Amazonas</td>
            <td>AM</td>
            <td>1</td>
        </tr>
        <tr>
            <td>14</td>
            <td>Roraima</td>
            <td>RR</td>
            <td>1</td>
        </tr>
    </tbody>
</table></div></div>
</div>
<p><strong>Selecionar registros específicos:</strong></p>
<p>Para selecionar registros específicos e/ou mais de uma coluna, especifique-os separados por vírgulas:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">coluna1</span><span class="p">,</span><span class="w"> </span><span class="n">coluna2</span><span class="w"> </span>
<span class="k">FROM</span><span class="w"> </span><span class="n">nome_da_tabela</span><span class="p">;</span>
</pre></div>
</div>
<p>Essa consulta retornará os todos os registros das colunas “coluna1” e “coluna2”. Exemplo:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
SELECT cod_uf, sigla_uf
FROM estado;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
27 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>cod_uf</th>
            <th>sigla_uf</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>11</td>
            <td>RO</td>
        </tr>
        <tr>
            <td>12</td>
            <td>AC</td>
        </tr>
        <tr>
            <td>13</td>
            <td>AM</td>
        </tr>
        <tr>
            <td>14</td>
            <td>RR</td>
        </tr>
        <tr>
            <td>15</td>
            <td>PA</td>
        </tr>
        <tr>
            <td>16</td>
            <td>AP</td>
        </tr>
        <tr>
            <td>17</td>
            <td>TO</td>
        </tr>
        <tr>
            <td>21</td>
            <td>MA</td>
        </tr>
        <tr>
            <td>22</td>
            <td>PI</td>
        </tr>
        <tr>
            <td>23</td>
            <td>CE</td>
        </tr>
        <tr>
            <td>24</td>
            <td>RN</td>
        </tr>
        <tr>
            <td>25</td>
            <td>PB</td>
        </tr>
        <tr>
            <td>26</td>
            <td>PE</td>
        </tr>
        <tr>
            <td>27</td>
            <td>AL</td>
        </tr>
        <tr>
            <td>28</td>
            <td>SE</td>
        </tr>
        <tr>
            <td>29</td>
            <td>BA</td>
        </tr>
        <tr>
            <td>31</td>
            <td>MG</td>
        </tr>
        <tr>
            <td>32</td>
            <td>ES</td>
        </tr>
        <tr>
            <td>33</td>
            <td>RJ</td>
        </tr>
        <tr>
            <td>35</td>
            <td>SP</td>
        </tr>
        <tr>
            <td>41</td>
            <td>PR</td>
        </tr>
        <tr>
            <td>42</td>
            <td>SC</td>
        </tr>
        <tr>
            <td>43</td>
            <td>RS</td>
        </tr>
        <tr>
            <td>50</td>
            <td>MS</td>
        </tr>
        <tr>
            <td>51</td>
            <td>MT</td>
        </tr>
        <tr>
            <td>52</td>
            <td>GO</td>
        </tr>
        <tr>
            <td>53</td>
            <td>DF</td>
        </tr>
    </tbody>
</table></div></div>
</div>
<p><strong>Retornar valores distintos:</strong></p>
<p>A palavra-chave <code class="docutils literal notranslate"><span class="pre">DISTINCT</span></code> é usada para retornar apenas valores distintos (diferentes) das colunas especificadas:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">coluna1</span><span class="w"> </span>
<span class="k">FROM</span><span class="w"> </span><span class="n">nome_da_tabela</span><span class="p">;</span>
</pre></div>
</div>
<p>Essa consulta retornará valores únicos da “coluna1”, removendo duplicatas. Vamos consultar a coluna cod_rg na tabela ‘estado’. Lembre que cod_rg armazena os códigos das região do Brasil a qual cada estado pertence.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
SELECT DISTINCT cod_rg
FROM estado;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
5 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>cod_rg</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>4</td>
        </tr>
        <tr>
            <td>3</td>
        </tr>
        <tr>
            <td>1</td>
        </tr>
        <tr>
            <td>5</td>
        </tr>
        <tr>
            <td>2</td>
        </tr>
    </tbody>
</table></div></div>
</div>
<p><strong>Contar o número total de registros:</strong></p>
<p>A função <code class="docutils literal notranslate"><span class="pre">COUNT</span></code> retorna o número de linhas que correspondem a um critério especificado.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
SELECT COUNT(*) 
FROM censo_mun;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>count</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>5570</td>
        </tr>
    </tbody>
</table></div></div>
</div>
<p><strong>Encontrar o valor máximo em uma coluna:</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
SELECT MAX(popul_2022) 
FROM censo_mun;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
1 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>max</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>12200180</td>
        </tr>
    </tbody>
</table></div></div>
</div>
<p><strong>Somar os valores de uma coluna:</strong></p>
<p>Para o Censo de 2010:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
SELECT SUM(popul_2010) 
FROM censo_mun;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
1 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>sum</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>190755804</td>
        </tr>
    </tbody>
</table></div></div>
</div>
<p>Para o Censo de 2022:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
SELECT SUM(popul_2022) 
FROM censo_mun;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
1 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>sum</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>207747808</td>
        </tr>
    </tbody>
</table></div></div>
</div>
<p>Podemos verificar que, apesar de a população do Brasil em 2022 oficialmente ser de 203 080 756, a soma da população registrada em cada município é consideravelmente maior.</p>
<p><em>Notas Importantes:</em></p>
<ul class="simple">
<li><p>O comando <code class="docutils literal notranslate"><span class="pre">SELECT</span></code> é versátil, permitindo não apenas a recuperação de dados mas também a sua análise e manipulação diretamente no banco de dados;</p></li>
<li><p>O uso cuidadoso das cláusulas <code class="docutils literal notranslate"><span class="pre">WHERE</span></code>, <code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span></code>, <code class="docutils literal notranslate"><span class="pre">HAVING</span></code>, e <code class="docutils literal notranslate"><span class="pre">ORDER</span> <span class="pre">BY</span></code> permite a realização de consultas complexas e a geração de insights a partir dos dados;</p></li>
<li><p>As funções agregadas como <code class="docutils literal notranslate"><span class="pre">COUNT</span></code>, <code class="docutils literal notranslate"><span class="pre">MAX</span></code>, e <code class="docutils literal notranslate"><span class="pre">SUM</span></code> tornam possível realizar operações matemáticas sobre grupos de dados, facilitando análises estatísticas.</p></li>
</ul>
<p><strong>A cláusula ORDER BY</strong></p>
<p>A cláusula <code class="docutils literal notranslate"><span class="pre">ORDER</span> <span class="pre">BY</span></code> é utilizada para ordenar os registros resultantes de uma consulta SQL por uma ou mais colunas. Esse recurso é particularmente útil quando precisamos apresentar os dados de forma organizada, seja em ordem ascendente (padrão) ou descendente. A sintaxe básica é:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span>
<span class="k">FROM</span><span class="w"> </span><span class="n">nome_da_tabela</span><span class="w"> </span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">coluna1</span><span class="p">;</span>
</pre></div>
</div>
<p>Neste código, os resultados serão ordenados pela <code class="docutils literal notranslate"><span class="pre">coluna1</span></code> em ordem ascendente por padrão.</p>
<ul class="simple">
<li><p>Ordenação em Ordem Alfabética</p></li>
</ul>
<p>Para recuperar os registros da tabela <code class="docutils literal notranslate"><span class="pre">estado</span></code> em ordem alfabética pelo nome do estado:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
SELECT * 
FROM estado 
ORDER BY nome_uf;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
27 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>cod_uf</th>
            <th>nome_uf</th>
            <th>sigla_uf</th>
            <th>cod_rg</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>12</td>
            <td>Acre</td>
            <td>AC</td>
            <td>1</td>
        </tr>
        <tr>
            <td>27</td>
            <td>Alagoas</td>
            <td>AL</td>
            <td>2</td>
        </tr>
        <tr>
            <td>16</td>
            <td>Amapá</td>
            <td>AP</td>
            <td>1</td>
        </tr>
        <tr>
            <td>13</td>
            <td>Amazonas</td>
            <td>AM</td>
            <td>1</td>
        </tr>
        <tr>
            <td>29</td>
            <td>Bahia</td>
            <td>BA</td>
            <td>2</td>
        </tr>
        <tr>
            <td>23</td>
            <td>Ceará</td>
            <td>CE</td>
            <td>2</td>
        </tr>
        <tr>
            <td>53</td>
            <td>Distrito Federal</td>
            <td>DF</td>
            <td>5</td>
        </tr>
        <tr>
            <td>32</td>
            <td>Espírito Santo</td>
            <td>ES</td>
            <td>3</td>
        </tr>
        <tr>
            <td>52</td>
            <td>Goiás</td>
            <td>GO</td>
            <td>5</td>
        </tr>
        <tr>
            <td>21</td>
            <td>Maranhão</td>
            <td>MA</td>
            <td>2</td>
        </tr>
        <tr>
            <td>51</td>
            <td>Mato Grosso</td>
            <td>MT</td>
            <td>5</td>
        </tr>
        <tr>
            <td>50</td>
            <td>Mato Grosso do Sul</td>
            <td>MS</td>
            <td>5</td>
        </tr>
        <tr>
            <td>31</td>
            <td>Minas Gerais</td>
            <td>MG</td>
            <td>3</td>
        </tr>
        <tr>
            <td>15</td>
            <td>Pará</td>
            <td>PA</td>
            <td>1</td>
        </tr>
        <tr>
            <td>25</td>
            <td>Paraíba</td>
            <td>PB</td>
            <td>2</td>
        </tr>
        <tr>
            <td>41</td>
            <td>Paraná</td>
            <td>PR</td>
            <td>4</td>
        </tr>
        <tr>
            <td>26</td>
            <td>Pernambuco</td>
            <td>PE</td>
            <td>2</td>
        </tr>
        <tr>
            <td>22</td>
            <td>Piauí</td>
            <td>PI</td>
            <td>2</td>
        </tr>
        <tr>
            <td>33</td>
            <td>Rio de Janeiro</td>
            <td>RJ</td>
            <td>3</td>
        </tr>
        <tr>
            <td>24</td>
            <td>Rio Grande do Norte</td>
            <td>RN</td>
            <td>2</td>
        </tr>
        <tr>
            <td>43</td>
            <td>Rio Grande do Sul</td>
            <td>RS</td>
            <td>4</td>
        </tr>
        <tr>
            <td>11</td>
            <td>Rondônia</td>
            <td>RO</td>
            <td>1</td>
        </tr>
        <tr>
            <td>14</td>
            <td>Roraima</td>
            <td>RR</td>
            <td>1</td>
        </tr>
        <tr>
            <td>42</td>
            <td>Santa Catarina</td>
            <td>SC</td>
            <td>4</td>
        </tr>
        <tr>
            <td>35</td>
            <td>São Paulo</td>
            <td>SP</td>
            <td>3</td>
        </tr>
        <tr>
            <td>28</td>
            <td>Sergipe</td>
            <td>SE</td>
            <td>2</td>
        </tr>
        <tr>
            <td>17</td>
            <td>Tocantins</td>
            <td>TO</td>
            <td>1</td>
        </tr>
    </tbody>
</table></div></div>
</div>
<p>Este comando exibe todos os registros da tabela <code class="docutils literal notranslate"><span class="pre">estado</span></code>, ordenados alfabeticamente pelo campo <code class="docutils literal notranslate"><span class="pre">nome_uf</span></code>.</p>
<p>Caso seja necessário ordenar os resultados em ordem decrescente, adicione a palavra-chave <code class="docutils literal notranslate"><span class="pre">DESC</span></code> após o nome da coluna na cláusula <code class="docutils literal notranslate"><span class="pre">ORDER</span> <span class="pre">BY</span></code>:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span>
<span class="k">FROM</span><span class="w"> </span><span class="n">nome_da_tabela</span><span class="w"> </span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">coluna1</span><span class="w"> </span><span class="k">DESC</span><span class="p">;</span>
</pre></div>
</div>
<p>Com essa modificação, os resultados serão ordenados pela <code class="docutils literal notranslate"><span class="pre">coluna1</span></code> em ordem decrescente.</p>
<p>Para recuperar os registros da tabela <code class="docutils literal notranslate"><span class="pre">estado</span></code> em ordem alfabética inversa:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
SELECT * 
FROM estado 
ORDER BY nome_uf DESC;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
27 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>cod_uf</th>
            <th>nome_uf</th>
            <th>sigla_uf</th>
            <th>cod_rg</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>17</td>
            <td>Tocantins</td>
            <td>TO</td>
            <td>1</td>
        </tr>
        <tr>
            <td>28</td>
            <td>Sergipe</td>
            <td>SE</td>
            <td>2</td>
        </tr>
        <tr>
            <td>35</td>
            <td>São Paulo</td>
            <td>SP</td>
            <td>3</td>
        </tr>
        <tr>
            <td>42</td>
            <td>Santa Catarina</td>
            <td>SC</td>
            <td>4</td>
        </tr>
        <tr>
            <td>14</td>
            <td>Roraima</td>
            <td>RR</td>
            <td>1</td>
        </tr>
        <tr>
            <td>11</td>
            <td>Rondônia</td>
            <td>RO</td>
            <td>1</td>
        </tr>
        <tr>
            <td>43</td>
            <td>Rio Grande do Sul</td>
            <td>RS</td>
            <td>4</td>
        </tr>
        <tr>
            <td>24</td>
            <td>Rio Grande do Norte</td>
            <td>RN</td>
            <td>2</td>
        </tr>
        <tr>
            <td>33</td>
            <td>Rio de Janeiro</td>
            <td>RJ</td>
            <td>3</td>
        </tr>
        <tr>
            <td>22</td>
            <td>Piauí</td>
            <td>PI</td>
            <td>2</td>
        </tr>
        <tr>
            <td>26</td>
            <td>Pernambuco</td>
            <td>PE</td>
            <td>2</td>
        </tr>
        <tr>
            <td>41</td>
            <td>Paraná</td>
            <td>PR</td>
            <td>4</td>
        </tr>
        <tr>
            <td>25</td>
            <td>Paraíba</td>
            <td>PB</td>
            <td>2</td>
        </tr>
        <tr>
            <td>15</td>
            <td>Pará</td>
            <td>PA</td>
            <td>1</td>
        </tr>
        <tr>
            <td>31</td>
            <td>Minas Gerais</td>
            <td>MG</td>
            <td>3</td>
        </tr>
        <tr>
            <td>50</td>
            <td>Mato Grosso do Sul</td>
            <td>MS</td>
            <td>5</td>
        </tr>
        <tr>
            <td>51</td>
            <td>Mato Grosso</td>
            <td>MT</td>
            <td>5</td>
        </tr>
        <tr>
            <td>21</td>
            <td>Maranhão</td>
            <td>MA</td>
            <td>2</td>
        </tr>
        <tr>
            <td>52</td>
            <td>Goiás</td>
            <td>GO</td>
            <td>5</td>
        </tr>
        <tr>
            <td>32</td>
            <td>Espírito Santo</td>
            <td>ES</td>
            <td>3</td>
        </tr>
        <tr>
            <td>53</td>
            <td>Distrito Federal</td>
            <td>DF</td>
            <td>5</td>
        </tr>
        <tr>
            <td>23</td>
            <td>Ceará</td>
            <td>CE</td>
            <td>2</td>
        </tr>
        <tr>
            <td>29</td>
            <td>Bahia</td>
            <td>BA</td>
            <td>2</td>
        </tr>
        <tr>
            <td>13</td>
            <td>Amazonas</td>
            <td>AM</td>
            <td>1</td>
        </tr>
        <tr>
            <td>16</td>
            <td>Amapá</td>
            <td>AP</td>
            <td>1</td>
        </tr>
        <tr>
            <td>27</td>
            <td>Alagoas</td>
            <td>AL</td>
            <td>2</td>
        </tr>
        <tr>
            <td>12</td>
            <td>Acre</td>
            <td>AC</td>
            <td>1</td>
        </tr>
    </tbody>
</table></div></div>
</div>
<p>Este comando exibe todos os registros da tabela <code class="docutils literal notranslate"><span class="pre">estado</span></code>, ordenados de forma inversa alfabeticamente pelo campo <code class="docutils literal notranslate"><span class="pre">nome_uf</span></code>, começando do Z para o A.</p>
<p><strong>A cláusula WHERE</strong></p>
<p>A cláusula <code class="docutils literal notranslate"><span class="pre">WHERE</span></code> em SQL é usada para filtrar registros e especificar quais devem ser incluídos no conjunto de resultados. Ela é a base para a execução de consultas que exigem uma condição específica. A sintáxe básica é:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">coluna1</span><span class="p">,</span><span class="w"> </span><span class="n">coluna2</span><span class="p">,</span><span class="w"> </span><span class="p">...</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">nome_tabela</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">condição</span><span class="p">;</span>
</pre></div>
</div>
<p>Podemos utilizar operadores de comparação na cláusula WHERE. Os mais comumente utilizados são:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">=</span></code>: igual a</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">!=</span></code> ou <code class="docutils literal notranslate"><span class="pre">&lt;&gt;</span></code>: não igual a</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&gt;</span></code>: maior que</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&gt;=</span></code>: maior ou igual a</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;</span></code>: menor que</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;=</span></code>: menor ou igual a</p></li>
</ul>
<p>Uma consulta simples com WHERE especifica uma condição a qual as linhas devem atender para serem selecionadas:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span>
<span class="k">FROM</span><span class="w"> </span><span class="n">tabela</span><span class="w"> </span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">coluna1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;valor&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p>Esse comando retornará todos os registros da tabela onde o valor da “coluna1” é igual a ‘valor’.</p>
<p><strong>Exemplos Práticos:</strong></p>
<p><em>Filtrando por Condição Específica:</em></p>
<p>Para recuperar os registros de estados que pertencem à região Nordeste (código da região 2) na tabela <code class="docutils literal notranslate"><span class="pre">estado</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
SELECT cod_uf, nome_uf
FROM estado
WHERE cod_rg = 2;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>9 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>cod_uf</th>
            <th>nome_uf</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>21</td>
            <td>Maranhão</td>
        </tr>
        <tr>
            <td>22</td>
            <td>Piauí</td>
        </tr>
        <tr>
            <td>23</td>
            <td>Ceará</td>
        </tr>
        <tr>
            <td>24</td>
            <td>Rio Grande do Norte</td>
        </tr>
        <tr>
            <td>25</td>
            <td>Paraíba</td>
        </tr>
        <tr>
            <td>26</td>
            <td>Pernambuco</td>
        </tr>
        <tr>
            <td>27</td>
            <td>Alagoas</td>
        </tr>
        <tr>
            <td>28</td>
            <td>Sergipe</td>
        </tr>
        <tr>
            <td>29</td>
            <td>Bahia</td>
        </tr>
    </tbody>
</table></div></div>
</div>
<p><em>Usando o Operador <code class="docutils literal notranslate"><span class="pre">NOT</span></code>:</em></p>
<p>Para recuperar todos os registros que não pertencem à região Nordeste:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
SELECT cod_uf, nome_uf
FROM estado
WHERE cod_rg != 2;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>18 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>cod_uf</th>
            <th>nome_uf</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>11</td>
            <td>Rondônia</td>
        </tr>
        <tr>
            <td>12</td>
            <td>Acre</td>
        </tr>
        <tr>
            <td>13</td>
            <td>Amazonas</td>
        </tr>
        <tr>
            <td>14</td>
            <td>Roraima</td>
        </tr>
        <tr>
            <td>15</td>
            <td>Pará</td>
        </tr>
        <tr>
            <td>16</td>
            <td>Amapá</td>
        </tr>
        <tr>
            <td>17</td>
            <td>Tocantins</td>
        </tr>
        <tr>
            <td>31</td>
            <td>Minas Gerais</td>
        </tr>
        <tr>
            <td>32</td>
            <td>Espírito Santo</td>
        </tr>
        <tr>
            <td>33</td>
            <td>Rio de Janeiro</td>
        </tr>
        <tr>
            <td>35</td>
            <td>São Paulo</td>
        </tr>
        <tr>
            <td>41</td>
            <td>Paraná</td>
        </tr>
        <tr>
            <td>42</td>
            <td>Santa Catarina</td>
        </tr>
        <tr>
            <td>43</td>
            <td>Rio Grande do Sul</td>
        </tr>
        <tr>
            <td>50</td>
            <td>Mato Grosso do Sul</td>
        </tr>
        <tr>
            <td>51</td>
            <td>Mato Grosso</td>
        </tr>
        <tr>
            <td>52</td>
            <td>Goiás</td>
        </tr>
        <tr>
            <td>53</td>
            <td>Distrito Federal</td>
        </tr>
    </tbody>
</table></div></div>
</div>
<p><em>Combinando Condições com <code class="docutils literal notranslate"><span class="pre">AND</span></code> e <code class="docutils literal notranslate"><span class="pre">OR</span></code>:</em></p>
<p>Para recuperar os estados das regiões Norte (código da região 1) e Sul (código da região 4):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
SELECT cod_uf, nome_uf
FROM estado
WHERE cod_rg = 1 OR cod_rg = 4;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
10 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>cod_uf</th>
            <th>nome_uf</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>11</td>
            <td>Rondônia</td>
        </tr>
        <tr>
            <td>12</td>
            <td>Acre</td>
        </tr>
        <tr>
            <td>13</td>
            <td>Amazonas</td>
        </tr>
        <tr>
            <td>14</td>
            <td>Roraima</td>
        </tr>
        <tr>
            <td>15</td>
            <td>Pará</td>
        </tr>
        <tr>
            <td>16</td>
            <td>Amapá</td>
        </tr>
        <tr>
            <td>17</td>
            <td>Tocantins</td>
        </tr>
        <tr>
            <td>41</td>
            <td>Paraná</td>
        </tr>
        <tr>
            <td>42</td>
            <td>Santa Catarina</td>
        </tr>
        <tr>
            <td>43</td>
            <td>Rio Grande do Sul</td>
        </tr>
    </tbody>
</table></div></div>
</div>
<p><em>Selecionando Registros com Valores Maiores/Menores:</em></p>
<p>Para selecionar municípios com mais de 2 milhões de habitantes em 2022:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
SELECT *
FROM censo_mun
WHERE popul_2022 &gt; 2000000;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
7 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>cd_geocodi</th>
            <th>nome_mun</th>
            <th>area_km2</th>
            <th>popul_2010</th>
            <th>popul_2022</th>
            <th>cod_rgi</th>
            <th>cod_rgint</th>
            <th>cod_uf</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>1302603</td>
            <td>Manaus</td>
            <td>11401.092</td>
            <td>1802014</td>
            <td>2054731</td>
            <td>130001</td>
            <td>1301</td>
            <td>13</td>
        </tr>
        <tr>
            <td>2304400</td>
            <td>Fortaleza</td>
            <td>312.353</td>
            <td>2452185</td>
            <td>2596157</td>
            <td>230001</td>
            <td>2301</td>
            <td>23</td>
        </tr>
        <tr>
            <td>2927408</td>
            <td>Salvador</td>
            <td>693.442</td>
            <td>2675656</td>
            <td>2610987</td>
            <td>290001</td>
            <td>2901</td>
            <td>29</td>
        </tr>
        <tr>
            <td>3106200</td>
            <td>Belo Horizonte</td>
            <td>331.354</td>
            <td>2375151</td>
            <td>2392678</td>
            <td>310001</td>
            <td>3101</td>
            <td>31</td>
        </tr>
        <tr>
            <td>3304557</td>
            <td>Rio de Janeiro</td>
            <td>1200.329</td>
            <td>6320446</td>
            <td>6625849</td>
            <td>330001</td>
            <td>3301</td>
            <td>33</td>
        </tr>
        <tr>
            <td>3550308</td>
            <td>São Paulo</td>
            <td>1521.202</td>
            <td>11253503</td>
            <td>12200180</td>
            <td>350001</td>
            <td>3501</td>
            <td>35</td>
        </tr>
        <tr>
            <td>5300108</td>
            <td>Brasília</td>
            <td>5760.784</td>
            <td>2570160</td>
            <td>2923369</td>
            <td>530001</td>
            <td>5301</td>
            <td>53</td>
        </tr>
    </tbody>
</table></div></div>
</div>
<p>Para selecionar os registros dos municípios que possuíam mais de 2,5 milhões de habitantes em 2022 e mais de 2 milhões de habitantes em 2010:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
SELECT *
FROM censo_mun
WHERE popul_2022 &gt; 2500000 AND popul_2010 &gt; 2000000
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
5 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>cd_geocodi</th>
            <th>nome_mun</th>
            <th>area_km2</th>
            <th>popul_2010</th>
            <th>popul_2022</th>
            <th>cod_rgi</th>
            <th>cod_rgint</th>
            <th>cod_uf</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>2304400</td>
            <td>Fortaleza</td>
            <td>312.353</td>
            <td>2452185</td>
            <td>2596157</td>
            <td>230001</td>
            <td>2301</td>
            <td>23</td>
        </tr>
        <tr>
            <td>2927408</td>
            <td>Salvador</td>
            <td>693.442</td>
            <td>2675656</td>
            <td>2610987</td>
            <td>290001</td>
            <td>2901</td>
            <td>29</td>
        </tr>
        <tr>
            <td>3304557</td>
            <td>Rio de Janeiro</td>
            <td>1200.329</td>
            <td>6320446</td>
            <td>6625849</td>
            <td>330001</td>
            <td>3301</td>
            <td>33</td>
        </tr>
        <tr>
            <td>3550308</td>
            <td>São Paulo</td>
            <td>1521.202</td>
            <td>11253503</td>
            <td>12200180</td>
            <td>350001</td>
            <td>3501</td>
            <td>35</td>
        </tr>
        <tr>
            <td>5300108</td>
            <td>Brasília</td>
            <td>5760.784</td>
            <td>2570160</td>
            <td>2923369</td>
            <td>530001</td>
            <td>5301</td>
            <td>53</td>
        </tr>
    </tbody>
</table></div></div>
</div>
<p>Podemos usar o operador <code class="docutils literal notranslate"><span class="pre">NOT</span></code> para inverter o resultado de uma condição. Por exemplo, vamos aplicar a mesma consulta anterior, mas incluindo mais uma condição na cláusula <code class="docutils literal notranslate"><span class="pre">WHERE</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
SELECT *
FROM censo_mun
WHERE popul_2022 &gt; 2500000 AND popul_2010 &gt; 2000000 AND NOT nome_mun = &#39;Fortaleza&#39;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
4 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>cd_geocodi</th>
            <th>nome_mun</th>
            <th>area_km2</th>
            <th>popul_2010</th>
            <th>popul_2022</th>
            <th>cod_rgi</th>
            <th>cod_rgint</th>
            <th>cod_uf</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>2927408</td>
            <td>Salvador</td>
            <td>693.442</td>
            <td>2675656</td>
            <td>2610987</td>
            <td>290001</td>
            <td>2901</td>
            <td>29</td>
        </tr>
        <tr>
            <td>3304557</td>
            <td>Rio de Janeiro</td>
            <td>1200.329</td>
            <td>6320446</td>
            <td>6625849</td>
            <td>330001</td>
            <td>3301</td>
            <td>33</td>
        </tr>
        <tr>
            <td>3550308</td>
            <td>São Paulo</td>
            <td>1521.202</td>
            <td>11253503</td>
            <td>12200180</td>
            <td>350001</td>
            <td>3501</td>
            <td>35</td>
        </tr>
        <tr>
            <td>5300108</td>
            <td>Brasília</td>
            <td>5760.784</td>
            <td>2570160</td>
            <td>2923369</td>
            <td>530001</td>
            <td>5301</td>
            <td>53</td>
        </tr>
    </tbody>
</table></div></div>
</div>
<p>Como o operador NOT foi adicionado antes de nome_mun = ‘Fortaleza’, os registros que satisfaçam essa condição (ou seja, cujo nome seja Fortaleza) não foram recuperados pela consulta.</p>
<p><em>Utilizando o Operador <code class="docutils literal notranslate"><span class="pre">LIKE</span></code>:</em></p>
<p>O operador <code class="docutils literal notranslate"><span class="pre">LIKE</span></code> é usado em uma cláusula <code class="docutils literal notranslate"><span class="pre">WHERE</span></code> para procurar por um padrão especificado em uma coluna. Para recuperar todos os estados que começam com a letra ‘S’:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
SELECT *
FROM estado
WHERE nome_uf LIKE &#39;S%&#39;;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
3 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>cod_uf</th>
            <th>nome_uf</th>
            <th>sigla_uf</th>
            <th>cod_rg</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>28</td>
            <td>Sergipe</td>
            <td>SE</td>
            <td>2</td>
        </tr>
        <tr>
            <td>35</td>
            <td>São Paulo</td>
            <td>SP</td>
            <td>3</td>
        </tr>
        <tr>
            <td>42</td>
            <td>Santa Catarina</td>
            <td>SC</td>
            <td>4</td>
        </tr>
    </tbody>
</table></div></div>
</div>
<p><em>Especificando Múltiplos Valores com <code class="docutils literal notranslate"><span class="pre">IN</span></code>:</em></p>
<p>O operador <code class="docutils literal notranslate"><span class="pre">IN</span></code> permite especificar múltiplos valores em uma cláusula <code class="docutils literal notranslate"><span class="pre">WHERE</span></code>:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span>
<span class="k">FROM</span><span class="w"> </span><span class="n">nome_da_tabela</span><span class="w"> </span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">coluna1</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;valor1&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;valor2&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;valor3&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>Essa consulta retornará todos os registros onde “coluna1” é igual a ‘valor1’, ‘valor2’, ou ‘valor3’.</p>
<p>Para recuperar os registros referentes as regiões intermediárias existentes nos estados de Goiás, Mato Grosso e Mato Grosso do Sul, podemos consultar a tabela regiao_int pelo código de cada estado (cod_uf).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
SELECT *
FROM regiao_inter
WHERE cod_uf IN (50, 51, 52);
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
14 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>cod_rgint</th>
            <th>nome_rgint</th>
            <th>cod_uf</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>5001</td>
            <td>Campo Grande</td>
            <td>50</td>
        </tr>
        <tr>
            <td>5002</td>
            <td>Dourados</td>
            <td>50</td>
        </tr>
        <tr>
            <td>5003</td>
            <td>Corumbá</td>
            <td>50</td>
        </tr>
        <tr>
            <td>5101</td>
            <td>Cuiabá</td>
            <td>51</td>
        </tr>
        <tr>
            <td>5102</td>
            <td>Cáceres</td>
            <td>51</td>
        </tr>
        <tr>
            <td>5103</td>
            <td>Sinop</td>
            <td>51</td>
        </tr>
        <tr>
            <td>5104</td>
            <td>Barra do Garças</td>
            <td>51</td>
        </tr>
        <tr>
            <td>5105</td>
            <td>Rondonópolis</td>
            <td>51</td>
        </tr>
        <tr>
            <td>5201</td>
            <td>Goiânia</td>
            <td>52</td>
        </tr>
        <tr>
            <td>5202</td>
            <td>Itumbiara</td>
            <td>52</td>
        </tr>
        <tr>
            <td>5203</td>
            <td>Rio Verde</td>
            <td>52</td>
        </tr>
        <tr>
            <td>5204</td>
            <td>São Luís de Montes Belos - Iporá</td>
            <td>52</td>
        </tr>
        <tr>
            <td>5205</td>
            <td>Porangatu - Uruaçu</td>
            <td>52</td>
        </tr>
        <tr>
            <td>5206</td>
            <td>Luziânia - Águas Lindas de Goiás</td>
            <td>52</td>
        </tr>
    </tbody>
</table></div></div>
</div>
<p>Como nosso banco de dados está normalizado, para realizar a consulta usando o nome ou a sigla dos estados seria necessário realizar uma junção de tabelas. Abordaremos esse assunto mais adiante.</p>
<p><em>Selecionando Valores Dentro de um Intervalo com <code class="docutils literal notranslate"><span class="pre">BETWEEN</span></code>:</em></p>
<p>O operador <code class="docutils literal notranslate"><span class="pre">BETWEEN</span></code> seleciona valores dentro de um intervalo. Os valores podem ser números, texto ou datas:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span>
<span class="k">FROM</span><span class="w"> </span><span class="n">nome_da_tabela</span><span class="w"> </span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">coluna1</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="s1">&#39;valor1&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="s1">&#39;valor2&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p>Essa consulta retornará todos os registros onde “coluna1” está entre ‘valor1’ e ‘valor2’, inclusive. Para consultar municípios com população entre 500 e 1.000 habitantes em 2022:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
SELECT *
FROM censo_mun
WHERE popul_2022 BETWEEN 500 AND 1000;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
4 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>cd_geocodi</th>
            <th>nome_mun</th>
            <th>area_km2</th>
            <th>popul_2010</th>
            <th>popul_2022</th>
            <th>cod_rgi</th>
            <th>cod_rgint</th>
            <th>cod_uf</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>3166600</td>
            <td>Serra da Saudade</td>
            <td>335.659</td>
            <td>815</td>
            <td>836</td>
            <td>310067</td>
            <td>3113</td>
            <td>31</td>
        </tr>
        <tr>
            <td>3507209</td>
            <td>Borá</td>
            <td>118.951</td>
            <td>805</td>
            <td>877</td>
            <td>350014</td>
            <td>3504</td>
            <td>35</td>
        </tr>
        <tr>
            <td>5101209</td>
            <td>Araguainha</td>
            <td>675.231</td>
            <td>1096</td>
            <td>998</td>
            <td>510016</td>
            <td>5105</td>
            <td>51</td>
        </tr>
        <tr>
            <td>5201207</td>
            <td>Anhanguera</td>
            <td>55.569</td>
            <td>1020</td>
            <td>927</td>
            <td>520004</td>
            <td>5201</td>
            <td>52</td>
        </tr>
    </tbody>
</table></div></div>
</div>
<p>As declarações condicionais são usadas para executar diferentes ações com base em condições específicas. Embora aqui tenhamos utilizado essas consultas na cláusula <code class="docutils literal notranslate"><span class="pre">WHERE</span></code>, também podemos utilizá-las em cláusulas como <code class="docutils literal notranslate"><span class="pre">HAVING</span></code> e <code class="docutils literal notranslate"><span class="pre">CASE</span></code>.</p>
</div>
<div class="section" id="agrupamento-de-dados-em-sql">
<h2>2.6 Agrupamento de Dados em SQL<a class="headerlink" href="#agrupamento-de-dados-em-sql" title="Permalink to this heading">#</a></h2>
<p>O agrupamento de dados é uma técnica essencial em bancos de dados relacionais, permitindo a análise de subconjuntos de dados para extrair padrões e estatísticas significativas. As cláusulas <code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span></code> e <code class="docutils literal notranslate"><span class="pre">HAVING</span></code> são elementos-chave que permitem agrupar dados logicamente e filtrar os resultados com base em condições específicas.</p>
<p>Com a cláusula GROUP BY, os dados podem ser agrupados de forma lógica, e a cláusula HAVING pode ser usada para aplicar filtros específicos nos resultados desses agrupamentos. Neste tópico veremos como essas cláusulas são usadas em conjunto para realizar operações de agrupamento de dados complexas e úteis.</p>
<p>Para exemplificar o agrupamento de dados utilizando o nosso banco de dados, vamos inicialmente criar uma nova tabela, a tabela censo_mun_uf, que conterá o nome e a sigla do estado a qual cada município pertence (na tabela censo_mun, temos apenas a chave estrangeira cod_uf, com o código de cada estado). Para tanto, vamos realizar uma junção de tabelas. Na próxima seção, discutiremos em mais detalhes as junções de tabelas.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
CREATE TABLE censo_mun_uf AS
SELECT c.nome_mun, c.popul_2010, c.popul_2022, e.cod_uf, e.nome_uf, e.sigla_uf
FROM estado e
JOIN censo_mun c ON e.cod_uf = c.cod_uf;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>5570 rows affected.
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[]
</pre></div>
</div>
</div>
</div>
<p><strong>A cláusula GROUP BY</strong></p>
<p>A cláusula <code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span></code> é utilizada após a instrução <code class="docutils literal notranslate"><span class="pre">FROM</span></code> e <code class="docutils literal notranslate"><span class="pre">WHERE</span></code> (se houver), e antes de <code class="docutils literal notranslate"><span class="pre">ORDER</span> <span class="pre">BY</span></code> ou <code class="docutils literal notranslate"><span class="pre">LIMIT</span></code>. Ela indica ao banco de dados para combinar as linhas que contêm o mesmo valor na coluna especificada em grupos únicos. Dentro de cada grupo, é possível aplicar funções de agregação, como <code class="docutils literal notranslate"><span class="pre">COUNT</span></code>, <code class="docutils literal notranslate"><span class="pre">SUM</span></code>, <code class="docutils literal notranslate"><span class="pre">AVG</span></code>, <code class="docutils literal notranslate"><span class="pre">MAX</span></code> e <code class="docutils literal notranslate"><span class="pre">MIN</span></code>, para resumir os dados.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">coluna1</span><span class="p">,</span><span class="w"> </span><span class="n">coluna2</span><span class="p">,</span><span class="w"> </span><span class="p">...</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">nome_tabela</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">condição</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">coluna</span><span class="p">;</span>
</pre></div>
</div>
<p>Vamos utilizar a cláusula <code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span></code> para visualizar os dados de população agrupados por estado (nesta consulta não utilizaremos a cláusula <code class="docutils literal notranslate"><span class="pre">WHERE</span></code>):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
SELECT nome_uf, SUM(popul_2022) AS total_populacao_2022
FROM censo_mun_uf
GROUP BY nome_uf;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
27 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>nome_uf</th>
            <th>total_populacao_2022</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Paraná</td>
            <td>11835379</td>
        </tr>
        <tr>
            <td>Espírito Santo</td>
            <td>3975100</td>
        </tr>
        <tr>
            <td>Amazonas</td>
            <td>3949779</td>
        </tr>
        <tr>
            <td>Pará</td>
            <td>8442962</td>
        </tr>
        <tr>
            <td>Sergipe</td>
            <td>2211868</td>
        </tr>
        <tr>
            <td>Mato Grosso do Sul</td>
            <td>2833742</td>
        </tr>
        <tr>
            <td>Santa Catarina</td>
            <td>7762154</td>
        </tr>
        <tr>
            <td>Bahia</td>
            <td>14659023</td>
        </tr>
        <tr>
            <td>Rio Grande do Sul</td>
            <td>11088065</td>
        </tr>
        <tr>
            <td>Alagoas</td>
            <td>3125254</td>
        </tr>
        <tr>
            <td>Mato Grosso</td>
            <td>3784239</td>
        </tr>
        <tr>
            <td>Distrito Federal</td>
            <td>2923369</td>
        </tr>
        <tr>
            <td>Rio de Janeiro</td>
            <td>16615526</td>
        </tr>
        <tr>
            <td>Goiás</td>
            <td>6950976</td>
        </tr>
        <tr>
            <td>Rondônia</td>
            <td>1616379</td>
        </tr>
        <tr>
            <td>Amapá</td>
            <td>774268</td>
        </tr>
        <tr>
            <td>Acre</td>
            <td>829780</td>
        </tr>
        <tr>
            <td>Maranhão</td>
            <td>6800605</td>
        </tr>
        <tr>
            <td>Paraíba</td>
            <td>4030961</td>
        </tr>
        <tr>
            <td>Rio Grande do Norte</td>
            <td>3303953</td>
        </tr>
        <tr>
            <td>Pernambuco</td>
            <td>9051113</td>
        </tr>
        <tr>
            <td>Piauí</td>
            <td>3270174</td>
        </tr>
        <tr>
            <td>Roraima</td>
            <td>634805</td>
        </tr>
        <tr>
            <td>Tocantins</td>
            <td>1584306</td>
        </tr>
        <tr>
            <td>São Paulo</td>
            <td>46024937</td>
        </tr>
        <tr>
            <td>Ceará</td>
            <td>8936431</td>
        </tr>
        <tr>
            <td>Minas Gerais</td>
            <td>20732660</td>
        </tr>
    </tbody>
</table></div></div>
</div>
<p><em>Ordenação dos Resultados do Agrupamento:</em></p>
<p>Para organizar os dados em ordem ascendente ou descendente, utilizamos <code class="docutils literal notranslate"><span class="pre">ASC</span></code> (ascendente) ou <code class="docutils literal notranslate"><span class="pre">DESC</span></code> (descendente), logo após a declaração da coluna na cláusula <code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span></code>. Por exemplo, visualizar os dados de população de 2022 em ordem alfabética:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
SELECT nome_uf, SUM(popul_2022) AS total_populacao_2022
FROM censo_mun_uf
GROUP BY nome_uf
ORDER BY nome_uf ASC;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
27 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>nome_uf</th>
            <th>total_populacao_2022</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Acre</td>
            <td>829780</td>
        </tr>
        <tr>
            <td>Alagoas</td>
            <td>3125254</td>
        </tr>
        <tr>
            <td>Amapá</td>
            <td>774268</td>
        </tr>
        <tr>
            <td>Amazonas</td>
            <td>3949779</td>
        </tr>
        <tr>
            <td>Bahia</td>
            <td>14659023</td>
        </tr>
        <tr>
            <td>Ceará</td>
            <td>8936431</td>
        </tr>
        <tr>
            <td>Distrito Federal</td>
            <td>2923369</td>
        </tr>
        <tr>
            <td>Espírito Santo</td>
            <td>3975100</td>
        </tr>
        <tr>
            <td>Goiás</td>
            <td>6950976</td>
        </tr>
        <tr>
            <td>Maranhão</td>
            <td>6800605</td>
        </tr>
        <tr>
            <td>Mato Grosso</td>
            <td>3784239</td>
        </tr>
        <tr>
            <td>Mato Grosso do Sul</td>
            <td>2833742</td>
        </tr>
        <tr>
            <td>Minas Gerais</td>
            <td>20732660</td>
        </tr>
        <tr>
            <td>Pará</td>
            <td>8442962</td>
        </tr>
        <tr>
            <td>Paraíba</td>
            <td>4030961</td>
        </tr>
        <tr>
            <td>Paraná</td>
            <td>11835379</td>
        </tr>
        <tr>
            <td>Pernambuco</td>
            <td>9051113</td>
        </tr>
        <tr>
            <td>Piauí</td>
            <td>3270174</td>
        </tr>
        <tr>
            <td>Rio de Janeiro</td>
            <td>16615526</td>
        </tr>
        <tr>
            <td>Rio Grande do Norte</td>
            <td>3303953</td>
        </tr>
        <tr>
            <td>Rio Grande do Sul</td>
            <td>11088065</td>
        </tr>
        <tr>
            <td>Rondônia</td>
            <td>1616379</td>
        </tr>
        <tr>
            <td>Roraima</td>
            <td>634805</td>
        </tr>
        <tr>
            <td>Santa Catarina</td>
            <td>7762154</td>
        </tr>
        <tr>
            <td>São Paulo</td>
            <td>46024937</td>
        </tr>
        <tr>
            <td>Sergipe</td>
            <td>2211868</td>
        </tr>
        <tr>
            <td>Tocantins</td>
            <td>1584306</td>
        </tr>
    </tbody>
</table></div></div>
</div>
<p>Para visualizar os dados em ordem decrescente de acordo com o agrupamento de população (coluna total_populacao_2022):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
SELECT nome_uf, SUM(popul_2022) AS total_populacao_2022
FROM censo_mun_uf
GROUP BY nome_uf
ORDER BY total_populacao_2022 DESC;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>27 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>nome_uf</th>
            <th>total_populacao_2022</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>São Paulo</td>
            <td>46024937</td>
        </tr>
        <tr>
            <td>Minas Gerais</td>
            <td>20732660</td>
        </tr>
        <tr>
            <td>Rio de Janeiro</td>
            <td>16615526</td>
        </tr>
        <tr>
            <td>Bahia</td>
            <td>14659023</td>
        </tr>
        <tr>
            <td>Paraná</td>
            <td>11835379</td>
        </tr>
        <tr>
            <td>Rio Grande do Sul</td>
            <td>11088065</td>
        </tr>
        <tr>
            <td>Pernambuco</td>
            <td>9051113</td>
        </tr>
        <tr>
            <td>Ceará</td>
            <td>8936431</td>
        </tr>
        <tr>
            <td>Pará</td>
            <td>8442962</td>
        </tr>
        <tr>
            <td>Santa Catarina</td>
            <td>7762154</td>
        </tr>
        <tr>
            <td>Goiás</td>
            <td>6950976</td>
        </tr>
        <tr>
            <td>Maranhão</td>
            <td>6800605</td>
        </tr>
        <tr>
            <td>Paraíba</td>
            <td>4030961</td>
        </tr>
        <tr>
            <td>Espírito Santo</td>
            <td>3975100</td>
        </tr>
        <tr>
            <td>Amazonas</td>
            <td>3949779</td>
        </tr>
        <tr>
            <td>Mato Grosso</td>
            <td>3784239</td>
        </tr>
        <tr>
            <td>Rio Grande do Norte</td>
            <td>3303953</td>
        </tr>
        <tr>
            <td>Piauí</td>
            <td>3270174</td>
        </tr>
        <tr>
            <td>Alagoas</td>
            <td>3125254</td>
        </tr>
        <tr>
            <td>Distrito Federal</td>
            <td>2923369</td>
        </tr>
        <tr>
            <td>Mato Grosso do Sul</td>
            <td>2833742</td>
        </tr>
        <tr>
            <td>Sergipe</td>
            <td>2211868</td>
        </tr>
        <tr>
            <td>Rondônia</td>
            <td>1616379</td>
        </tr>
        <tr>
            <td>Tocantins</td>
            <td>1584306</td>
        </tr>
        <tr>
            <td>Acre</td>
            <td>829780</td>
        </tr>
        <tr>
            <td>Amapá</td>
            <td>774268</td>
        </tr>
        <tr>
            <td>Roraima</td>
            <td>634805</td>
        </tr>
    </tbody>
</table></div></div>
</div>
<p><em>Visualizando os estados mais e menos populosos:</em></p>
<p>É possível limitar a quantidade de linhas a ser plotada utilizando <code class="docutils literal notranslate"><span class="pre">LIMIT</span></code>. Por exemplo, visualizar os seis estados mais populosos do Brasil em 2022:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
SELECT nome_uf, SUM(popul_2022) AS total_populacao_2022
FROM censo_mun_uf
GROUP BY nome_uf
ORDER BY total_populacao_2022 DESC
LIMIT 6;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>6 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>nome_uf</th>
            <th>total_populacao_2022</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>São Paulo</td>
            <td>46024937</td>
        </tr>
        <tr>
            <td>Minas Gerais</td>
            <td>20732660</td>
        </tr>
        <tr>
            <td>Rio de Janeiro</td>
            <td>16615526</td>
        </tr>
        <tr>
            <td>Bahia</td>
            <td>14659023</td>
        </tr>
        <tr>
            <td>Paraná</td>
            <td>11835379</td>
        </tr>
        <tr>
            <td>Rio Grande do Sul</td>
            <td>11088065</td>
        </tr>
    </tbody>
</table></div></div>
</div>
<p>Para visualizar os seis estados menos populosos do Brasil em 2022:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
SELECT nome_uf, SUM(popul_2022) AS total_populacao_2022
FROM censo_mun_uf
GROUP BY nome_uf
ORDER BY total_populacao_2022 ASC
LIMIT 6;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
6 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>nome_uf</th>
            <th>total_populacao_2022</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Roraima</td>
            <td>634805</td>
        </tr>
        <tr>
            <td>Amapá</td>
            <td>774268</td>
        </tr>
        <tr>
            <td>Acre</td>
            <td>829780</td>
        </tr>
        <tr>
            <td>Tocantins</td>
            <td>1584306</td>
        </tr>
        <tr>
            <td>Rondônia</td>
            <td>1616379</td>
        </tr>
        <tr>
            <td>Sergipe</td>
            <td>2211868</td>
        </tr>
    </tbody>
</table></div></div>
</div>
<p><em>Utilização da Função COUNT:</em></p>
<p>A função <code class="docutils literal notranslate"><span class="pre">COUNT</span></code> conta o número de linhas que correspondem a um critério especificado. Para determinar quantos registros temos na tabela censo_ibge:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
SELECT COUNT(*)
FROM censo_mun_uf;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
1 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>count</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>5570</td>
        </tr>
    </tbody>
</table></div></div>
</div>
<p>Ao todo, temos 5570 registros na tabela censo_ibge, que corresponde ao número de municípios existentes no Brasil no ano de 2022. É possível utilizar a função <code class="docutils literal notranslate"><span class="pre">COUNT</span></code> com a cláusula <code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span></code>. Para contar o número de municípios por estado:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
SELECT nome_uf, COUNT(*)
FROM censo_mun_uf
GROUP BY nome_uf
ORDER BY count DESC;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
27 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>nome_uf</th>
            <th>count</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Minas Gerais</td>
            <td>853</td>
        </tr>
        <tr>
            <td>São Paulo</td>
            <td>645</td>
        </tr>
        <tr>
            <td>Rio Grande do Sul</td>
            <td>497</td>
        </tr>
        <tr>
            <td>Bahia</td>
            <td>417</td>
        </tr>
        <tr>
            <td>Paraná</td>
            <td>399</td>
        </tr>
        <tr>
            <td>Santa Catarina</td>
            <td>295</td>
        </tr>
        <tr>
            <td>Goiás</td>
            <td>246</td>
        </tr>
        <tr>
            <td>Piauí</td>
            <td>224</td>
        </tr>
        <tr>
            <td>Paraíba</td>
            <td>223</td>
        </tr>
        <tr>
            <td>Maranhão</td>
            <td>217</td>
        </tr>
        <tr>
            <td>Pernambuco</td>
            <td>185</td>
        </tr>
        <tr>
            <td>Ceará</td>
            <td>184</td>
        </tr>
        <tr>
            <td>Rio Grande do Norte</td>
            <td>167</td>
        </tr>
        <tr>
            <td>Pará</td>
            <td>144</td>
        </tr>
        <tr>
            <td>Mato Grosso</td>
            <td>141</td>
        </tr>
        <tr>
            <td>Tocantins</td>
            <td>139</td>
        </tr>
        <tr>
            <td>Alagoas</td>
            <td>102</td>
        </tr>
        <tr>
            <td>Rio de Janeiro</td>
            <td>92</td>
        </tr>
        <tr>
            <td>Mato Grosso do Sul</td>
            <td>79</td>
        </tr>
        <tr>
            <td>Espírito Santo</td>
            <td>78</td>
        </tr>
        <tr>
            <td>Sergipe</td>
            <td>75</td>
        </tr>
        <tr>
            <td>Amazonas</td>
            <td>62</td>
        </tr>
        <tr>
            <td>Rondônia</td>
            <td>52</td>
        </tr>
        <tr>
            <td>Acre</td>
            <td>22</td>
        </tr>
        <tr>
            <td>Amapá</td>
            <td>16</td>
        </tr>
        <tr>
            <td>Roraima</td>
            <td>15</td>
        </tr>
        <tr>
            <td>Distrito Federal</td>
            <td>1</td>
        </tr>
    </tbody>
</table></div></div>
</div>
<p>Para contar o número de municípios por estado com população maior que 300.000 habitantes:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
SELECT nome_uf, COUNT(*)
FROM censo_mun_uf
WHERE popul_2022 &gt; 300000
GROUP BY nome_uf
ORDER BY count DESC;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
27 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>nome_uf</th>
            <th>count</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>São Paulo</td>
            <td>27</td>
        </tr>
        <tr>
            <td>Rio de Janeiro</td>
            <td>9</td>
        </tr>
        <tr>
            <td>Minas Gerais</td>
            <td>8</td>
        </tr>
        <tr>
            <td>Paraná</td>
            <td>6</td>
        </tr>
        <tr>
            <td>Pernambuco</td>
            <td>6</td>
        </tr>
        <tr>
            <td>Bahia</td>
            <td>4</td>
        </tr>
        <tr>
            <td>Espírito Santo</td>
            <td>4</td>
        </tr>
        <tr>
            <td>Rio Grande do Sul</td>
            <td>4</td>
        </tr>
        <tr>
            <td>Goiás</td>
            <td>3</td>
        </tr>
        <tr>
            <td>Santa Catarina</td>
            <td>3</td>
        </tr>
        <tr>
            <td>Pará</td>
            <td>3</td>
        </tr>
        <tr>
            <td>Paraíba</td>
            <td>2</td>
        </tr>
        <tr>
            <td>Mato Grosso</td>
            <td>2</td>
        </tr>
        <tr>
            <td>Ceará</td>
            <td>2</td>
        </tr>
        <tr>
            <td>Roraima</td>
            <td>1</td>
        </tr>
        <tr>
            <td>Tocantins</td>
            <td>1</td>
        </tr>
        <tr>
            <td>Amazonas</td>
            <td>1</td>
        </tr>
        <tr>
            <td>Mato Grosso do Sul</td>
            <td>1</td>
        </tr>
        <tr>
            <td>Sergipe</td>
            <td>1</td>
        </tr>
        <tr>
            <td>Alagoas</td>
            <td>1</td>
        </tr>
        <tr>
            <td>Distrito Federal</td>
            <td>1</td>
        </tr>
        <tr>
            <td>Rondônia</td>
            <td>1</td>
        </tr>
        <tr>
            <td>Amapá</td>
            <td>1</td>
        </tr>
        <tr>
            <td>Acre</td>
            <td>1</td>
        </tr>
        <tr>
            <td>Maranhão</td>
            <td>1</td>
        </tr>
        <tr>
            <td>Rio Grande do Norte</td>
            <td>1</td>
        </tr>
        <tr>
            <td>Piauí</td>
            <td>1</td>
        </tr>
    </tbody>
</table></div></div>
</div>
<p><strong>A cláusula HAVING</strong></p>
<p>A cláusula <code class="docutils literal notranslate"><span class="pre">HAVING</span></code> é uma ferramentaem SQL usada para especificar condições de filtragem sobre os grupos de dados criados pela cláusula <code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span></code>. Diferente da cláusula <code class="docutils literal notranslate"><span class="pre">WHERE</span></code>, que filtra linhas antes de serem agrupadas, <code class="docutils literal notranslate"><span class="pre">HAVING</span></code> permite filtrar os grupos após serem formados, aplicando condições sobre os resultados agregados.</p>
<p><code class="docutils literal notranslate"><span class="pre">HAVING</span></code> é utilizada para filtrar resultados de consultas que agrupam dados, sendo especialmente útil em análises onde interessam grupos que atendem a critérios específicos, como:</p>
<ul class="simple">
<li><p>Somas que excedem um certo valor</p></li>
<li><p>Médias dentro de um intervalo específico</p></li>
<li><p>Contagens que ultrapassam um determinado limiar</p></li>
</ul>
<p>Para tanto, várias funções agregadoras podem ser usadas em combinação com a cláusula HAVING para realizar filtragem baseada em agregações. Aqui estão algumas das mais comuns:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">COUNT</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SUM</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">AVG</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MAX</span></code> E <code class="docutils literal notranslate"><span class="pre">MIN</span></code></p></li>
</ul>
<p><strong>Exemplos de uso com funções agregadas</strong></p>
<p><em>Contando itens em um grupo:</em></p>
<p><code class="docutils literal notranslate"><span class="pre">COUNT()</span></code>: Conta o número de itens em um grupo. Pode ser usada para filtrar grupos com um número específico de registros. Por exemplo, para recuperar os estados que possuem mais de 250 municípios:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
SELECT nome_uf
FROM censo_mun_uf
GROUP BY nome_uf
HAVING COUNT(nome_mun) &gt; 250;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
6 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>nome_uf</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Paraná</td>
        </tr>
        <tr>
            <td>Santa Catarina</td>
        </tr>
        <tr>
            <td>Bahia</td>
        </tr>
        <tr>
            <td>Rio Grande do Sul</td>
        </tr>
        <tr>
            <td>São Paulo</td>
        </tr>
        <tr>
            <td>Minas Gerais</td>
        </tr>
    </tbody>
</table></div></div>
</div>
<p><em>Somando valores de um grupo:</em></p>
<p><code class="docutils literal notranslate"><span class="pre">SUM()</span></code>: Calcula a soma total dos valores numéricos em um grupo. Útil para filtrar grupos com uma soma total que excede um valor definido. Para recuperar os estados com menos de um milhão de habitantes de acordo com o Censo de 2022:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
SELECT nome_uf
FROM censo_mun_uf
GROUP BY nome_uf
HAVING SUM(popul_2022) &lt; 1000000;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
3 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>nome_uf</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Amapá</td>
        </tr>
        <tr>
            <td>Acre</td>
        </tr>
        <tr>
            <td>Roraima</td>
        </tr>
    </tbody>
</table></div></div>
</div>
<p><em>Encontrando Valores Máximos e Mínimos:</em></p>
<p><code class="docutils literal notranslate"><span class="pre">MAX()</span></code> e <code class="docutils literal notranslate"><span class="pre">MIN()</span></code>: Encontram, respectivamente, o valor máximo e mínimo em um grupo. Essas funções podem ser usadas para filtrar grupos baseados no valor máximo ou mínimo de uma coluna. Para recuperar os estados que possuem municípios com mais de dois milhões de habitantes em 2022:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
SELECT nome_uf
FROM censo_mun_uf
GROUP BY nome_uf
HAVING MAX(popul_2022) &gt; 2000000;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>7 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>nome_uf</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Amazonas</td>
        </tr>
        <tr>
            <td>Bahia</td>
        </tr>
        <tr>
            <td>Distrito Federal</td>
        </tr>
        <tr>
            <td>Rio de Janeiro</td>
        </tr>
        <tr>
            <td>São Paulo</td>
        </tr>
        <tr>
            <td>Ceará</td>
        </tr>
        <tr>
            <td>Minas Gerais</td>
        </tr>
    </tbody>
</table></div></div>
</div>
<p>Após determinar os estados que cumprem os critérios acima, é possível listar os municípios específicos com populações superiores a dois milhões de habitantes:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
SELECT nome_mun, popul_2022, sigla_uf
FROM censo_mun_uf
WHERE popul_2022 &gt; 2000000;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>7 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>nome_mun</th>
            <th>popul_2022</th>
            <th>sigla_uf</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Manaus</td>
            <td>2054731</td>
            <td>AM</td>
        </tr>
        <tr>
            <td>Fortaleza</td>
            <td>2596157</td>
            <td>CE</td>
        </tr>
        <tr>
            <td>Salvador</td>
            <td>2610987</td>
            <td>BA</td>
        </tr>
        <tr>
            <td>Belo Horizonte</td>
            <td>2392678</td>
            <td>MG</td>
        </tr>
        <tr>
            <td>Rio de Janeiro</td>
            <td>6625849</td>
            <td>RJ</td>
        </tr>
        <tr>
            <td>São Paulo</td>
            <td>12200180</td>
            <td>SP</td>
        </tr>
        <tr>
            <td>Brasília</td>
            <td>2923369</td>
            <td>DF</td>
        </tr>
    </tbody>
</table></div></div>
</div>
<p><strong>A Expressão Condicional CASE</strong></p>
<p>A expressão <code class="docutils literal notranslate"><span class="pre">CASE</span></code> em SQL é equivalente à lógica de “if-else” encontrada em outras linguagens de programação, permitindo a execução de operações condicionais dentro de consultas SQL. A expressão <code class="docutils literal notranslate"><span class="pre">CASE</span></code> pode ser utilizada em diversas cláusulas do SQL, incluindo <code class="docutils literal notranslate"><span class="pre">SELECT</span></code>, <code class="docutils literal notranslate"><span class="pre">WHERE</span></code>, <code class="docutils literal notranslate"><span class="pre">ORDER</span> <span class="pre">BY</span></code>, entre outras. A sintaxe básica é:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CASE</span>
<span class="w">    </span><span class="k">WHEN</span><span class="w"> </span><span class="n">condicao1</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="n">resultado1</span>
<span class="w">    </span><span class="k">WHEN</span><span class="w"> </span><span class="n">condicao2</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="n">resultado2</span>
<span class="w">    </span><span class="p">...</span>
<span class="w">    </span><span class="k">ELSE</span><span class="w"> </span><span class="n">resultadoPadrao</span>
<span class="k">END</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">condicao1</span></code>, <code class="docutils literal notranslate"><span class="pre">condicao2</span></code>, …: Condições a serem testadas.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">resultado1</span></code>, <code class="docutils literal notranslate"><span class="pre">resultado2</span></code>, …: Resultados correspondentes para cada condição verdadeira.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">resultadoPadrao</span></code>: Resultado retornado caso nenhuma condição anterior seja verdadeira (similar ao <code class="docutils literal notranslate"><span class="pre">else</span></code> em outras linguagens).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">END</span></code>: Finaliza a expressão <code class="docutils literal notranslate"><span class="pre">CASE</span></code>.</p></li>
</ul>
<p><strong>Exemplo Prático: categorizando variação da população</strong></p>
<p>O seguinte exemplo demonstra como utilizar a expressão <code class="docutils literal notranslate"><span class="pre">CASE</span></code> em uma instrução <code class="docutils literal notranslate"><span class="pre">SELECT</span></code> para analisar e categorizar a variação da população de cada município entre os anos de 2010 e 2022:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
SELECT nome_mun, sigla_uf,
       CASE
           WHEN popul_2022 &lt; popul_2010 THEN &#39;Redução da população&#39;
           WHEN popul_2022 = popul_2010 THEN &#39;Sem alteração na população&#39;
           ELSE &#39;Aumento da população&#39;
       END AS situacao_populacao
FROM censo_mun_uf
LIMIT 15;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>15 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>nome_mun</th>
            <th>sigla_uf</th>
            <th>situacao_populacao</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Alta Floresta D&#x27;Oeste</td>
            <td>RO</td>
            <td>Redução da população</td>
        </tr>
        <tr>
            <td>Ariquemes</td>
            <td>RO</td>
            <td>Aumento da população</td>
        </tr>
        <tr>
            <td>Cabixi</td>
            <td>RO</td>
            <td>Redução da população</td>
        </tr>
        <tr>
            <td>Cacoal</td>
            <td>RO</td>
            <td>Aumento da população</td>
        </tr>
        <tr>
            <td>Cerejeiras</td>
            <td>RO</td>
            <td>Redução da população</td>
        </tr>
        <tr>
            <td>Colorado do Oeste</td>
            <td>RO</td>
            <td>Redução da população</td>
        </tr>
        <tr>
            <td>Corumbiara</td>
            <td>RO</td>
            <td>Redução da população</td>
        </tr>
        <tr>
            <td>Costa Marques</td>
            <td>RO</td>
            <td>Redução da população</td>
        </tr>
        <tr>
            <td>Espigão D&#x27;Oeste</td>
            <td>RO</td>
            <td>Aumento da população</td>
        </tr>
        <tr>
            <td>Guajará-Mirim</td>
            <td>RO</td>
            <td>Redução da população</td>
        </tr>
        <tr>
            <td>Jaru</td>
            <td>RO</td>
            <td>Aumento da população</td>
        </tr>
        <tr>
            <td>Ji-Paraná</td>
            <td>RO</td>
            <td>Aumento da população</td>
        </tr>
        <tr>
            <td>Machadinho D&#x27;Oeste</td>
            <td>RO</td>
            <td>Redução da população</td>
        </tr>
        <tr>
            <td>Nova Brasilândia D&#x27;Oeste</td>
            <td>RO</td>
            <td>Redução da população</td>
        </tr>
        <tr>
            <td>Ouro Preto do Oeste</td>
            <td>RO</td>
            <td>Redução da população</td>
        </tr>
    </tbody>
</table></div></div>
</div>
<p>A consulta SQL apresentada realiza as seguintes operações na tabela <code class="docutils literal notranslate"><span class="pre">censo_mun_uf</span></code>:</p>
<ol class="arabic simple">
<li><p><strong>Seleciona Colunas</strong>: Especifica que as colunas <code class="docutils literal notranslate"><span class="pre">nome_mun</span></code> (nome do município) e <code class="docutils literal notranslate"><span class="pre">sigla_uf</span></code> (sigla do estado) devem ser retornadas nos resultados.</p></li>
<li><p><strong>Calcula Condição com CASE</strong>: Utiliza a cláusula <code class="docutils literal notranslate"><span class="pre">CASE</span></code> para criar uma lógica condicional que compara a população dos municípios nos anos de 2022 (<code class="docutils literal notranslate"><span class="pre">popul_2022</span></code>) e 2010 (<code class="docutils literal notranslate"><span class="pre">popul_2010</span></code>). Com base nessa comparação, atribui um dos três rótulos a uma coluna calculada chamada <code class="docutils literal notranslate"><span class="pre">situacao_populacao</span></code>:</p>
<ul class="simple">
<li><p>Se a população de 2022 for menor que a de 2010, a situação da população é descrita como <code class="docutils literal notranslate"><span class="pre">'Redução</span> <span class="pre">da</span> <span class="pre">população'</span></code>.</p></li>
<li><p>Se a população de 2022 for igual à de 2010, a situação da população é descrita como <code class="docutils literal notranslate"><span class="pre">'Sem</span> <span class="pre">alteração</span> <span class="pre">na</span> <span class="pre">população'</span></code>.</p></li>
<li><p>Se nenhuma das condições acima for verdadeira (o que implica que a população de 2022 é maior que a de 2010), a situação da população é descrita como <code class="docutils literal notranslate"><span class="pre">'Aumento</span> <span class="pre">da</span> <span class="pre">população'</span></code>.</p></li>
</ul>
</li>
<li><p><strong>Sem Filtro de WHERE</strong>: A consulta não especifica uma cláusula <code class="docutils literal notranslate"><span class="pre">WHERE</span></code>, o que significa que ela irá avaliar e retornar resultados para todos os registros presentes na tabela <code class="docutils literal notranslate"><span class="pre">censo_mun_uf</span></code>.</p></li>
</ol>
<p>Para verificar o número total de municípios que apresentaram aumento ou redução da população entre 2010 e 2022:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
SELECT
  COUNT(CASE WHEN popul_2022 &gt; popul_2010 THEN 1 END) AS aumento_populacao,
  COUNT(CASE WHEN popul_2022 &lt; popul_2010 THEN 1 END) AS reducao_populacao
FROM censo_mun_uf;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>aumento_populacao</th>
            <th>reducao_populacao</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>3215</td>
            <td>2354</td>
        </tr>
    </tbody>
</table></div></div>
</div>
<p>Além disso, é possível agrupar esses dados por estado, proporcionando uma visão detalhada das tendências de população em diferentes regiões:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
SELECT
  sigla_uf,
  COUNT(CASE WHEN popul_2022 &gt; popul_2010 THEN 1 END) AS aumento_populacao,
  COUNT(CASE WHEN popul_2022 &lt; popul_2010 THEN 1 END) AS reducao_populacao
FROM censo_mun_uf
GROUP BY sigla_uf
ORDER BY sigla_uf;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>27 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>sigla_uf</th>
            <th>aumento_populacao</th>
            <th>reducao_populacao</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>AC</td>
            <td>21</td>
            <td>1</td>
        </tr>
        <tr>
            <td>AL</td>
            <td>34</td>
            <td>68</td>
        </tr>
        <tr>
            <td>AM</td>
            <td>48</td>
            <td>14</td>
        </tr>
        <tr>
            <td>AP</td>
            <td>11</td>
            <td>5</td>
        </tr>
        <tr>
            <td>BA</td>
            <td>221</td>
            <td>196</td>
        </tr>
        <tr>
            <td>CE</td>
            <td>106</td>
            <td>78</td>
        </tr>
        <tr>
            <td>DF</td>
            <td>1</td>
            <td>0</td>
        </tr>
        <tr>
            <td>ES</td>
            <td>59</td>
            <td>19</td>
        </tr>
        <tr>
            <td>GO</td>
            <td>164</td>
            <td>82</td>
        </tr>
        <tr>
            <td>MA</td>
            <td>98</td>
            <td>119</td>
        </tr>
        <tr>
            <td>MG</td>
            <td>428</td>
            <td>424</td>
        </tr>
        <tr>
            <td>MS</td>
            <td>62</td>
            <td>17</td>
        </tr>
        <tr>
            <td>MT</td>
            <td>100</td>
            <td>41</td>
        </tr>
        <tr>
            <td>PA</td>
            <td>104</td>
            <td>40</td>
        </tr>
        <tr>
            <td>PB</td>
            <td>126</td>
            <td>97</td>
        </tr>
        <tr>
            <td>PE</td>
            <td>93</td>
            <td>92</td>
        </tr>
        <tr>
            <td>PI</td>
            <td>121</td>
            <td>103</td>
        </tr>
        <tr>
            <td>PR</td>
            <td>247</td>
            <td>152</td>
        </tr>
        <tr>
            <td>RJ</td>
            <td>66</td>
            <td>26</td>
        </tr>
        <tr>
            <td>RN</td>
            <td>90</td>
            <td>77</td>
        </tr>
        <tr>
            <td>RO</td>
            <td>17</td>
            <td>35</td>
        </tr>
        <tr>
            <td>RR</td>
            <td>14</td>
            <td>1</td>
        </tr>
        <tr>
            <td>RS</td>
            <td>208</td>
            <td>289</td>
        </tr>
        <tr>
            <td>SC</td>
            <td>220</td>
            <td>75</td>
        </tr>
        <tr>
            <td>SE</td>
            <td>45</td>
            <td>30</td>
        </tr>
        <tr>
            <td>SP</td>
            <td>439</td>
            <td>206</td>
        </tr>
        <tr>
            <td>TO</td>
            <td>72</td>
            <td>67</td>
        </tr>
    </tbody>
</table></div></div>
</div>
</div>
<div class="section" id="uniao-de-tabelas-no-sql">
<h2>2.7 União de Tabelas no SQL<a class="headerlink" href="#uniao-de-tabelas-no-sql" title="Permalink to this heading">#</a></h2>
<p>A união de tabelas em bancos de dados relacionais é uma operação que permite combinar colunas de duas ou mais tabelas com base em uma condição de relacionamento, geralmente uma chave comum entre as tabelas. A SQL fornece vários tipos de JOINs para diferentes situações, como <code class="docutils literal notranslate"><span class="pre">INNER</span> <span class="pre">JOIN</span></code>, <code class="docutils literal notranslate"><span class="pre">LEFT</span> <span class="pre">JOIN</span></code>, <code class="docutils literal notranslate"><span class="pre">RIGHT</span> <span class="pre">JOIN</span></code> e <code class="docutils literal notranslate"><span class="pre">FULL</span> <span class="pre">JOIN</span></code>. Além disso, sub consultas e operações de conjunto também são usadas para obter dados relacionados. Nesse tópico vamos abordar como e quando usar cada tipo de <code class="docutils literal notranslate"><span class="pre">JOIN</span></code> e introduzir brevemente sub consultas e operações de conjunto.</p>
<div class="section" id="inner-join">
<h3>2.7.1 INNER JOIN<a class="headerlink" href="#inner-join" title="Permalink to this heading">#</a></h3>
<p>O <code class="docutils literal notranslate"><span class="pre">INNER</span> <span class="pre">JOIN</span></code> é uma operação SQL usada para combinar linhas de duas ou mais tabelas com base na correspondência de colunas relacionadas entre elas. Somente as linhas que atendem à condição especificada são incluídas no conjunto de resultados.</p>
<p>Considere duas tabelas simples para ilustrar o uso do <code class="docutils literal notranslate"><span class="pre">INNER</span> <span class="pre">JOIN</span></code>:</p>
<ul>
<li><p><strong>Tabela Usuarios</strong></p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>UsuarioID</p></th>
<th class="head"><p>Nome</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>Ana</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>João</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>Maria</p></td>
</tr>
</tbody>
</table>
</li>
<li><p><strong>Tabela Pedidos</strong></p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>PedidoID</p></th>
<th class="head"><p>UsuarioID</p></th>
<th class="head"><p>Produto</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>101</p></td>
<td><p>1</p></td>
<td><p>Livro</p></td>
</tr>
<tr class="row-odd"><td><p>102</p></td>
<td><p>2</p></td>
<td><p>Caneta</p></td>
</tr>
<tr class="row-even"><td><p>103</p></td>
<td><p>3</p></td>
<td><p>Caderno</p></td>
</tr>
</tbody>
</table>
</li>
</ul>
<p><em>Criação e População das Tabelas:</em></p>
<p>Para criar e popular as tabelas <code class="docutils literal notranslate"><span class="pre">usuarios</span></code> e <code class="docutils literal notranslate"><span class="pre">pedidos</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
CREATE TABLE usuarios (
  UsuarioID int PRIMARY KEY,
  Nome varchar(255)
);
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
Done.
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
INSERT INTO usuarios (UsuarioID, Nome) VALUES
(1, &#39;Ana&#39;),
(2, &#39;João&#39;),
(3, &#39;Maria&#39;);
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3 rows affected.
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
CREATE TABLE pedidos (
  PedidoID int PRIMARY KEY,
  UsuarioID int,
  Produto varchar(255)
);
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Done.
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
INSERT INTO pedidos (PedidoID, UsuarioID, Produto) VALUES
(101, 1, &#39;Livro&#39;),
(102, 2, &#39;Caneta&#39;),
(103, 3, &#39;Caderno&#39;);
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3 rows affected.
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[]
</pre></div>
</div>
</div>
</div>
<p><em>Realizando o INNER JOIN:</em></p>
<p>Para combinar informações de pedidos com os nomes dos usuários correspondentes:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
SELECT 
    pedidos.PedidoID, 
    usuarios.Nome, 
    pedidos.Produto
FROM 
    pedidos
INNER JOIN 
    usuarios ON pedidos.UsuarioID = usuarios.UsuarioID;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
3 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>pedidoid</th>
            <th>nome</th>
            <th>produto</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>101</td>
            <td>Ana</td>
            <td>Livro</td>
        </tr>
        <tr>
            <td>102</td>
            <td>João</td>
            <td>Caneta</td>
        </tr>
        <tr>
            <td>103</td>
            <td>Maria</td>
            <td>Caderno</td>
        </tr>
    </tbody>
</table></div></div>
</div>
<p>Esta consulta seleciona o ID do pedido (<code class="docutils literal notranslate"><span class="pre">PedidoID</span></code>), o ID do usuário (<code class="docutils literal notranslate"><span class="pre">UsuarioID</span></code>), o nome do usuário (<code class="docutils literal notranslate"><span class="pre">Nome</span></code>) e o produto (<code class="docutils literal notranslate"><span class="pre">Produto</span></code>) das tabelas <code class="docutils literal notranslate"><span class="pre">pedidos</span></code> e <code class="docutils literal notranslate"><span class="pre">usuarios</span></code>. O <code class="docutils literal notranslate"><span class="pre">INNER</span> <span class="pre">JOIN</span></code> é usado para combinar as linhas de <code class="docutils literal notranslate"><span class="pre">pedidos</span></code> com as linhas correspondentes em <code class="docutils literal notranslate"><span class="pre">usuarios</span></code> baseando-se na condição de que os <code class="docutils literal notranslate"><span class="pre">UsuarioID</span></code> nas duas tabelas sejam iguais. Assim, para cada pedido, a consulta retorna o nome do usuário que fez o pedido, juntamente com os detalhes do pedido.</p>
</div>
<div class="section" id="left-join">
<h3>2.7.2 LEFT JOIN<a class="headerlink" href="#left-join" title="Permalink to this heading">#</a></h3>
<p>O <code class="docutils literal notranslate"><span class="pre">LEFT</span> <span class="pre">JOIN</span></code> (também conhecido como LEFT OUTER JOIN) é uma operação de junção SQL que retorna todas as linhas da tabela da esquerda (a primeira tabela na instrução <code class="docutils literal notranslate"><span class="pre">JOIN</span></code>) e as linhas correspondentes da tabela da direita (a segunda tabela na instrução JOIN). Se não houver correspondência, o resultado é NULL no lado direito do resultado para aquelas linhas.</p>
<p>Vamos continuar usando as tabelas “Usuarios” e “Pedidos” para explicar como funciona o <code class="docutils literal notranslate"><span class="pre">LEFT</span> <span class="pre">JOIN</span></code>. Suponhamos que queremos listar todos os usuários, independentemente de terem feito um pedido ou não, e os produtos que eles pediram, caso existam.</p>
<p>Para exemplificar, vamos adicionar um novo usuário na tabela “Usuarios” que não tenha feito nenhum pedido.</p>
<ul>
<li><p><strong>Tabela Usuarios</strong></p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>UsuarioID</p></th>
<th class="head"><p>Nome</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>Ana</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>João</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>Maria</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>Pedro</p></td>
</tr>
</tbody>
</table>
</li>
<li><p><strong>Tabela Pedidos</strong></p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>PedidoID</p></th>
<th class="head"><p>UsuarioID</p></th>
<th class="head"><p>Produto</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>101</p></td>
<td><p>1</p></td>
<td><p>Livro</p></td>
</tr>
<tr class="row-odd"><td><p>102</p></td>
<td><p>2</p></td>
<td><p>Caneta</p></td>
</tr>
<tr class="row-even"><td><p>103</p></td>
<td><p>3</p></td>
<td><p>Caderno</p></td>
</tr>
</tbody>
</table>
</li>
</ul>
<p>Para adicionar o usuário ‘Pedro’, que ainda não realizou nenhum pedido:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
INSERT INTO usuarios (UsuarioID, Nome) VALUES (4, &#39;Pedro&#39;);
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
1 rows affected.
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[]
</pre></div>
</div>
</div>
</div>
<p><em>Realizando um LEFT JOIN:</em></p>
<p>Para realizar um <code class="docutils literal notranslate"><span class="pre">LEFT</span> <span class="pre">JOIN</span></code> entre as tabelas <code class="docutils literal notranslate"><span class="pre">usuarios</span></code> e <code class="docutils literal notranslate"><span class="pre">pedidos</span></code>, com o objetivo de listar todos os usuários e seus pedidos correspondentes (incluindo aqueles usuários que não fizeram pedidos), usamos:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
SELECT 
    usuarios.UsuarioID, 
    usuarios.Nome, 
    pedidos.PedidoID, 
    pedidos.Produto
FROM 
    usuarios
LEFT JOIN 
    pedidos ON usuarios.UsuarioID = pedidos.UsuarioID;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
4 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>usuarioid</th>
            <th>nome</th>
            <th>pedidoid</th>
            <th>produto</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>1</td>
            <td>Ana</td>
            <td>101</td>
            <td>Livro</td>
        </tr>
        <tr>
            <td>2</td>
            <td>João</td>
            <td>102</td>
            <td>Caneta</td>
        </tr>
        <tr>
            <td>3</td>
            <td>Maria</td>
            <td>103</td>
            <td>Caderno</td>
        </tr>
        <tr>
            <td>4</td>
            <td>Pedro</td>
            <td>None</td>
            <td>None</td>
        </tr>
    </tbody>
</table></div></div>
</div>
<p>Esta consulta seleciona o ID do usuário (<code class="docutils literal notranslate"><span class="pre">UsuarioID</span></code>), o nome do usuário (<code class="docutils literal notranslate"><span class="pre">Nome</span></code>), o ID do pedido (<code class="docutils literal notranslate"><span class="pre">PedidoID</span></code>) e o produto (<code class="docutils literal notranslate"><span class="pre">Produto</span></code>) das tabelas <code class="docutils literal notranslate"><span class="pre">usuarios</span></code> e <code class="docutils literal notranslate"><span class="pre">pedidos</span></code>. O <code class="docutils literal notranslate"><span class="pre">LEFT</span> <span class="pre">JOIN</span></code> é utilizado para incluir todos os registros da tabela à esquerda (<code class="docutils literal notranslate"><span class="pre">usuarios</span></code>), mesmo que não haja uma correspondência na tabela à direita (<code class="docutils literal notranslate"><span class="pre">pedidos</span></code>). Assim, se um usuário não fez nenhum pedido, a consulta ainda retornará o nome do usuário, mas os campos <code class="docutils literal notranslate"><span class="pre">PedidoID</span></code> e <code class="docutils literal notranslate"><span class="pre">Produto</span></code> aparecerão como <code class="docutils literal notranslate"><span class="pre">NULL</span></code> para esse usuário.</p>
</div>
<div class="section" id="right-join">
<h3>2.7.3 RIGHT JOIN<a class="headerlink" href="#right-join" title="Permalink to this heading">#</a></h3>
<p>O <code class="docutils literal notranslate"><span class="pre">RIGHT</span> <span class="pre">JOIN</span></code> ou <code class="docutils literal notranslate"><span class="pre">RIGHT</span> <span class="pre">OUTER</span> <span class="pre">JOIN</span></code> é uma operação de junção em SQL que retorna todas as linhas da tabela da direita (a segunda tabela mencionada na instrução JOIN) e as linhas correspondentes da tabela da esquerda (a primeira tabela mencionada). Para as linhas da tabela da direita sem correspondentes na tabela da esquerda, os campos da tabela da esquerda são preenchidos com <code class="docutils literal notranslate"><span class="pre">NULL</span></code>.</p>
<p>Considerando as tabelas “Usuarios” e “Pedidos”, suponha o objetivo de listar todos os pedidos, incluindo aqueles sem usuários correspondentes.</p>
<p>Vamos trabalhar com as mesmas tabelas “Usuarios” e “Pedidos” para explicar o RIGHT JOIN. Imagine que agora queremos listar todos os pedidos e os nomes dos usuários que os fizeram, se eles existirem.</p>
<p>Vamos utilizar a tabela usuários inicial, sem o registro do usuário Pedro. Para tanto, precisamos apagar esse registro da tabela:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
DELETE 
FROM usuarios 
WHERE UsuarioID = 4;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
1 rows affected.
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[]
</pre></div>
</div>
</div>
</div>
<p>Este comando SQL remove da tabela <code class="docutils literal notranslate"><span class="pre">usuarios</span></code> o registro cujo <code class="docutils literal notranslate"><span class="pre">UsuarioID</span></code> é igual a 4, que corresponde ao usuário Pedro. Após a execução desta consulta, o registro de Pedro não estará mais presente na tabela <code class="docutils literal notranslate"><span class="pre">usuarios</span></code>. Nossa tabela usuários agora está assim:</p>
<p>Tabela1: Usuarios</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>UsuarioID</p></th>
<th class="head"><p>Nome</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>Ana</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>João</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>Maria</p></td>
</tr>
</tbody>
</table>
<p>Vamos inserir o pedido 104, que foi realizado pelo usuário com Usuario ID 5 e o produto é uma mesa.</p>
<p>Tabela2: Pedidos</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>PedidoID</p></th>
<th class="head"><p>UsuarioID</p></th>
<th class="head"><p>Produto</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>101</p></td>
<td><p>1</p></td>
<td><p>Livro</p></td>
</tr>
<tr class="row-odd"><td><p>102</p></td>
<td><p>2</p></td>
<td><p>Caneta</p></td>
</tr>
<tr class="row-even"><td><p>103</p></td>
<td><p>3</p></td>
<td><p>Caderno</p></td>
</tr>
<tr class="row-odd"><td><p>104</p></td>
<td><p>5</p></td>
<td><p>Mesa</p></td>
</tr>
</tbody>
</table>
<p>Inserimos um pedido feito por um usuário inexistente na tabela “Usuarios”:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
INSERT INTO pedidos (PedidoID, UsuarioID, Produto) 
VALUES (104, 5, &#39;Mesa&#39;);
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1 rows affected.
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[]
</pre></div>
</div>
</div>
</div>
<p><em>Realizando o RIGHT JOIN:</em></p>
<p>Para listar todos os pedidos e os usuários correspondentes (se existirem), utilizamos o <code class="docutils literal notranslate"><span class="pre">RIGHT</span> <span class="pre">JOIN</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
SELECT 
    usuarios.UsuarioID, 
    usuarios.Nome, 
    pedidos.PedidoID, 
    pedidos.Produto
FROM 
    usuarios
RIGHT JOIN 
    pedidos ON usuarios.UsuarioID = pedidos.UsuarioID;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>4 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>usuarioid</th>
            <th>nome</th>
            <th>pedidoid</th>
            <th>produto</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>1</td>
            <td>Ana</td>
            <td>101</td>
            <td>Livro</td>
        </tr>
        <tr>
            <td>2</td>
            <td>João</td>
            <td>102</td>
            <td>Caneta</td>
        </tr>
        <tr>
            <td>3</td>
            <td>Maria</td>
            <td>103</td>
            <td>Caderno</td>
        </tr>
        <tr>
            <td>None</td>
            <td>None</td>
            <td>104</td>
            <td>Mesa</td>
        </tr>
    </tbody>
</table></div></div>
</div>
<p>Esta consulta seleciona o ID do usuário (<code class="docutils literal notranslate"><span class="pre">UsuarioID</span></code>), o nome do usuário (<code class="docutils literal notranslate"><span class="pre">Nome</span></code>), o ID do pedido (<code class="docutils literal notranslate"><span class="pre">PedidoID</span></code>) e o produto (<code class="docutils literal notranslate"><span class="pre">Produto</span></code>) das tabelas <code class="docutils literal notranslate"><span class="pre">usuarios</span></code> e <code class="docutils literal notranslate"><span class="pre">pedidos</span></code>. O <code class="docutils literal notranslate"><span class="pre">RIGHT</span> <span class="pre">JOIN</span></code> garante que todos os registros da tabela à direita (<code class="docutils literal notranslate"><span class="pre">pedidos</span></code>) sejam incluídos nos resultados, mesmo que não haja uma correspondência na tabela à esquerda (<code class="docutils literal notranslate"><span class="pre">usuarios</span></code>). Para registros de <code class="docutils literal notranslate"><span class="pre">pedidos</span></code> que não têm um <code class="docutils literal notranslate"><span class="pre">UsuarioID</span></code> correspondente em <code class="docutils literal notranslate"><span class="pre">usuarios</span></code>, os campos <code class="docutils literal notranslate"><span class="pre">UsuarioID</span></code> e <code class="docutils literal notranslate"><span class="pre">Nome</span></code> aparecerão como <code class="docutils literal notranslate"><span class="pre">NULL</span></code> nos resultados.</p>
<p>Note que o pedido com PedidoID = 104 para o produto ‘Mesa’ não tem um usuário correspondente na tabela “Usuarios”, então o SQL preenche as colunas UsuarioID e Nome com NULL. Isso indica que existe um pedido para o qual não foi possível encontrar um usuário correspondente na tabela “Usuarios”. O RIGHT JOIN é menos comum que o LEFT JOIN, pois normalmente você pode reestruturar a consulta para usar um LEFT JOIN, que é mais intuitivamente compreendido.</p>
</div>
<div class="section" id="full-join">
<h3>2.7.4 FULL JOIN<a class="headerlink" href="#full-join" title="Permalink to this heading">#</a></h3>
<p>O <code class="docutils literal notranslate"><span class="pre">FULL</span> <span class="pre">JOIN</span></code>, também conhecido como <code class="docutils literal notranslate"><span class="pre">FULL</span> <span class="pre">OUTER</span> <span class="pre">JOIN</span></code>, é uma operação de junção em SQL que combina as funcionalidades do <code class="docutils literal notranslate"><span class="pre">LEFT</span> <span class="pre">JOIN</span></code> e do <code class="docutils literal notranslate"><span class="pre">RIGHT</span> <span class="pre">JOIN</span></code>. Ele retorna todas as linhas de ambas as tabelas na junção, pareando as linhas correspondentes de uma tabela com as linhas correspondentes da outra. Quando não há correspondência para uma linha de uma tabela, os campos da outra tabela são preenchidos com <code class="docutils literal notranslate"><span class="pre">NULL</span></code>.</p>
<p>Considerando ainda as tabelas “Usuarios” e “Pedidos”, vamos adicionar o registro para o usuário ‘Pedro’ que não fez nenhum pedido.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
INSERT INTO usuarios (UsuarioID, Nome) 
VALUES (4, &#39;Pedro&#39;);
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1 rows affected.
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[]
</pre></div>
</div>
</div>
</div>
<ul>
<li><p><strong>Tabelas Atualizadas</strong></p>
<ul>
<li><p><strong>Tabela Usuarios</strong></p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>UsuarioID</p></th>
<th class="head"><p>Nome</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>Ana</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>João</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>Maria</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>Pedro</p></td>
</tr>
</tbody>
</table>
</li>
<li><p><strong>Tabela Pedidos</strong></p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>PedidoID</p></th>
<th class="head"><p>UsuarioID</p></th>
<th class="head"><p>Produto</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>101</p></td>
<td><p>1</p></td>
<td><p>Livro</p></td>
</tr>
<tr class="row-odd"><td><p>102</p></td>
<td><p>2</p></td>
<td><p>Caneta</p></td>
</tr>
<tr class="row-even"><td><p>103</p></td>
<td><p>3</p></td>
<td><p>Caderno</p></td>
</tr>
<tr class="row-odd"><td><p>104</p></td>
<td><p>5</p></td>
<td><p>Mesa</p></td>
</tr>
</tbody>
</table>
</li>
</ul>
</li>
</ul>
<p><em>Realizando o FULL JOIN:</em></p>
<p>Para listar todos os usuários junto com seus pedidos, e todos os pedidos junto com os usuários correspondentes (se houver), utilizamos o <code class="docutils literal notranslate"><span class="pre">FULL</span> <span class="pre">JOIN</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
SELECT 
    usuarios.UsuarioID, 
    usuarios.Nome, 
    pedidos.PedidoID, 
    pedidos.Produto
FROM 
    usuarios
FULL JOIN 
    pedidos ON usuarios.UsuarioID = pedidos.UsuarioID;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>5 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>usuarioid</th>
            <th>nome</th>
            <th>pedidoid</th>
            <th>produto</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>1</td>
            <td>Ana</td>
            <td>101</td>
            <td>Livro</td>
        </tr>
        <tr>
            <td>2</td>
            <td>João</td>
            <td>102</td>
            <td>Caneta</td>
        </tr>
        <tr>
            <td>3</td>
            <td>Maria</td>
            <td>103</td>
            <td>Caderno</td>
        </tr>
        <tr>
            <td>None</td>
            <td>None</td>
            <td>104</td>
            <td>Mesa</td>
        </tr>
        <tr>
            <td>4</td>
            <td>Pedro</td>
            <td>None</td>
            <td>None</td>
        </tr>
    </tbody>
</table></div></div>
</div>
<p>Esta consulta retorna:</p>
<ul class="simple">
<li><p>Todos os usuários, incluindo ‘Pedro’, que não fez nenhum pedido. Para ‘Pedro’, os campos <code class="docutils literal notranslate"><span class="pre">PedidoID</span></code> e <code class="docutils literal notranslate"><span class="pre">Produto</span></code> serão <code class="docutils literal notranslate"><span class="pre">NULL</span></code>.</p></li>
<li><p>Todos os pedidos, incluindo o pedido 104 para o produto ‘Mesa’, que não tem um usuário correspondente. Para esse pedido, os campos <code class="docutils literal notranslate"><span class="pre">UsuarioID</span></code> e <code class="docutils literal notranslate"><span class="pre">Nome</span></code> serão <code class="docutils literal notranslate"><span class="pre">NULL</span></code>.</p></li>
<li><p>As linhas correspondentes de ambas as tabelas são unidas com base no <code class="docutils literal notranslate"><span class="pre">UsuarioID</span></code>.</p></li>
</ul>
<p>O <code class="docutils literal notranslate"><span class="pre">FULL</span> <span class="pre">JOIN</span></code> é essencial para situações onde é importante manter a integridade dos dados de ambas as tabelas na junção, assegurando que nenhuma informação seja perdida. Isso é particularmente útil para análises abrangentes que requerem uma visão completa dos dados disponíveis, independentemente de suas relações diretas.</p>
</div>
<div class="section" id="subconsultas">
<h3>2.7.5 Subconsultas<a class="headerlink" href="#subconsultas" title="Permalink to this heading">#</a></h3>
<p>Subconsultas, também conhecidas como consultas aninhadas, são consultas SQL dentro de outra consulta SQL. Elas são úteis quando queremos realizar uma operação em que o valor depende de uma consulta interna. Por exemplo, considere a tabela <code class="docutils literal notranslate"><span class="pre">produtos</span></code>:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>ProdutoID</p></th>
<th class="head"><p>Produto</p></th>
<th class="head"><p>Valor</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>Mesa</p></td>
<td><p>180</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>Caderno</p></td>
<td><p>65</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>Caneta</p></td>
<td><p>6</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>Livro</p></td>
<td><p>72</p></td>
</tr>
</tbody>
</table>
<p>Para criar e popular esta tabela no banco de dados, usamos o seguinte comando SQL:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
CREATE TABLE produtos (
  ProdutoID int PRIMARY KEY,
  Produto varchar(255),
  Valor decimal(10, 2)
);
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Done.
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
INSERT INTO produtos (ProdutoID, Produto, Valor) VALUES
(1, &#39;Mesa&#39;, 180),
(2, &#39;Caderno&#39;, 65),
(3, &#39;Caneta&#39;, 6),
(4, &#39;Livro&#39;, 72);
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>4 rows affected.
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[]
</pre></div>
</div>
</div>
</div>
<p>Esta sequência de comandos cria a tabela <code class="docutils literal notranslate"><span class="pre">produtos</span></code> com colunas para o ID do produto, nome do produto e seu valor, e insere os produtos com seus respectivos valores.</p>
<p>Imagine que você deseja identificar produtos com valor superior a um determinado limite. Uma subconsulta pode ser usada para selecionar primeiramente os <code class="docutils literal notranslate"><span class="pre">ProdutoID</span></code> de produtos que atendem a esse critério e, em seguida, utilizar o resultado para buscar informações adicionais desses produtos. Por exemplo:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
SELECT Produto, Valor
FROM produtos
WHERE ProdutoID IN (
  SELECT ProdutoID
  FROM produtos
  WHERE Valor &gt; 50
);
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>produto</th>
            <th>valor</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Mesa</td>
            <td>180.00</td>
        </tr>
        <tr>
            <td>Caderno</td>
            <td>65.00</td>
        </tr>
        <tr>
            <td>Livro</td>
            <td>72.00</td>
        </tr>
    </tbody>
</table></div></div>
</div>
<p>Neste caso, a subconsulta <code class="docutils literal notranslate"><span class="pre">(SELECT</span> <span class="pre">ProdutoID</span> <span class="pre">FROM</span> <span class="pre">produtos</span> <span class="pre">WHERE</span> <span class="pre">Valor</span> <span class="pre">&gt;</span> <span class="pre">50)</span></code> seleciona os IDs dos produtos cujo valor é superior a 50. A consulta externa então usa esse resultado para obter os nomes e valores dos produtos correspondentes. O resultado incluirá ‘Mesa’, ‘Caderno’ e ‘Livro’, excluindo ‘Caneta’ devido ao seu valor inferior ao limite especificado.</p>
<p>Subconsultas são extremamente versáteis e podem ser usadas em várias partes de uma consulta SQL, incluindo cláusulas <code class="docutils literal notranslate"><span class="pre">SELECT</span></code>, <code class="docutils literal notranslate"><span class="pre">FROM</span></code>, e <code class="docutils literal notranslate"><span class="pre">WHERE</span></code>, permitindo realizar análises de dados e condicionais de maneira eficiente e intuitiva.</p>
</div>
<div class="section" id="operacoes-de-conjunto-em-sql">
<h3>2.7.6 Operações de Conjunto em SQL<a class="headerlink" href="#operacoes-de-conjunto-em-sql" title="Permalink to this heading">#</a></h3>
<p>Operações de conjunto são ferramentas eficientes em SQL, utilizadas para combinar os resultados de duas ou mais consultas em um único conjunto de resultados. Essas operações são <code class="docutils literal notranslate"><span class="pre">UNION</span></code>, <code class="docutils literal notranslate"><span class="pre">INTERSECT</span></code>, e <code class="docutils literal notranslate"><span class="pre">EXCEPT</span></code>, cada uma atendendo a um propósito específico na manipulação de conjuntos de dados.</p>
<p><strong>UNION</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">UNION</span></code> é usado para combinar os resultados de duas ou mais consultas em um único conjunto de resultados, removendo quaisquer linhas duplicadas. Todas as consultas combinadas devem ter o mesmo número de colunas nas listas de seleção com tipos de dados compatíveis.</p>
<p><strong>Exemplo:</strong></p>
<p>Imagine duas consultas que selecionam nomes de produtos de diferentes categorias ou tabelas. Usando <code class="docutils literal notranslate"><span class="pre">UNION</span></code>, você pode combinar esses resultados:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">sql</span>
<span class="n">SELECT</span> <span class="n">produto</span> <span class="n">FROM</span> <span class="n">eletronicos</span>
<span class="n">UNION</span>
<span class="n">SELECT</span> <span class="n">produto</span> <span class="n">FROM</span> <span class="n">livros</span><span class="p">;</span>
</pre></div>
</div>
<p>Este exemplo combina os produtos listados nas tabelas <code class="docutils literal notranslate"><span class="pre">Eletronicos</span></code> e <code class="docutils literal notranslate"><span class="pre">Livros</span></code>, removendo quaisquer produtos duplicados que possam aparecer em ambas as tabelas.</p>
<p><strong>INTERSECT</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">INTERSECT</span></code> retorna apenas as linhas que aparecem em ambos os conjuntos de resultados de duas consultas. Assim como o <code class="docutils literal notranslate"><span class="pre">UNION</span></code>, as consultas devem ter o mesmo número de colunas com tipos de dados compatíveis.</p>
<p><strong>Exemplo:</strong></p>
<p>Para encontrar produtos que estão tanto na lista de desejos de um cliente quanto em promoção, você poderia usar:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">sql</span>
<span class="n">SELECT</span> <span class="n">ProdutoID</span> <span class="n">FROM</span> <span class="n">lista_desejos</span> <span class="n">WHERE</span> <span class="n">ClienteID</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">INTERSECT</span>
<span class="n">SELECT</span> <span class="n">ProdutoID</span> <span class="n">FROM</span> <span class="n">promocoes</span><span class="p">;</span>
</pre></div>
</div>
<p>Este comando retorna os <code class="docutils literal notranslate"><span class="pre">ProdutoID</span></code>s que estão presentes em ambas as listas, ou seja, produtos desejados pelo cliente que também estão em promoção.</p>
<p><strong>EXCEPT</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">EXCEPT</span></code> retorna as linhas do primeiro conjunto de resultados que não estão presentes no segundo conjunto de resultados. Assim como as outras operações de conjunto, as consultas devem ter o mesmo número de colunas com tipos de dados compatíveis.</p>
<p><strong>Exemplo:</strong></p>
<p>Para identificar produtos que estão na lista de desejos do cliente, mas não em promoção, você poderia usar:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">sql</span>
<span class="n">SELECT</span> <span class="n">ProdutoID</span> <span class="n">FROM</span> <span class="n">lista_desejos</span> <span class="n">WHERE</span> <span class="n">ClienteID</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">EXCEPT</span>
<span class="n">SELECT</span> <span class="n">ProdutoID</span> <span class="n">FROM</span> <span class="n">Promocoes</span><span class="p">;</span>
</pre></div>
</div>
<p>Este exemplo mostra os produtos que o cliente deseja, mas que, infelizmente, não estão em promoção.</p>
<p><em>Observação:</em></p>
<p>Ao utilizar operações de conjunto, é importante garantir que as consultas combinadas tenham listas de seleção compatíveis, tanto em número de colunas quanto em tipos de dados. Além disso, o <code class="docutils literal notranslate"><span class="pre">UNION</span> <span class="pre">ALL</span></code>, <code class="docutils literal notranslate"><span class="pre">INTERSECT</span> <span class="pre">ALL</span></code>, e <code class="docutils literal notranslate"><span class="pre">EXCEPT</span> <span class="pre">ALL</span></code> podem ser usados para incluir linhas duplicadas nos resultados, diferentemente de suas contrapartes que filtram duplicatas.</p>
</div>
</div>
<div class="section" id="o-conceito-de-visao-em-bancos-de-dados-relacionais">
<h2>2.8 O conceito de “Visão” em bancos de dados relacionais<a class="headerlink" href="#o-conceito-de-visao-em-bancos-de-dados-relacionais" title="Permalink to this heading">#</a></h2>
<p>A estrutura do nosso banco de dados exemplifica o conceito de normalização, uma prática chave no design de bancos de dados relacionais que busca organizar os dados para minimizar a redundância e aumentar a integridade. Isso envolve dividir informações detalhadas em várias tabelas relacionadas, facilitando o gerenciamento e a manutenção dos dados.</p>
<p><img alt="Modelo Lógico" src="_images/fig4.png" /></p>
<p>Normalizar um banco de dados envolve a aplicação de uma série de regras denominadas “formas normais”, cada uma visando um nível crescente de organização que reduz a duplicação e promove a integridade dos dados. Embora uma alta normalização minimize a redundância e os problemas de inconsistência, é essencial encontrar um equilíbrio que não prejudique o desempenho do banco de dados.</p>
<div class="section" id="visoes-views-e-inner-join">
<h3>2.8.1 Visões (Views) e INNER JOIN<a class="headerlink" href="#visoes-views-e-inner-join" title="Permalink to this heading">#</a></h3>
<p>Em um banco de dados normalizado, onde as informações estão espalhadas por várias tabelas, torna-se necessário reunir esses dados para análises e relatórios. As operações de junção e as visões são instrumentos fundamentais nesse processo:</p>
<p>Como vimos há pouco, o Inner Join é uma operação que combina linhas de duas ou mais tabelas com base em valores coincidentes de colunas relacionadas. O <code class="docutils literal notranslate"><span class="pre">INNER</span> <span class="pre">JOIN</span></code> retorna apenas as linhas que têm correspondência em ambas as tabelas, o que é ideal para extrair informações inter-relacionadas de um banco de dados normalizado.</p>
<ul class="simple">
<li><p>Visões (ou “views” em inglês) em bancos de dados relacionais são, essencialmente, consultas SQL armazenadas que são usadas para abstrair e simplificar o acesso a dados complexos. Elas funcionam como tabelas virtuais que não armazenam dados por si só, mas fornecem uma maneira de visualizar e interagir com os dados como se estivessem armazenados em uma tabela comum. As visões são particularmente úteis em várias situações:</p></li>
<li><p>Simplificação de consultas complexas: Se você frequentemente executa uma consulta SQL complexa que envolve múltiplas tabelas e operações de junção, pode armazenar essa consulta como uma visão. Isso permite reutilizar a consulta facilmente, sem precisar reescrever a lógica complexa toda vez.</p></li>
<li><p>Segurança: Visões podem ser usadas para restringir o acesso a dados sensíveis. Por exemplo, você pode criar uma visão que exponha apenas um subconjunto de colunas de uma tabela, ocultando dados sensíveis dos usuários que não têm permissão para vê-los.</p></li>
<li><p>Abstração de dados: Visões podem esconder a complexidade dos dados subjacentes, apresentando uma estrutura simplificada para os usuários. Isso é útil quando os esquemas de banco de dados são complexos e você deseja fornecer aos usuários finais uma forma mais compreensível de acessar os dados.</p></li>
<li><p>Personalização de dados para diferentes usuários: Diferentes visões podem ser criadas para atender às necessidades específicas de diferentes usuários ou grupos de usuários, permitindo que vejam os dados de maneiras que são mais relevantes para suas tarefas específicas.</p></li>
<li><p>Independência de dados: As visões podem ajudar a isolar as aplicações das mudanças no esquema do banco de dados. Se a estrutura das tabelas subjacentes mudar, você pode muitas vezes ajustar apenas a definição da visão sem precisar alterar as aplicações que dependem dela.</p></li>
</ul>
<p><strong>Criando Visões com INNER JOIN</strong></p>
<p>A seguir, vamos criar uma série de visões a partir das tabelas de nosso banco de dados. Nomearemos essas visões com nomes não adequados
Suponha que queremos combinar informações sobre estados e suas regiões correspondentes.</p>
<p>Temos uma tabela <code class="docutils literal notranslate"><span class="pre">estado</span></code> com informações específicas dos estados e uma tabela <code class="docutils literal notranslate"><span class="pre">regiao</span></code> com informações das regiões do Brasil. Para criar uma visão que apresente o nome do estado, sua sigla, e o nome da região a que pertence, podemos usar um <code class="docutils literal notranslate"><span class="pre">INNER</span> <span class="pre">JOIN</span></code> para unir essas tabelas com base em um código de região comum.</p>
<p>Em seguida, criamos uma visão baseada nessa consulta, facilitando futuras consultas a essas informações combinadas.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
CREATE VIEW v_estado AS
SELECT 
    estado.cod_uf,
    estado.nome_uf,
    estado.sigla_uf,
    regiao.nome_rg
FROM 
    estado
INNER JOIN 
    regiao ON estado.cod_rg = regiao.cod_rg;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
Done.
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[]
</pre></div>
</div>
</div>
</div>
<p>No código acima:</p>
<p><code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">VIEW</span> <span class="pre">v_estado</span> <span class="pre">AS</span></code>: Este comando inicia a criação de uma visão chamada view_estado_regiao. A visão será composta pelos resultados da consulta SQL que segue o AS.</p>
<p><code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">estado.cod_uf,</span> <span class="pre">estado.nome_uf,</span> <span class="pre">estado.sigla_uf,</span> <span class="pre">regiao.nome_rg</span></code>: Este comando especifica as colunas a serem incluídas na visão. São selecionadas três colunas da tabela estado (código do UF, nome do UF, e sigla do UF) e uma coluna da tabela regiao (nome da região).</p>
<p><code class="docutils literal notranslate"><span class="pre">FROM</span> <span class="pre">estado</span></code>: Este comando especifica a tabela estado como a fonte inicial dos dados para a consulta.</p>
<p><code class="docutils literal notranslate"><span class="pre">INNER</span> <span class="pre">JOIN</span> <span class="pre">regiao</span> <span class="pre">ON</span> <span class="pre">estado.cod_rg</span> <span class="pre">=</span> <span class="pre">regiao.cod_rg</span></code>: Esta instrução junta a tabela estado com a tabela regiao com base em uma condição de correspondência entre as colunas cod_rg de ambas as tabelas. Ou seja, para cada linha na tabela estado, a consulta busca na tabela regiao uma linha onde o valor de cod_rg seja igual ao valor de cod_rg na tabela estado.</p>
<p>Para recuperar os registros desta visão:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
SELECT *
FROM v_estado
LIMIT 10;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>10 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>cod_uf</th>
            <th>nome_uf</th>
            <th>sigla_uf</th>
            <th>nome_rg</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>17</td>
            <td>Tocantins</td>
            <td>TO</td>
            <td>Norte</td>
        </tr>
        <tr>
            <td>16</td>
            <td>Amapá</td>
            <td>AP</td>
            <td>Norte</td>
        </tr>
        <tr>
            <td>15</td>
            <td>Pará</td>
            <td>PA</td>
            <td>Norte</td>
        </tr>
        <tr>
            <td>14</td>
            <td>Roraima</td>
            <td>RR</td>
            <td>Norte</td>
        </tr>
        <tr>
            <td>13</td>
            <td>Amazonas</td>
            <td>AM</td>
            <td>Norte</td>
        </tr>
        <tr>
            <td>12</td>
            <td>Acre</td>
            <td>AC</td>
            <td>Norte</td>
        </tr>
        <tr>
            <td>11</td>
            <td>Rondônia</td>
            <td>RO</td>
            <td>Norte</td>
        </tr>
        <tr>
            <td>29</td>
            <td>Bahia</td>
            <td>BA</td>
            <td>Nordeste</td>
        </tr>
        <tr>
            <td>28</td>
            <td>Sergipe</td>
            <td>SE</td>
            <td>Nordeste</td>
        </tr>
        <tr>
            <td>27</td>
            <td>Alagoas</td>
            <td>AL</td>
            <td>Nordeste</td>
        </tr>
    </tbody>
</table></div></div>
</div>
<p><em>Criando uma Visão com informações integradas das tabelas regiao_inter e estado:</em></p>
<p>Para criar uma visão (view) que combine informações das tabelas <code class="docutils literal notranslate"><span class="pre">regiao_inter</span></code> (região intermediária) e <code class="docutils literal notranslate"><span class="pre">estado</span></code>, onde queremos ligar cada região intermediária ao seu estado correspondente, podemos usar uma consulta SQL com <code class="docutils literal notranslate"><span class="pre">INNER</span> <span class="pre">JOIN</span></code>. A visão resultante mostrará o código e o nome da região intermediária, junto com os detalhes do estado correspondente (código, nome e sigla do estado, e o código da região geográfica a qual o estado pertence).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
CREATE VIEW v_regiao_inter AS
SELECT 
    regiao_inter.cod_rgint,
    regiao_inter.nome_rgint,
    estado.nome_uf,
    estado.sigla_uf
FROM 
    regiao_inter
INNER JOIN 
    estado ON regiao_inter.cod_uf = estado.cod_uf;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Done.
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[]
</pre></div>
</div>
</div>
</div>
<p>No código acima:</p>
<p><code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">VIEW</span> <span class="pre">v_regiao_inter</span> <span class="pre">AS</span></code>: Este comando inicia a criação de uma visão denominada v_regiao_inter. O conteúdo da visão é definido pela consulta SQL que segue o AS.</p>
<p><code class="docutils literal notranslate"><span class="pre">SELECT</span></code>
A cláusula SELECT especifica as colunas que serão incluídas na visão. Neste caso, são selecionadas duas colunas da tabela regiao_inter (cod_rgint e nome_rgint, que são, respectivamente, o código e o nome da região intermediária) e duas colunas da tabela estado (nome_uf e sigla_uf, que representam o nome e a sigla do estado).</p>
<p><code class="docutils literal notranslate"><span class="pre">FROM</span> <span class="pre">regiao_inter</span></code>: Este comando indica que a consulta inicia na tabela regiao_inter, buscando dados diretamente dessa tabela.</p>
<p><code class="docutils literal notranslate"><span class="pre">INNER</span> <span class="pre">JOIN</span> <span class="pre">estado</span> <span class="pre">ON</span> <span class="pre">regiao_inter.cod_uf</span> <span class="pre">=</span> <span class="pre">estado.cod_uf</span></code>: Este comando junta a tabela regiao_inter com a tabela estado com base na correspondência entre a coluna cod_uf de ambas as tabelas. A condição ON especifica que a junção deve acontecer onde os valores de cod_uf nas duas tabelas sejam iguais. Isso significa que para cada registro na tabela regiao_inter, a consulta busca na tabela estado um registro correspondente onde o código do estado é o mesmo.</p>
<p>Para recuperar os registros desta visão:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
SELECT *
FROM v_regiao_inter
LIMIT 10;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
10 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>cod_rgint</th>
            <th>nome_rgint</th>
            <th>nome_uf</th>
            <th>sigla_uf</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>1101</td>
            <td>Porto Velho</td>
            <td>Rondônia</td>
            <td>RO</td>
        </tr>
        <tr>
            <td>1102</td>
            <td>Ji-Paraná</td>
            <td>Rondônia</td>
            <td>RO</td>
        </tr>
        <tr>
            <td>1201</td>
            <td>Rio Branco</td>
            <td>Acre</td>
            <td>AC</td>
        </tr>
        <tr>
            <td>1202</td>
            <td>Cruzeiro do Sul</td>
            <td>Acre</td>
            <td>AC</td>
        </tr>
        <tr>
            <td>1301</td>
            <td>Manaus</td>
            <td>Amazonas</td>
            <td>AM</td>
        </tr>
        <tr>
            <td>1302</td>
            <td>Tefé</td>
            <td>Amazonas</td>
            <td>AM</td>
        </tr>
        <tr>
            <td>1303</td>
            <td>Lábrea</td>
            <td>Amazonas</td>
            <td>AM</td>
        </tr>
        <tr>
            <td>1304</td>
            <td>Parintins</td>
            <td>Amazonas</td>
            <td>AM</td>
        </tr>
        <tr>
            <td>1401</td>
            <td>Boa Vista</td>
            <td>Roraima</td>
            <td>RR</td>
        </tr>
        <tr>
            <td>1402</td>
            <td>Rorainópolis - Caracaraí</td>
            <td>Roraima</td>
            <td>RR</td>
        </tr>
    </tbody>
</table></div></div>
</div>
<p><em>Criando uma Visão com informações integradas das tabelas regiao_imed, regiao_inter e estado:</em></p>
<p>Para unir informações das tabelas <code class="docutils literal notranslate"><span class="pre">regiao_imed</span></code> (região imediata), <code class="docutils literal notranslate"><span class="pre">regiao_inter</span></code> (região intermediária) e <code class="docutils literal notranslate"><span class="pre">estado</span></code>, oferecendo uma visão integrada que inclua detalhes como o nome da região imediata, o nome da região intermediária e detalhes correspondentes do estado, podemos utilizar uma consulta SQL com múltiplos <code class="docutils literal notranslate"><span class="pre">INNER</span> <span class="pre">JOIN</span></code>. Esta visão simplificará futuras consultas, facilitando o acesso a informações relacionadas dessas três tabelas distintas.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
CREATE VIEW v_regiao_imed AS
SELECT 
    regiao_imed.cod_rgi,
    regiao_imed.nome_rgi,
    regiao_inter.nome_rgint,
    estado.cod_uf,
    estado.nome_uf,
    estado.sigla_uf
FROM 
    regiao_imed
INNER JOIN 
    regiao_inter ON regiao_imed.cod_rgint = regiao_inter.cod_rgint
INNER JOIN 
    estado ON regiao_inter.cod_uf = estado.cod_uf;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Done.
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[]
</pre></div>
</div>
</div>
</div>
<p>No código acima:</p>
<p><code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">VIEW</span> <span class="pre">v_regiao_imed</span> <span class="pre">AS</span></code>: Este comando cria a visão chamada v_regiao_imed. Tudo que segue o AS define o conteúdo desta visão.</p>
<p><code class="docutils literal notranslate"><span class="pre">SELECT</span></code>: Este comando especifica as colunas que serão incluídas na visão. As colunas selecionadas são:</p>
<p>regiao_imed.cod_rgi: Um código identificador para a região imediata.
regiao_imed.nome_rgi: O nome da região imediata.
regiao_inter.nome_rgint: O nome da região intermediária.
estado.cod_uf: Um código identificador para o estado.
estado.nome_uf: O nome do estado.
estado.sigla_uf: A sigla do estado.</p>
<p><code class="docutils literal notranslate"><span class="pre">FROM</span></code>: regiao_imed: Define a tabela regiao_imed como a fonte inicial de dados.</p>
<p><code class="docutils literal notranslate"><span class="pre">INNER</span> <span class="pre">JOIN</span> <span class="pre">regiao_inter</span> <span class="pre">ON</span> <span class="pre">regiao_imed.cod_rgint</span> <span class="pre">=</span> <span class="pre">regiao_inter.cod_rgint</span></code>: Esta linha une a tabela regiao_imed com a tabela regiao_inter onde os códigos das regiões intermediárias correspondem. Um INNER JOIN retorna somente os registros que têm correspondência em ambas as tabelas.</p>
<p><code class="docutils literal notranslate"><span class="pre">INNER</span> <span class="pre">JOIN</span> <span class="pre">estado</span> <span class="pre">ON</span> <span class="pre">regiao_inter.cod_uf</span> <span class="pre">=</span> <span class="pre">estado.cod_uf</span></code>: Em seguida, a tabela resultante da junção anterior é unida com a tabela estado, baseando-se na correspondência dos códigos de UF (Unidade Federativa, ou estado). Isso significa que para cada região intermediária, será incluída a informação do estado correspondente.</p>
<p>Para recuperar os registros desta visão:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
SELECT *
FROM v_regiao_imed
LIMIT 15;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
15 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>cod_rgi</th>
            <th>nome_rgi</th>
            <th>nome_rgint</th>
            <th>cod_uf</th>
            <th>nome_uf</th>
            <th>sigla_uf</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>110001</td>
            <td>Porto Velho</td>
            <td>Porto Velho</td>
            <td>11</td>
            <td>Rondônia</td>
            <td>RO</td>
        </tr>
        <tr>
            <td>110002</td>
            <td>Ariquemes</td>
            <td>Porto Velho</td>
            <td>11</td>
            <td>Rondônia</td>
            <td>RO</td>
        </tr>
        <tr>
            <td>110003</td>
            <td>Jaru</td>
            <td>Porto Velho</td>
            <td>11</td>
            <td>Rondônia</td>
            <td>RO</td>
        </tr>
        <tr>
            <td>110004</td>
            <td>Ji-Paraná</td>
            <td>Ji-Paraná</td>
            <td>11</td>
            <td>Rondônia</td>
            <td>RO</td>
        </tr>
        <tr>
            <td>110005</td>
            <td>Cacoal</td>
            <td>Ji-Paraná</td>
            <td>11</td>
            <td>Rondônia</td>
            <td>RO</td>
        </tr>
        <tr>
            <td>110006</td>
            <td>Vilhena</td>
            <td>Ji-Paraná</td>
            <td>11</td>
            <td>Rondônia</td>
            <td>RO</td>
        </tr>
        <tr>
            <td>120001</td>
            <td>Rio Branco</td>
            <td>Rio Branco</td>
            <td>12</td>
            <td>Acre</td>
            <td>AC</td>
        </tr>
        <tr>
            <td>120002</td>
            <td>Brasiléia</td>
            <td>Rio Branco</td>
            <td>12</td>
            <td>Acre</td>
            <td>AC</td>
        </tr>
        <tr>
            <td>120003</td>
            <td>Sena Madureira</td>
            <td>Rio Branco</td>
            <td>12</td>
            <td>Acre</td>
            <td>AC</td>
        </tr>
        <tr>
            <td>120004</td>
            <td>Cruzeiro do Sul</td>
            <td>Cruzeiro do Sul</td>
            <td>12</td>
            <td>Acre</td>
            <td>AC</td>
        </tr>
        <tr>
            <td>120005</td>
            <td>Tarauacá</td>
            <td>Cruzeiro do Sul</td>
            <td>12</td>
            <td>Acre</td>
            <td>AC</td>
        </tr>
        <tr>
            <td>130001</td>
            <td>Manaus</td>
            <td>Manaus</td>
            <td>13</td>
            <td>Amazonas</td>
            <td>AM</td>
        </tr>
        <tr>
            <td>130002</td>
            <td>São Gabriel da Cachoeira</td>
            <td>Manaus</td>
            <td>13</td>
            <td>Amazonas</td>
            <td>AM</td>
        </tr>
        <tr>
            <td>130003</td>
            <td>Coari</td>
            <td>Manaus</td>
            <td>13</td>
            <td>Amazonas</td>
            <td>AM</td>
        </tr>
        <tr>
            <td>130004</td>
            <td>Manacapuru</td>
            <td>Manaus</td>
            <td>13</td>
            <td>Amazonas</td>
            <td>AM</td>
        </tr>
    </tbody>
</table></div></div>
</div>
<p><em>Criando uma Visão com informações integradas das tabelas censo_mun, regiao_imed, regiao_inter, estado e regiao:</em></p>
<p>Para integrar informações de todas as tabelas mencionadas (<code class="docutils literal notranslate"><span class="pre">censo_mun</span></code>, <code class="docutils literal notranslate"><span class="pre">regiao_imed</span></code>, <code class="docutils literal notranslate"><span class="pre">regiao_inter</span></code>, <code class="docutils literal notranslate"><span class="pre">estado</span></code>, e <code class="docutils literal notranslate"><span class="pre">regiao</span></code>), criando uma visão abrangente que abranja detalhes dos municípios, regiões imediatas e intermediárias, estados e regiões geográficas:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
CREATE VIEW v_censo_mun AS
SELECT 
    censo_mun.cd_geocodi,
    censo_mun.nome_mun,
    censo_mun.area_km2,
    censo_mun.popul_2010,
    censo_mun.popul_2022,
    regiao_imed.nome_rgi,
    regiao_inter.nome_rgint,
    estado.nome_uf,
    estado.sigla_uf,
    regiao.nome_rg
FROM 
    censo_mun
INNER JOIN 
    regiao_imed ON censo_mun.cod_rgi = regiao_imed.cod_rgi
INNER JOIN 
    regiao_inter ON censo_mun.cod_rgint = regiao_inter.cod_rgint
INNER JOIN 
    estado ON censo_mun.cod_uf = estado.cod_uf
INNER JOIN 
    regiao ON estado.cod_rg = regiao.cod_rg;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Done.
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[]
</pre></div>
</div>
</div>
</div>
<p>No código acima:</p>
<p><code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">VIEW</span> <span class="pre">v_censo_mun</span> <span class="pre">AS</span></code>: Este comando cria a visão v_censo_mun. As visões são úteis para simplificar consultas complexas, pois permitem que você trate o resultado de uma consulta como se fosse uma tabela.
<code class="docutils literal notranslate"><span class="pre">SELECT</span></code>: A cláusula SELECT define quais colunas serão incluídas na visão, selecionando informações específicas de várias tabelas:</p>
<p>censo_mun.cd_geocodi: O código geográfico do município.
censo_mun.nome_mun: O nome do município.
censo_mun.area_km2: A área do município em quilômetros quadrados.
censo_mun.popul_2010: A população do município no ano de 2010.
censo_mun.popul_2022: A população do município no ano de 2022 (ou o ano mais recente disponível).
regiao_imed.nome_rgi: O nome da região imediata à qual o município pertence.
regiao_inter.nome_rgint: O nome da região intermediária à qual o município pertence.
estado.nome_uf: O nome do estado ao qual o município pertence.
estado.sigla_uf: A sigla do estado.
regiao.nome_rg: O nome da região (mais ampla) à qual o município pertence.</p>
<p><code class="docutils literal notranslate"><span class="pre">FROM</span> <span class="pre">censo_mun</span></code>: A consulta começa pela tabela censo_mun, que contém dados do censo dos municípios.</p>
<p>Em seguida, a consulta utiliza várias operações de INNER JOIN para unir outras tabelas baseadas em chaves de relação:</p>
<p><code class="docutils literal notranslate"><span class="pre">INNER</span> <span class="pre">JOIN</span> <span class="pre">regiao_imed</span> <span class="pre">ON</span> <span class="pre">censo_mun.cod_rgi</span> <span class="pre">=</span> <span class="pre">regiao_imed.cod_rgi</span></code>: Une a tabela censo_mun com regiao_imed com base na correspondência dos códigos de região imediata.</p>
<p><code class="docutils literal notranslate"><span class="pre">INNER</span> <span class="pre">JOIN</span> <span class="pre">regiao_inter</span> <span class="pre">ON</span> <span class="pre">censo_mun.cod_rgint</span> <span class="pre">=</span> <span class="pre">regiao_inter.cod_rgint</span></code>: Une a tabela resultante da junção anterior com regiao_inter, baseando-se nos códigos de região intermediária.</p>
<p><code class="docutils literal notranslate"><span class="pre">INNER</span> <span class="pre">JOIN</span> <span class="pre">estado</span> <span class="pre">ON</span> <span class="pre">censo_mun.cod_uf</span> <span class="pre">=</span> <span class="pre">estado.cod_uf</span></code>: Continua as junções com a tabela estado, conectando os municípios ao estado a que pertencem.</p>
<p><code class="docutils literal notranslate"><span class="pre">INNER</span> <span class="pre">JOIN</span> <span class="pre">regiao</span> <span class="pre">ON</span> <span class="pre">estado.cod_rg</span> <span class="pre">=</span> <span class="pre">regiao.cod_rg</span></code>: Finaliza as junções incluindo a tabela regiao, que conecta os estados às respectivas regiões mais amplas.</p>
<p>Para recuperar os registros desta visão:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
SELECT *
FROM v_censo_mun
LIMIT 20;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>20 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>cd_geocodi</th>
            <th>nome_mun</th>
            <th>area_km2</th>
            <th>popul_2010</th>
            <th>popul_2022</th>
            <th>nome_rgi</th>
            <th>nome_rgint</th>
            <th>nome_uf</th>
            <th>sigla_uf</th>
            <th>nome_rg</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>1100106</td>
            <td>Guajará-Mirim</td>
            <td>24856.877</td>
            <td>41656</td>
            <td>39396</td>
            <td>Porto Velho</td>
            <td>Porto Velho</td>
            <td>Rondônia</td>
            <td>RO</td>
            <td>Norte</td>
        </tr>
        <tr>
            <td>1100205</td>
            <td>Porto Velho</td>
            <td>34090.952</td>
            <td>428527</td>
            <td>461748</td>
            <td>Porto Velho</td>
            <td>Porto Velho</td>
            <td>Rondônia</td>
            <td>RO</td>
            <td>Norte</td>
        </tr>
        <tr>
            <td>1100338</td>
            <td>Nova Mamoré</td>
            <td>10070.49</td>
            <td>22546</td>
            <td>25452</td>
            <td>Porto Velho</td>
            <td>Porto Velho</td>
            <td>Rondônia</td>
            <td>RO</td>
            <td>Norte</td>
        </tr>
        <tr>
            <td>1100809</td>
            <td>Candeias do Jamari</td>
            <td>6843.868</td>
            <td>19779</td>
            <td>22564</td>
            <td>Porto Velho</td>
            <td>Porto Velho</td>
            <td>Rondônia</td>
            <td>RO</td>
            <td>Norte</td>
        </tr>
        <tr>
            <td>1101104</td>
            <td>Itapuã do Oeste</td>
            <td>4081.58</td>
            <td>8566</td>
            <td>9465</td>
            <td>Porto Velho</td>
            <td>Porto Velho</td>
            <td>Rondônia</td>
            <td>RO</td>
            <td>Norte</td>
        </tr>
        <tr>
            <td>1100023</td>
            <td>Ariquemes</td>
            <td>4426.571</td>
            <td>90353</td>
            <td>100896</td>
            <td>Ariquemes</td>
            <td>Porto Velho</td>
            <td>Rondônia</td>
            <td>RO</td>
            <td>Norte</td>
        </tr>
        <tr>
            <td>1100262</td>
            <td>Rio Crespo</td>
            <td>1717.64</td>
            <td>3316</td>
            <td>3476</td>
            <td>Ariquemes</td>
            <td>Porto Velho</td>
            <td>Rondônia</td>
            <td>RO</td>
            <td>Norte</td>
        </tr>
        <tr>
            <td>1100403</td>
            <td>Alto Paraíso</td>
            <td>2651.822</td>
            <td>17135</td>
            <td>17140</td>
            <td>Ariquemes</td>
            <td>Porto Velho</td>
            <td>Rondônia</td>
            <td>RO</td>
            <td>Norte</td>
        </tr>
        <tr>
            <td>1100452</td>
            <td>Buritis</td>
            <td>3265.809</td>
            <td>32383</td>
            <td>28178</td>
            <td>Ariquemes</td>
            <td>Porto Velho</td>
            <td>Rondônia</td>
            <td>RO</td>
            <td>Norte</td>
        </tr>
        <tr>
            <td>1100601</td>
            <td>Cacaulândia</td>
            <td>1961.778</td>
            <td>5736</td>
            <td>4157</td>
            <td>Ariquemes</td>
            <td>Porto Velho</td>
            <td>Rondônia</td>
            <td>RO</td>
            <td>Norte</td>
        </tr>
        <tr>
            <td>1100700</td>
            <td>Campo Novo de Rondônia</td>
            <td>3442.005</td>
            <td>12665</td>
            <td>8840</td>
            <td>Ariquemes</td>
            <td>Porto Velho</td>
            <td>Rondônia</td>
            <td>RO</td>
            <td>Norte</td>
        </tr>
        <tr>
            <td>1100940</td>
            <td>Cujubim</td>
            <td>3863.946</td>
            <td>15854</td>
            <td>14338</td>
            <td>Ariquemes</td>
            <td>Porto Velho</td>
            <td>Rondônia</td>
            <td>RO</td>
            <td>Norte</td>
        </tr>
        <tr>
            <td>1101401</td>
            <td>Monte Negro</td>
            <td>1931.378</td>
            <td>14091</td>
            <td>11966</td>
            <td>Ariquemes</td>
            <td>Porto Velho</td>
            <td>Rondônia</td>
            <td>RO</td>
            <td>Norte</td>
        </tr>
        <tr>
            <td>1100114</td>
            <td>Jaru</td>
            <td>2944.128</td>
            <td>52005</td>
            <td>52090</td>
            <td>Jaru</td>
            <td>Porto Velho</td>
            <td>Rondônia</td>
            <td>RO</td>
            <td>Norte</td>
        </tr>
        <tr>
            <td>1100130</td>
            <td>Machadinho D&#x27;Oeste</td>
            <td>8509.27</td>
            <td>31135</td>
            <td>30626</td>
            <td>Jaru</td>
            <td>Porto Velho</td>
            <td>Rondônia</td>
            <td>RO</td>
            <td>Norte</td>
        </tr>
        <tr>
            <td>1101005</td>
            <td>Governador Jorge Teixeira</td>
            <td>5067.384</td>
            <td>10512</td>
            <td>8012</td>
            <td>Jaru</td>
            <td>Porto Velho</td>
            <td>Rondônia</td>
            <td>RO</td>
            <td>Norte</td>
        </tr>
        <tr>
            <td>1101609</td>
            <td>Theobroma</td>
            <td>2197.413</td>
            <td>10649</td>
            <td>9253</td>
            <td>Jaru</td>
            <td>Porto Velho</td>
            <td>Rondônia</td>
            <td>RO</td>
            <td>Norte</td>
        </tr>
        <tr>
            <td>1101757</td>
            <td>Vale do Anari</td>
            <td>3135.106</td>
            <td>9384</td>
            <td>7806</td>
            <td>Jaru</td>
            <td>Porto Velho</td>
            <td>Rondônia</td>
            <td>RO</td>
            <td>Norte</td>
        </tr>
        <tr>
            <td>1100080</td>
            <td>Costa Marques</td>
            <td>4987.177</td>
            <td>13678</td>
            <td>12633</td>
            <td>Ji-Paraná</td>
            <td>Ji-Paraná</td>
            <td>Rondônia</td>
            <td>RO</td>
            <td>Norte</td>
        </tr>
        <tr>
            <td>1100122</td>
            <td>Ji-Paraná</td>
            <td>6896.649</td>
            <td>116610</td>
            <td>136825</td>
            <td>Ji-Paraná</td>
            <td>Ji-Paraná</td>
            <td>Rondônia</td>
            <td>RO</td>
            <td>Norte</td>
        </tr>
    </tbody>
</table></div></div>
</div>
</div>
<div class="section" id="visoes-materializadas-no-postgresql">
<h3>2.8.2 Visões Materializadas no PostgreSQL<a class="headerlink" href="#visoes-materializadas-no-postgresql" title="Permalink to this heading">#</a></h3>
<p>No PostgreSQL, quando você cria visões usando o comando <code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">VIEW</span></code>, você está criando visões não materializadas. Estas são basicamente consultas SQL armazenadas que são executadas cada vez que a visão é acessada. Elas não armazenam fisicamente os resultados da consulta, portanto, diretamente, você não pode criar índices para essas visões não materializadas, pois os índices requerem um armazenamento físico dos dados sobre os quais estão sendo construídos.</p>
<p>Para situações em que você deseja melhorar o desempenho de acesso a dados de uma visão no PostgreSQL, você pode considerar o uso de <strong>visões materializadas</strong>. As visões materializadas são criadas com o comando <code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">MATERIALIZED</span> <span class="pre">VIEW</span></code> e diferentemente das visões comuns, elas armazenam os resultados da consulta no disco. Sendo assim, sobre as visões materializadas, você pode criar índices, o que pode melhorar o desempenho de consultas subsequentes a essas visões.</p>
<p>Aqui está um exemplo básico de como criar uma visão materializada e então indexá-la no PostgreSQL:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
CREATE MATERIALIZED VIEW vm_censo_mun AS
SELECT 
    censo_mun.cd_geocodi,
    censo_mun.nome_mun,
    censo_mun.area_km2,
    censo_mun.popul_2010,
    censo_mun.popul_2022,
    regiao_imed.nome_rgi,
    regiao_inter.nome_rgint,
    estado.nome_uf,
    estado.sigla_uf,
    regiao.nome_rg
FROM 
    censo_mun
INNER JOIN 
    regiao_imed ON censo_mun.cod_rgi = regiao_imed.cod_rgi
INNER JOIN 
    regiao_inter ON censo_mun.cod_rgint = regiao_inter.cod_rgint
INNER JOIN 
    estado ON censo_mun.cod_uf = estado.cod_uf
INNER JOIN 
    regiao ON estado.cod_rg = regiao.cod_rg;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>5570 rows affected.
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[]
</pre></div>
</div>
</div>
</div>
<p>Para criar um índice na visão materializada:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
CREATE INDEX vm_censo_mun_cd_geocodi_idx ON vm_censo_mun (cd_geocodi);
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Done.
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[]
</pre></div>
</div>
</div>
</div>
<p>Para recuperar os registros desta visão materializada:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
SELECT *
FROM vm_censo_mun
LIMIT 20;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
20 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>cd_geocodi</th>
            <th>nome_mun</th>
            <th>area_km2</th>
            <th>popul_2010</th>
            <th>popul_2022</th>
            <th>nome_rgi</th>
            <th>nome_rgint</th>
            <th>nome_uf</th>
            <th>sigla_uf</th>
            <th>nome_rg</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>1100015</td>
            <td>Alta Floresta D&#x27;Oeste</td>
            <td>7067.127</td>
            <td>24392</td>
            <td>21558</td>
            <td>Cacoal</td>
            <td>Ji-Paraná</td>
            <td>Rondônia</td>
            <td>RO</td>
            <td>Norte</td>
        </tr>
        <tr>
            <td>1100023</td>
            <td>Ariquemes</td>
            <td>4426.571</td>
            <td>90353</td>
            <td>100896</td>
            <td>Ariquemes</td>
            <td>Porto Velho</td>
            <td>Rondônia</td>
            <td>RO</td>
            <td>Norte</td>
        </tr>
        <tr>
            <td>1100031</td>
            <td>Cabixi</td>
            <td>1314.352</td>
            <td>6313</td>
            <td>5107</td>
            <td>Vilhena</td>
            <td>Ji-Paraná</td>
            <td>Rondônia</td>
            <td>RO</td>
            <td>Norte</td>
        </tr>
        <tr>
            <td>1100049</td>
            <td>Cacoal</td>
            <td>3793.0</td>
            <td>78574</td>
            <td>92202</td>
            <td>Cacoal</td>
            <td>Ji-Paraná</td>
            <td>Rondônia</td>
            <td>RO</td>
            <td>Norte</td>
        </tr>
        <tr>
            <td>1100056</td>
            <td>Cerejeiras</td>
            <td>2783.3</td>
            <td>17029</td>
            <td>15237</td>
            <td>Vilhena</td>
            <td>Ji-Paraná</td>
            <td>Rondônia</td>
            <td>RO</td>
            <td>Norte</td>
        </tr>
        <tr>
            <td>1100064</td>
            <td>Colorado do Oeste</td>
            <td>1451.06</td>
            <td>18591</td>
            <td>15747</td>
            <td>Vilhena</td>
            <td>Ji-Paraná</td>
            <td>Rondônia</td>
            <td>RO</td>
            <td>Norte</td>
        </tr>
        <tr>
            <td>1100072</td>
            <td>Corumbiara</td>
            <td>3060.321</td>
            <td>8783</td>
            <td>7503</td>
            <td>Vilhena</td>
            <td>Ji-Paraná</td>
            <td>Rondônia</td>
            <td>RO</td>
            <td>Norte</td>
        </tr>
        <tr>
            <td>1100080</td>
            <td>Costa Marques</td>
            <td>4987.177</td>
            <td>13678</td>
            <td>12633</td>
            <td>Ji-Paraná</td>
            <td>Ji-Paraná</td>
            <td>Rondônia</td>
            <td>RO</td>
            <td>Norte</td>
        </tr>
        <tr>
            <td>1100098</td>
            <td>Espigão D&#x27;Oeste</td>
            <td>4518.038</td>
            <td>28729</td>
            <td>29722</td>
            <td>Cacoal</td>
            <td>Ji-Paraná</td>
            <td>Rondônia</td>
            <td>RO</td>
            <td>Norte</td>
        </tr>
        <tr>
            <td>1100106</td>
            <td>Guajará-Mirim</td>
            <td>24856.877</td>
            <td>41656</td>
            <td>39396</td>
            <td>Porto Velho</td>
            <td>Porto Velho</td>
            <td>Rondônia</td>
            <td>RO</td>
            <td>Norte</td>
        </tr>
        <tr>
            <td>1100114</td>
            <td>Jaru</td>
            <td>2944.128</td>
            <td>52005</td>
            <td>52090</td>
            <td>Jaru</td>
            <td>Porto Velho</td>
            <td>Rondônia</td>
            <td>RO</td>
            <td>Norte</td>
        </tr>
        <tr>
            <td>1100122</td>
            <td>Ji-Paraná</td>
            <td>6896.649</td>
            <td>116610</td>
            <td>136825</td>
            <td>Ji-Paraná</td>
            <td>Ji-Paraná</td>
            <td>Rondônia</td>
            <td>RO</td>
            <td>Norte</td>
        </tr>
        <tr>
            <td>1100130</td>
            <td>Machadinho D&#x27;Oeste</td>
            <td>8509.27</td>
            <td>31135</td>
            <td>30626</td>
            <td>Jaru</td>
            <td>Porto Velho</td>
            <td>Rondônia</td>
            <td>RO</td>
            <td>Norte</td>
        </tr>
        <tr>
            <td>1100148</td>
            <td>Nova Brasilândia D&#x27;Oeste</td>
            <td>1703.008</td>
            <td>19874</td>
            <td>17355</td>
            <td>Cacoal</td>
            <td>Ji-Paraná</td>
            <td>Rondônia</td>
            <td>RO</td>
            <td>Norte</td>
        </tr>
        <tr>
            <td>1100155</td>
            <td>Ouro Preto do Oeste</td>
            <td>1969.85</td>
            <td>37928</td>
            <td>36753</td>
            <td>Ji-Paraná</td>
            <td>Ji-Paraná</td>
            <td>Rondônia</td>
            <td>RO</td>
            <td>Norte</td>
        </tr>
        <tr>
            <td>1100189</td>
            <td>Pimenta Bueno</td>
            <td>6241.016</td>
            <td>33822</td>
            <td>37464</td>
            <td>Cacoal</td>
            <td>Ji-Paraná</td>
            <td>Rondônia</td>
            <td>RO</td>
            <td>Norte</td>
        </tr>
        <tr>
            <td>1100205</td>
            <td>Porto Velho</td>
            <td>34090.952</td>
            <td>428527</td>
            <td>461748</td>
            <td>Porto Velho</td>
            <td>Porto Velho</td>
            <td>Rondônia</td>
            <td>RO</td>
            <td>Norte</td>
        </tr>
        <tr>
            <td>1100254</td>
            <td>Presidente Médici</td>
            <td>1758.465</td>
            <td>22319</td>
            <td>19316</td>
            <td>Ji-Paraná</td>
            <td>Ji-Paraná</td>
            <td>Rondônia</td>
            <td>RO</td>
            <td>Norte</td>
        </tr>
        <tr>
            <td>1100262</td>
            <td>Rio Crespo</td>
            <td>1717.64</td>
            <td>3316</td>
            <td>3476</td>
            <td>Ariquemes</td>
            <td>Porto Velho</td>
            <td>Rondônia</td>
            <td>RO</td>
            <td>Norte</td>
        </tr>
        <tr>
            <td>1100288</td>
            <td>Rolim de Moura</td>
            <td>1457.811</td>
            <td>50648</td>
            <td>57180</td>
            <td>Cacoal</td>
            <td>Ji-Paraná</td>
            <td>Rondônia</td>
            <td>RO</td>
            <td>Norte</td>
        </tr>
    </tbody>
</table></div></div>
</div>
<p>Lembre-se de que, como as visões materializadas armazenam os dados fisicamente, elas não são automaticamente atualizadas quando os dados nas tabelas originais mudam. Para atualizar os dados em uma visão materializada, você precisa usar o comando <code class="docutils literal notranslate"><span class="pre">REFRESH</span> <span class="pre">MATERIALIZED</span> <span class="pre">VIEW</span></code>, que pode ser executado manualmente ou por meio de um processo automatizado, dependendo de suas necessidades:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
REFRESH MATERIALIZED VIEW vm_censo_mun;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost/bd_censo_ibge
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Done.
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[]
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="praticas-recomendadas-e-convencoes-em-sql">
<h2>2.9 Práticas Recomendadas e Convenções em SQL<a class="headerlink" href="#praticas-recomendadas-e-convencoes-em-sql" title="Permalink to this heading">#</a></h2>
<p>Manter um código SQL limpo, legível e compreensível é crucial para a eficiência e colaboração em qualquer ambiente de desenvolvimento de banco de dados. Aqui estão algumas melhores práticas e convenções que podem ajudar a alcançar esses objetivos:</p>
<p><em>Normas de Nomenclatura</em></p>
<p>Adotar uma convenção de nomenclatura consistente e lógica facilita o entendimento do propósito das tabelas, colunas ou procedimentos armazenados:</p>
<ul class="simple">
<li><p><strong>Nomes Descritivos:</strong> Utilize nomes que sejam descritivos e precisos para tabelas e colunas.</p></li>
<li><p><strong>Padrão de Abreviações:</strong> Mantenha um padrão coerente para as abreviações.</p></li>
<li><p><strong>Snake_case ou CamelCase:</strong> Para nomes compostos, opte por snake_case (palavras em minúsculas separadas por sublinhados) ou CamelCase (iniciais em maiúscula, sem espaços).</p></li>
<li><p><strong>Prefixos em Nomes de Tabelas:</strong> Prefixe os nomes das tabelas com um indicativo de sua função ou conteúdo (ex: <code class="docutils literal notranslate"><span class="pre">usr_</span></code> para tabelas de usuários).</p></li>
<li><p><strong>Evite Palavras Reservadas:</strong> Evite o uso de palavras reservadas do SQL para nomes de tabelas e colunas.</p></li>
<li><p><strong>Chaves Primárias:</strong> Nomes de colunas de chave primária podem ser simplesmente <code class="docutils literal notranslate"><span class="pre">id</span></code> ou uma variação do nome da tabela seguido por <code class="docutils literal notranslate"><span class="pre">_id</span></code>.</p></li>
</ul>
<p><em>Formatação de Código</em></p>
<p>Uma formatação consistente torna o código mais acessível e fácil de seguir:</p>
<ul class="simple">
<li><p><strong>Indentação:</strong> Utilize indentação para destacar a estrutura e a hierarquia do seu SQL.</p></li>
<li><p><strong>Alinhamento Vertical:</strong> Mantenha cláusulas (SELECT, FROM, WHERE, JOIN, etc.) alinhadas verticalmente no código.</p></li>
<li><p><strong>Nova Linha para Cada Coluna/Condição:</strong> Coloque cada coluna ou cláusula de condição em uma nova linha.</p></li>
<li><p><strong>Maiúsculas e Minúsculas:</strong> Utilize maiúsculas para comandos SQL e funções, e mantenha nomes de tabelas e colunas em minúsculas.</p></li>
</ul>
<p><em>Comentários</em></p>
<p>Comentar o código é fundamental para explicar a lógica, as intenções e possíveis considerações futuras:</p>
<ul class="simple">
<li><p><strong>Comentários de Linha Única:</strong> Utilize <code class="docutils literal notranslate"><span class="pre">--</span></code> para comentários de linha única.</p></li>
<li><p><strong>Comentários de Múltiplas Linhas:</strong> Utilize <code class="docutils literal notranslate"><span class="pre">/*</span></code> para iniciar e <code class="docutils literal notranslate"><span class="pre">*/</span></code> para terminar blocos de comentário.</p></li>
</ul>
<p><em>Documentação e Manutenção do Código</em></p>
<ul class="simple">
<li><p><strong>Documentação para Procedimentos Armazenados:</strong> Mantenha uma documentação detalhada ou cabeçalho de comentário para procedimentos armazenados, explicando seu propósito, parâmetros e uso esperado.</p></li>
<li><p><strong>Atualização de Comentários e Documentação:</strong> Certifique-se de atualizar os comentários e a documentação à medida que o código evolui.</p></li>
<li><p><strong>Evite Comentários Obsoletos:</strong> Remova comentários que não se aplicam mais para evitar confusão.</p></li>
</ul>
<p>Seguindo estas práticas recomendadas, você pode garantir que seu código SQL seja não apenas funcional, mas também claro e com possibilidades de manutenção ao longo do tempo, facilitando a colaboração e o entendimento entre os profissionais e equipes que trabalham com o banco de dados.</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="capitulo1.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">1. FUNDAMENTOS DE BANCOS DE DADOS</p>
      </div>
    </a>
    <a class="right-next"
       href="referencias.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Referências Bibliográficas</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#breve-historico-do-sql">2.1 Breve histórico do SQL</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visao-geral-do-banco-de-dados-de-exemplo">2.2 Visão geral do Banco de Dados de exemplo</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#requisitos-de-consulta-e-analise">2.2.1 Requisitos de consulta e análise</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-conceitual">2.2.1.1 Modelo conceitual</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#projeto-logico">2.2.1.2 Projeto lógico</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#projeto-fisico">2.2.1.3 Projeto físico</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#configuracao-do-ambiente-de-desenvolvimento-e-fundamentos-de-conexao-com-postgresql-utilizando-python">2.3 Configuração do ambiente de desenvolvimento e fundamentos de conexão com PostgreSQL utilizando Python</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#categorias-fundamentais-da-linguagem-sql-ddl-dml-e-dcl">2.4 Categorias fundamentais da linguagem SQL: DDL, DML e DCL</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#linguagem-de-definicao-de-dados-data-definition-language-ddl">2.4.1 Linguagem de definição de dados (Data Definition Language - DDL)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#linguagem-de-manipulacao-de-dados-data-manipulation-language-dml">2.4.2 Linguagem de Manipulação de Dados (Data Manipulation Language - DML)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#indexacao-e-performance-no-sql">2.4.3 Indexação e Performance no SQL</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#linguagem-de-controle-de-dados-data-control-language-dcl">2.4.4 Linguagem de Controle de Dados (Data Control Language - DCL)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#consulta-e-recuperacao-de-dados-em-sql">2.5 Consulta e recuperação de dados em SQL</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#agrupamento-de-dados-em-sql">2.6 Agrupamento de Dados em SQL</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#uniao-de-tabelas-no-sql">2.7 União de Tabelas no SQL</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#inner-join">2.7.1 INNER JOIN</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#left-join">2.7.2 LEFT JOIN</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#right-join">2.7.3 RIGHT JOIN</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#full-join">2.7.4 FULL JOIN</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#subconsultas">2.7.5 Subconsultas</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#operacoes-de-conjunto-em-sql">2.7.6 Operações de Conjunto em SQL</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#o-conceito-de-visao-em-bancos-de-dados-relacionais">2.8 O conceito de “Visão” em bancos de dados relacionais</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visoes-views-e-inner-join">2.8.1 Visões (Views) e INNER JOIN</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visoes-materializadas-no-postgresql">2.8.2 Visões Materializadas no PostgreSQL</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#praticas-recomendadas-e-convencoes-em-sql">2.9 Práticas Recomendadas e Convenções em SQL</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Alexandro Gularte Schafer
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=5b4479735964841361fd"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>